{"version":3,"sources":["webpack://exports/webpack/bootstrap","webpack://exports/./src/main.js","webpack://exports/./src/tree.js","webpack://exports/./src/utils.js","webpack://exports/./src/xml.js","webpack://exports/external \"sketch/dom\"","webpack://exports/external \"sketch/settings\"","webpack://exports/external \"sketch/ui\""],"names":["onShowAboutDialog","context","iconPath","plugin","urlForResourceNamed","path","icon","NSImage","alloc","initByReferencingFile","dialog","NSAlert","init","setMessageText","setInformativeText","addButtonWithTitle","responseCode","runModal","NSAlertFirstButtonReturn","NSWorkspace","sharedWorkspace","openURL","NSURL","URLWithString","onOpenFileAndExportWholeAsXml","file","Document","require","filePath","String","fileName","substring","lastIndexOf","indexOf","replace","trim","fileDir","open","err","document","console","warn","exportWhole","getSelectedDocument","close","onExportLibraryAsXml","Tree","Xml","Utils","sketch","settings","UI","alert","chooseFolder","log","docPath","decodeURI","docPathElements","split","documentName","length","pascalize","libraryName","libraryFontsSubDir","libraryImagesSubDir","createDirectoryIfNeeded","forceNewDirectory","message","documentContext","initDocumentContext","xmlLibraryRoot","NSXMLElement","initWithName","xmlAddAttributesToElement","version","symbols","getSymbols","symbolsIDs","i","currentSymbol","name","startsWith","includes","id","push","indexedData","globalNamesIndex","actualName","getUniqueNameFromIndexedData","actualType","getTypeFromIndexedData","keyValues","getKeyValuesFromIndexedData","parentType","getParentTypeFromIndexedData","xmlComponent","xmlAddElement","frame","width","height","background","enabled","includedInInstance","getBackgroundColorAsHexValueOrSwatchReference","xmlAddCustomPropertiesToElement","addSymbolMasterOverridesToXml","treeIterateLayers","layers","addSharedTextStylesToXml","addFontFilesToXml","fontFiles","addColorVariablesToXml","clearTempContext","xmlFilePath","exportXMLToPath","playSoundNamed","Sounds","Glass","showInFinder","onExportApplicationAsXml","appName","appFontsSubDir","appImagesSubDir","xmlAppRoot","pages","page","xmlPage","artboards","j","artboardOrlayer","type","sketchObject","class","artboard","xmlScreen","includedInExport","exportDir","interactionsAllowed","maxNumberOfSteps","onExportWholeAsXml","onExportFonts","forEach","getFontFilesUsedByLayer","fontFile","copyFile","onExportSelectedLayersAsPNG","selectedLayers","NSBeep","layer","exportLayerAsPNG","onExportSelectedLayersAsSVG","exportLayerAsSVG","onExportSelectedLayersWithUserPredefinedExportOptions","exportLayerWithUserDefinedExportOptions","forbiddenNames","diacriticsMap","A","AE","E","I","O","OE","U","a","ae","c","e","o","oe","u","numberOfImagesPerLayerExport","maximumImageWidthOrHeight","GLOBALNAMESINDEX_UNIQUENAME","GLOBALNAMESINDEX_TYPE","GLOBALNAMESINDEX_KEYVALUES","GLOBALNAMESINDEX_RAWNAME","GLOBALNAMESINDEX_PARENTTYPE","TEMP_CONTEXT","POINT_DECIMAL_PRECISION","ANGLE_DECIMAL_PRECISION","data","getRawNameFromIndexedData","availableSwatchIDs","missingSwatches","imageHashToFilePath","sharedLayerStylesIndex","sharedTextStylesIndex","textsWithOutOfSyncStyle","sharedLayerStyles","style","sharedTextStyles","treePopulateGlobalNamesIndex","nb","Object","keys","usedNativeSwatches","documentData","allSwatches","nativeSwatch","objectID","addFontFileToContext","fontFilePath","result","layerFontFilePath","subLayer","symbolMaster","xmlRoot","overrides","overR","editable","property","overrideTargetPath","treeBuildOverrideTargetPath","parent","shallIgnoreSymbolMasters","rootDirPath","imagesSubDir","mask","actualParent","currentMask","l","isCustomClass","rawName","xmlCurrent","text","_object","shouldBreakMaskChain","master","indexedDataSymbolMaster","sketchVersion","symbolOverridesHash","isEditable","isDefault","indexedDataOverride","affectedLayer","originalOverrideTargetPath","overrideValue","defaultValue","currentValue","overrideParent","prefix","dotIndex","hasOwnProperty","imgHash","value","hash","imgRelativePath","imgUid","imgData","nsdata","writeToFile_atomically","NSString","stringWithFormat","targetName","camelize","currentOver","affectedLayerUsesAnOutOfSyncStyle","overrideStyle","styleFontFilePath","styleXML","treeAddAttributesFromLayerStyle","escapeCharactersInUnicodePrivateUseArea","indexexDataOldSymbol","oldType","newType","newSymbol","getSymbolMasterWithID","indexedDataNewSymbol","xmlSymbolOverride","Math","ceil","hasClippingMask","shallBlockBecauseExportExists","treeAddAttributesFromLayerData","treeAddAttributesFromPointData","currentXMLElement","point","pointType","pointAttributes","roundWithDecimalPrecision","x","y","cornerRadius","nativePoint","hasCurveFrom","curveFrom","hasCurveTo","curveTo","treeAddTextBehaviour","isTextLayer","layerTextBehaviour","treeAddAttributesFromTextStyle","layerOrSharedTextStyle","sharedTextStyle","isText","sharedStyle","attributes","opacity","blendingMode","textBehaviour","alignment","verticalAlignment","textColor","getTextColorAsHexValueOrSwatchReference","lineHeight","paragraphSpacing","needFontFamily","fontFamily","needFontSize","fontSize","needFontWeight","fontWeight","needFontStyle","fontStyle","needFontVariant","fontVariant","needFontStretch","fontStretch","needKerning","kerning","needTextTransform","textTransform","needTextUnderline","textUnderline","needTextStrikethrough","textStrikethrough","fontPostscriptNameFromStyle","fontStyleNameFromStyle","borderOptions","startArrowhead","endArrowhead","dashPatternLength","dashPattern","dashPatternString","join","lineEnd","lineJoin","fills","fill","xmlFill","fillAttributes","fillType","getFillColorAsHexValueOrSwatchReference","gradient","gradientType","from","to","aspectRatio","stops","stop","stopAttributes","position","rgbaToArgbOrRgb","color","pattern","patternType","tileScale","borders","border","xmlBorder","borderAttributes","thickness","locked","hidden","transform","rotation","flippedHorizontally","flippedVertically","hasFixedWidth","hasFixedHeight","hasFixedLeft","hasFixedTop","hasFixedRight","roundBy","hasFixedBottom","flow","target","targetId","animationType","renderingAsImage","isSupportedLayer","treeForceImageExport","exportFormats","treeExportBitmapLayer","hasExports","canExportTypeAsImage","treeAddImageExport","sharedStyleId","isSharedStyleOutOfSync","shapeType","closed","points","isBitmapLayer","image","isEmptyStyle","endsWith","exportPath","numberOfImages","layerWidth","layerHeight","currentAtN","insets","exportAttr","succeeded","format","suffix","fileFormat","sizeText","size","exportFormat","MSExportFormat","exportableFilenameForLayerName_exportFormat","treeAddLayerInGlobalNamesIndex","layerNamesUnicityByContext","layersStack","contextStack","elements","nameAndType","shift","useActualNameAsType","extractedTypeIsParentType","isLine","extractedType","match","toLowerCase","contextKey","localLayerNamesUnicityHash","counter","hashKey","lowerCaseFirstCharater","pop","layerId","unshift","rootKey","myId","getLayerWithID","elmts","index","str","xmlParent","fontsSubDir","excludeSystemFonts","fontFileNames","sort","swatchNameKey","validSwatchName","colorNames","keyName","validName","has","get","set","Map","swatchesData","swatch","fromNative","key","b","swatchData","styleNames","stylesData","textStyleData","sharedTextStyleXml","removeDiacritics","firstCharIsInvalid","p1","p2","offset","toUpperCase","capitalize","test","charAt","reduce","replaceRegexp","removeIllegalXmlCharacters","std","slice","temp","charCodeAt","toString","textStyle","fontPostscriptName","fontDisplayName","NSFont","displayName","fontStyleName","mscolorToHexValueOrSwatchReference","MSAttributedStringColorAttribute","rgbaToArgb","backgroundColor","mscolor","swatchID","mscolorToArgbOrRgb","immutableModelObject","hexValue","round","alpha","textBehaviourValue","nsFont","urlAttribute","fontDescriptor","objectForKey","isLayerGroup","isKindOfClass","MSLayerGroup","MSShapeGroup","MSBitmapLayer","MSTextLayer","isShapeLayer","MSRectangleShape","MSOvalShape","MSPolygonShape","MSStarShape","MSTriangleShape","MSShapePathLayer","isRectangleShape","isRectangle","isOvalShape","isSliceLayer","MSSliceLayer","isArtboard","MSArtboardGroup","isSymbolMaster","MSSymbolMaster","isSymbolInstance","MSSymbolInstance","isSupportedLine","isSupportedShapeStyle","isSupported","blur","shadows","filter","item","innerShadows","activeItems","numberOfActiveItems","lastItem","isEmpty","module","exports","Basso","Blow","Bottle","Frog","Funk","Hero","Morse","Ping","Pop","Purr","Sosumi","Submarine","Tink","sound","NSSound","soundNamed","play","panel","NSOpenPanel","openPanel","setCanChooseDirectories","setCanChooseFiles","setCanCreateDirectories","NSModalResponseOK","URL","showDialog","app","NSApplication","sharedApplication","displayDialog_withTitle","directoryPathOrFilePath","errorPointer","MOPointer","fileManager","NSFileManager","defaultManager","attributesOfItemAtPath_error","isDirectory","openFile_withApplication","selectFile_inFileViewerRootedAtPath","nil","runCommand","command","args","currentDirectoryPath","task","NSTask","setLaunchPath_","setCurrentDirectoryPath","arguments","launch","waitUntilExit","terminationStatus","source","destination","manager","fileExistsAtPath","copyItemAtPath_toPath_error","fileExists","expandTildeInPath","stringWithString","stringByExpandingTildeInPath","createDirectoryAtPath_withIntermediateDirectories_attributes_error","removeItemAtPath_error","precision","multiplier","pow","Number","EPSILON","rounder","layerAbsoluteRect","absoluteRect","changeBasis","asCGRect","nativeLayer","rect","layerAbsoluteInfluenceRect","request","MSExportRequest","exportRequestsFromLayerAncestry_","ancestry","firstObject","setRect_","NSZeroRect","exporter","MSExporter","exporterForRequest_colorSpace_","trimmedBounds","immutable","relativeInfluenceRect","influenceRectForBoundsInDocument","convertRect_toLayer_","absoluteInfluenceRect","exportLayerWithFormats","exportName","formats","preserveFrameSize","applyTransformAndOpacity","topInset","bottomInset","leftInset","rightInset","sketchDom","layerToExport","isRotated","isFlippedHorizontally","isFlippedVertically","parentIsGroup","useDuplicate","duplicate","selectedPage","point0","pt0X","pt0Y","point1","pt1X","pt1Y","angleInDegrees","atan2","PI","exportRect","CGRectContainsRect","absoluteRectX","origin","absoluteRectY","absoluteRectWidth","absoluteRectHeight","exportRectX","exportRectY","exportRectWidth","exportRectHeight","NSMakeRect","exportRequest","exportRequestsFromExportableLayer_exportFormats_inRect_useIDForName","setShouldTrim","namingScheme","saveExportRequest_toFile","saveArtboardOrSlice_toFile","exportRequestFromExportFormat_layer_inRect_useIDForName","remove","maxAtN","max","pngFormat","setFileFormat","setScale","setName","svgFormat","el","elementWithName_stringValue","elementWithName","addAttribute","NSXMLNode","attributeWithName_stringValue","addChild","element","xmlElement","root","doc","NSXMLDocument","documentWithRootElement","xmlData","XMLDataWithOptions","NSXMLNodePrettyPrint","p","writeToFile"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/main.js\");\n","export function onShowAboutDialog(context) {\n    let iconPath = context.plugin.urlForResourceNamed('icon.png').path();\n    let icon = NSImage.alloc().initByReferencingFile(iconPath);\n    let dialog = NSAlert.alloc().init();\n    dialog.setMessageText(\"Ingescape plugin\");\n    dialog.setInformativeText(\"This plugin exports a Sketch file to an Ingescape Pivot format for code generation in Qt/QML, etc. to be used in Ingescape Circle\");\n    dialog.icon = icon;\n    dialog.addButtonWithTitle(\"Get Circle\");\n    dialog.addButtonWithTitle(\"Close\");\n\n    let responseCode = dialog.runModal();\n    if (responseCode == NSAlertFirstButtonReturn) {\n        NSWorkspace.sharedWorkspace().openURL(NSURL.URLWithString(\"https://ingescape.com/circle/\"));\n    }  \n}\n\n\nexport function onOpenFileAndExportWholeAsXml(context) {\n    if(context.file) \n    {\n        let Document = require('sketch/dom').Document;\n        let filePath = String(context.file);\n        let fileName = filePath.substring(filePath.lastIndexOf(\"/\")+1, filePath.indexOf(\".\"));\n        fileName = fileName.replace(/[^a-zA-Z0-9\\-_\\s]/g, \"\")\n        fileName = fileName.trim();\n        let fileDir = filePath.substring(0, filePath.lastIndexOf(\"/\")+1) + fileName + \"_export/\";\n\n        // because of a bug, we can't call context.file directly, we must cast it as a string\n        Document.open(String(context.file), (err, document) => {\n            if (err) {\n                console.warn(\"Can't open file \", filePath, true)\n            }\n            else {\n                exportWhole(context, fileDir, false);\n                let document = require('sketch/dom').getSelectedDocument();\n                document.close();\n            }\n        });\n    }\n}\n\n/*\n Exporting file as a library consists in looking for the symbol masters\n declared as components (using the -> symbol) and exposing their\n inner parts in XML structures.\n*/\nexport function onExportLibraryAsXml(context) {\n    let Tree = require(\"./tree.js\");\n    let Xml = require(\"./xml.js\");\n    let Utils = require(\"./utils.js\");\n    let sketch = require('sketch/dom');\n    let document = sketch.getSelectedDocument();\n    let settings = require(\"sketch/settings\");\n    let UI = require('sketch/ui');\n\n    if (!document.path) {\n        UI.alert(\"Sketch2QML: can not export library as XML\", \"You must save your Sketch file first\")\n        return;\n    }\n\n    let path = Utils.chooseFolder();\n    if (!path) {\n        log(\"onExportLibraryAsXml: action cancelled by user\");\n        return;\n    }\n\n    let docPath = decodeURI(document.path);\n    let docPathElements = docPath.split('/');\n    let documentName = \"Default\";\n    if (docPathElements.length > 0) {\n        documentName = Tree.pascalize(docPathElements[docPathElements.length - 1].replace(/.sketch/g,\"\"));\n    }\n\n    let libraryName = documentName;\n\n    // Init directories\n    let libraryFontsSubDir = \"resources/\" + libraryName + \"_library/fonts/\";\n    let libraryImagesSubDir = \"resources/\" + libraryName + \"_library/images/\";\n    Utils.createDirectoryIfNeeded(path + libraryFontsSubDir);\n    Utils.forceNewDirectory(path + libraryImagesSubDir);\n\n    UI.message(\" Exporting library as Ingescape Pivot format. Please wait...\");\n\n    let documentContext = Tree.initDocumentContext(libraryImagesSubDir);\n\n    //init lib\n    let xmlLibraryRoot = NSXMLElement.alloc().initWithName(\"library\");\n    Xml.xmlAddAttributesToElement(xmlLibraryRoot, [\"name\", libraryName, \"sketchVersion\", settings.version.sketch]);\n\n    //export lib\n    let symbols = document.getSymbols();\n    let symbolsIDs = [];\n    for (let i = 0; symbols && (i < symbols.length); i++){\n        let currentSymbol = symbols[i];\n\n        if (currentSymbol.name.startsWith(\"#\")){\n            continue;\n        }\n\n        if (symbolsIDs.includes(currentSymbol.id)){\n            log(\"WARNING: symbol already included (ID=\" + currentSymbol.id + \", name \" + currentSymbol.name + \")\");\n            continue;\n        } else {\n            symbolsIDs.push(currentSymbol.id);\n        }\n\n        let indexedData = documentContext.globalNamesIndex[currentSymbol.id];\n        if (!indexedData){\n            log(\"could not find indexed data for \" + currentSymbol.name + \". This element will be ignored\");\n            log(\"\\t->Please check that it is not an external master that has not been made local.\")\n            continue;\n        }\n        let actualName = Tree.getUniqueNameFromIndexedData(indexedData);\n        let actualType = Tree.getTypeFromIndexedData(indexedData);\n        let keyValues = Tree.getKeyValuesFromIndexedData(indexedData);\n        let parentType = Tree.getParentTypeFromIndexedData(indexedData);\n\n        let xmlComponent = Xml.xmlAddElement(xmlLibraryRoot, \"component\", \n                                        [\"type\", actualType, \"name\", actualName, \n                                        \"width\", currentSymbol.frame.width, \"height\", currentSymbol.frame.height,\n                                        \"hasBackground\", (currentSymbol.background.enabled && currentSymbol.background.includedInInstance),\n                                        \"backgroundColor\", Tree.getBackgroundColorAsHexValueOrSwatchReference(currentSymbol)],\n                                        null);\n\n        if (parentType)\n            Xml.xmlAddAttributesToElement(xmlComponent, [\"parentType\", parentType]);\n\n        if (keyValues.length > 0)\n            Xml.xmlAddCustomPropertiesToElement(xmlComponent, keyValues);\n\n        Tree.addSymbolMasterOverridesToXml(currentSymbol, xmlComponent, documentContext);\n        Tree.treeIterateLayers(currentSymbol.layers, xmlComponent, false, path, libraryImagesSubDir, xmlLibraryRoot, documentContext, null);\n    }\n\n    Tree.addSharedTextStylesToXml(xmlLibraryRoot);\n    Tree.addFontFilesToXml(xmlLibraryRoot, path, libraryFontsSubDir, documentContext.fontFiles, false);\n    Tree.addColorVariablesToXml(xmlLibraryRoot); // NB: it must be done after all exports because styles and items may use not imported swatches\n    Tree.clearTempContext();\n    \n    //export model to XML\n    let xmlFilePath = path + libraryName + \"_library.xml\";\n    Xml.exportXMLToPath(xmlFilePath, xmlLibraryRoot);\n\n    Utils.playSoundNamed(Utils.Sounds.Glass);\n    UI.message(\" Library export completed to \" + xmlFilePath);\n    Utils.showInFinder(xmlFilePath); \n}\n\n\n/*\n Exports all artboards and orphan layers as windows\n */\nexport function onExportApplicationAsXml(context) {\n    let Tree = require(\"./tree.js\");\n    let Xml = require(\"./xml.js\");\n    let Utils = require(\"./utils.js\");\n    let sketch = require('sketch/dom')\n    let document = sketch.getSelectedDocument();\n    let settings = require(\"sketch/settings\");\n    let UI = require('sketch/ui');\n\n    if (!document.path) {\n        UI.alert(\"Sketch2QML: can not export application as XML\", \"You must save your Sketch file first\")\n        return;\n    }\n\n    let path = Utils.chooseFolder();\n    if (!path){\n        log(\"onExportApplicationAsXml: action cancelled by user\");\n        return;\n    }\n\n    let docPath = decodeURI(document.path);\n    let docPathElements = docPath.split('/');\n    let documentName = \"Default\";\n    if (docPathElements.length > 0){\n        documentName = Tree.pascalize(docPathElements[docPathElements.length - 1].replace(/.sketch/g,\"\"));\n    }\n\n    let appName = documentName;\n\n    // Init directories\n    let appFontsSubDir = \"resources/\" + appName + \"_app/fonts/\";\n    let appImagesSubDir = \"resources/\" + appName + \"_app/images/\";\n    let libraryImagesSubDir = \"resources/\" + libraryName + \"_library/images/\";\n    Utils.createDirectoryIfNeeded(path + appFontsSubDir);\n    Utils.forceNewDirectory(path + appImagesSubDir);\n \n\n    UI.message(\" Exporting application as Ingescape Pivot format. Please wait...\");\n\n    let documentContext = Tree.initDocumentContext(libraryImagesSubDir);\n\n    //init app\n    let xmlAppRoot = NSXMLElement.alloc().initWithName(\"app\");\n    Xml.xmlAddAttributesToElement(xmlAppRoot, [\"name\", appName, \"sketchVersion\", settings.version.sketch]);\n    \n\n    //export app\n    for (let i = 0; i < document.pages.length; i++){\n        let page = document.pages[i]\n        if (page.name.startsWith(\"#\")){\n            continue;\n        }\n\n        let xmlPage = Xml.xmlAddElement(xmlAppRoot, \"page\", [\"name\", page.name], null);\n        \n        // Artboard and elements outside of artboards\n        let artboards = [];\n        let layers = [];\n        for (let j = 0; j < page.layers.length; j++){\n            let artboardOrlayer = page.layers[j];\n            let type = artboardOrlayer.sketchObject.class();\n            if (type != \"MSArtboardGroup\"){\n                layers.push(artboardOrlayer);\n            } else {\n                artboards.push(artboardOrlayer);\n            }\n        }\n\n        Tree.treeIterateLayers(layers, xmlPage, true, path, appImagesSubDir, xmlAppRoot, documentContext, null);\n        \n        for (let j = 0; j < artboards.length; j++) {\n            let artboard = artboards[j];\n\n            if (artboard.name.startsWith(\"#\")){\n                continue;\n            }\n\n            let indexedData = documentContext.globalNamesIndex[artboard.id];\n            if (!indexedData){\n                log(\"could not find indexed data for \" + artboard.name + \". This artboard will be ignored\");\n                continue;\n            }\n\n            let actualName = Tree.getUniqueNameFromIndexedData(indexedData);\n            let actualType = Tree.getTypeFromIndexedData(indexedData);\n            let keyValues = Tree.getKeyValuesFromIndexedData(indexedData);\n            let parentType = Tree.getParentTypeFromIndexedData(indexedData);\n\n            let xmlScreen = Xml.xmlAddElement(xmlPage, \"screen\", \n                                        [\"type\", actualType, \"name\", actualName, \n                                        \"width\", artboard.frame.width, \"height\", artboard.frame.height,\n                                        \"hasBackground\", (artboard.background.enabled && artboard.background.includedInExport),\n                                        \"backgroundColor\", Tree.getBackgroundColorAsHexValueOrSwatchReference(artboard)],\n                                         null);\n\n            if (parentType)\n                Xml.xmlAddAttributesToElement(xmlScreen, [\"parentType\", parentType]);                                         \n\n            if (keyValues.length > 0)\n                Xml.xmlAddCustomPropertiesToElement(xmlScreen, keyValues);\n\n            Tree.treeIterateLayers(artboard.layers, xmlScreen, true, path, appImagesSubDir, xmlAppRoot, documentContext, null);\n        }\n     }\n\n    Tree.addSharedTextStylesToXml(xmlAppRoot);\n    Tree.addFontFilesToXml(xmlAppRoot, path, appFontsSubDir, documentContext.fontFiles, false);\n    Tree.addColorVariablesToXml(xmlAppRoot); // NB: it must be done after all exports because styles and items may use not imported swatches\n    Tree.clearTempContext();\n    \n    let xmlFilePath = path + appName + \"_app.xml\"\n    Xml.exportXMLToPath(xmlFilePath, xmlAppRoot);\n\n    Utils.playSoundNamed(Utils.Sounds.Glass);\n    UI.message(\" App export completed to \" + xmlFilePath);\n    Utils.showInFinder(xmlFilePath); \n};\n\n\nfunction exportWhole(context, exportDir = \"\", interactionsAllowed = true) {\n    let Tree = require(\"./tree.js\");\n    let Xml = require(\"./xml.js\");\n    let Utils = require(\"./utils.js\");\n    let sketch = require('sketch/dom');\n    let document = sketch.getSelectedDocument();\n    let settings = require(\"sketch/settings\");\n    let UI = require('sketch/ui');\n\n    let path = (interactionsAllowed && (exportDir === \"\")) ? Utils.chooseFolder() : exportDir;\n    if (!path){\n        log(\"exportWhole: action cancelled by user\");\n        return;\n    }\n\n    let docPath = decodeURI(document.path);\n    let docPathElements = docPath.split('/');\n    let documentName = \"Default\";\n    if (docPathElements.length > 0){\n        documentName = Tree.pascalize(docPathElements[docPathElements.length - 1].replace(/.sketch/g,\"\"));\n    }\n\n    let appName = documentName;\n    let libraryName = documentName;\n\n    // Init directories\n    let appFontsSubDir = \"resources/\" + appName + \"_app/fonts/\";\n    let appImagesSubDir = \"resources/\" + appName + \"_app/images/\";\n    let libraryFontsSubDir = \"resources/\" + libraryName + \"_library/fonts/\";\n    let libraryImagesSubDir = \"resources/\" + libraryName + \"_library/images/\";\n    Utils.createDirectoryIfNeeded(path + appFontsSubDir);\n    Utils.forceNewDirectory(path + appImagesSubDir);\n    Utils.createDirectoryIfNeeded(path + libraryFontsSubDir);\n    Utils.forceNewDirectory(path + libraryImagesSubDir);\n        \n\n    let maxNumberOfSteps = 2;\n    UI.message(\" [1/\" + maxNumberOfSteps+ \"] Exporting library as Ingescape Pivot format. Please wait...\");\n\n    let documentContext = Tree.initDocumentContext(libraryImagesSubDir);\n\n    //export library\n    let xmlLibraryRoot = NSXMLElement.alloc().initWithName(\"library\");\n    Xml.xmlAddAttributesToElement(xmlLibraryRoot, [\"name\", libraryName, \"sketchVersion\", settings.version.sketch]);\n    \n    let symbols = document.getSymbols();\n    let symbolsIDs = [];\n    for (let i = 0; symbols && (i < symbols.length); i++){\n        let currentSymbol = symbols[i];\n\n        if (currentSymbol.name.startsWith(\"#\")){\n            continue;\n        }\n\n        if (symbolsIDs.includes(currentSymbol.id)){\n            log(\"WARNING: symbol already included (ID=\" + currentSymbol.id + \", name \" + currentSymbol.name + \")\");\n            continue;\n        } else {\n            symbolsIDs.push(currentSymbol.id);\n        }\n\n        let indexedData = documentContext.globalNamesIndex[currentSymbol.id];\n        if (!indexedData){\n            log(\"could not find indexed data for \" + currentSymbol.name + \". This element will be ignored\");\n            log(\"\\t->Please check that it is not an external master that has not been made local.\")\n            continue;\n        }\n\n        let actualName = Tree.getUniqueNameFromIndexedData(indexedData);\n        let actualType = Tree.getTypeFromIndexedData(indexedData);\n        let keyValues = Tree.getKeyValuesFromIndexedData(indexedData);\n        let parentType = Tree.getParentTypeFromIndexedData(indexedData);\n\n        let xmlComponent = Xml.xmlAddElement(xmlLibraryRoot, \"component\", \n                                        [\"type\", actualType, \"name\", actualName, \n                                        \"width\", currentSymbol.frame.width, \"height\", currentSymbol.frame.height,\n                                        \"hasBackground\", (currentSymbol.background.enabled && currentSymbol.background.includedInInstance),\n                                        \"backgroundColor\", Tree.getBackgroundColorAsHexValueOrSwatchReference(currentSymbol)], \n                                        null);\n\n        if (parentType)\n            Xml.xmlAddAttributesToElement(xmlComponent, [\"parentType\", parentType]);\n\n        if (keyValues.length > 0)\n            Xml.xmlAddCustomPropertiesToElement(xmlComponent, keyValues);\n\n        Tree.addSymbolMasterOverridesToXml(currentSymbol, xmlComponent, documentContext);\n        Tree.treeIterateLayers(currentSymbol.layers, xmlComponent, false, path, libraryImagesSubDir, xmlLibraryRoot, documentContext, null);\n    }\n\n    Tree.addSharedTextStylesToXml(xmlLibraryRoot);\n    Tree.addFontFilesToXml(xmlLibraryRoot, path, libraryFontsSubDir, documentContext.fontFiles, false);\n    Tree.addColorVariablesToXml(xmlLibraryRoot); // NB: it must be done after all exports because styles and items may use not imported swatches\n\n    Xml.exportXMLToPath(path+libraryName+\"_library.xml\", xmlLibraryRoot);\n\n\n    \n    //export app\n    UI.message(\" [2/\" + maxNumberOfSteps + \"] Exporting application as Ingescape Pivot format. Please wait...\");\n\n    let xmlAppRoot = NSXMLElement.alloc().initWithName(\"app\");\n    Xml.xmlAddAttributesToElement(xmlAppRoot, [\"name\", appName, \"sketchVersion\", settings.version.sketch]);\n\n    for (let i = 0; i < document.pages.length; i++){\n        let page = document.pages[i]\n        if (page.name.startsWith(\"#\")){\n            continue;\n        }\n\n        let xmlPage = Xml.xmlAddElement(xmlAppRoot, \"page\", [\"name\", page.name], null);\n\n        // Artboard and elements outside of artboards\n        let artboards = [];\n        let layers = [];\n        for (let j = 0; j < page.layers.length; j++) {\n            let artboardOrlayer = page.layers[j];\n            let type = artboardOrlayer.sketchObject.class();\n            if (type != \"MSArtboardGroup\"){\n                layers.push(artboardOrlayer);\n            } else {\n                artboards.push(artboardOrlayer);\n            }\n        }\n        \n        Tree.treeIterateLayers(layers, xmlPage, true, path, appImagesSubDir, xmlAppRoot, documentContext, null);\n        \n        for (let j = 0; j < artboards.length; j++) {\n            let artboard = artboards[j];\n\n            if (artboard.name.startsWith(\"#\")){\n                continue;\n            }\n\n            let indexedData = documentContext.globalNamesIndex[artboard.id];\n            if (!indexedData){\n                log(\"could not find indexed data for \" + artboard.name + \". This artboard will be ignored\");\n                continue;\n            }\n\n            let actualName = Tree.getUniqueNameFromIndexedData(indexedData);\n            let actualType = Tree.getTypeFromIndexedData(indexedData);\n            let keyValues = Tree.getKeyValuesFromIndexedData(indexedData);\n            let parentType = Tree.getParentTypeFromIndexedData(indexedData);\n\n            let xmlScreen = Xml.xmlAddElement(xmlPage, \"screen\", \n                                        [\"type\", actualType, \"name\", actualName, \n                                        \"width\", artboard.frame.width, \"height\", artboard.frame.height,\n                                        \"hasBackground\", (artboard.background.enabled && artboard.background.includedInExport),\n                                        \"backgroundColor\", Tree.getBackgroundColorAsHexValueOrSwatchReference(artboard)],\n                                         null);\n            \n            if (parentType)\n                Xml.xmlAddAttributesToElement(xmlScreen, [\"parentType\", parentType]);\n\n            if (keyValues.length > 0)\n                Xml.xmlAddCustomPropertiesToElement(xmlScreen, keyValues);\n\n            Tree.treeIterateLayers(artboard.layers, xmlScreen, true, path, appImagesSubDir, xmlAppRoot, documentContext, null);\n        }\n    }\n\n    Tree.addSharedTextStylesToXml(xmlAppRoot);\n    Tree.addFontFilesToXml(xmlAppRoot, path, appFontsSubDir, documentContext.fontFiles, false);\n    Tree.addColorVariablesToXml(xmlAppRoot); // NB: it must be done after all exports because styles and items may use not imported swatches\n    Tree.clearTempContext();\n\n    Xml.exportXMLToPath(path+appName+\"_app.xml\", xmlAppRoot);\n\n    if (interactionsAllowed) \n    {\n        Utils.playSoundNamed(Utils.Sounds.Glass);\n        UI.message(\" Export of app and lib completed to \" + path);\n        Utils.showInFinder(path);\n    }\n};\n\n\nexport function onExportWholeAsXml(context) {\n    exportWhole(context);\n};\n\n\n\n/** \n * ----------------------------------------------------\n * DEBUG ONLY\n * ----------------------------------------------------  \n*/\n\n\nexport function onExportFonts(context) {\n    let Utils = require(\"./utils.js\");\n\n    let path = Utils.chooseFolder();\n    if (path)\n    {\n        let Tree = require(\"./tree.js\");\n        let document = require('sketch/dom').getSelectedDocument();\n        let UI = require('sketch/ui');\n        let fontFiles = [];\n\n        document.pages.forEach(page => {\n            Tree.getFontFilesUsedByLayer(page, fontFiles);     \n        });\n\n        if (fontFiles.length > 0) \n        {\n            fontFiles.forEach(fontFile => {\n                let fileName = fontFile.substring(fontFile.lastIndexOf('/') + 1);\n                Utils.copyFile(fontFile, path + fileName);\n            });\n\n            UI.message(\" Export completed - \" + fontFiles.length + \" font(s) exported to \" + path);\n            Utils.showInFinder(path);\n        } \n        else \n        {\n            UI.alert(\"Sketch2QML: can not export fonts\", \" No font found in your Sketch document\");\n        }\n    } \n    else \n    {\n        log(\"onExportFonts: action cancelled by user\");\n    } \n};\n\n\nexport function onExportSelectedLayersAsPNG(context) {\n    let Utils = require(\"./utils.js\");\n    let document = require('sketch/dom').getSelectedDocument();\n    let UI = require('sketch/ui');\n\n    let selectedLayers = document.selectedLayers;\n    if (selectedLayers.length == 0) \n    {\n        UI.alert(\"Sketch2QML: can not export PNG\", \" No layers are selected \\n=> Please select one or multiple layers before exporting.\");\n        NSBeep();\n\t\treturn;\n\t}\n\n    let path = Utils.chooseFolder();\n    if (path)\n    {\n        selectedLayers.forEach(layer => {\n            Utils.exportLayerAsPNG(layer, 4, path, layer.name, false, false);\n            //Utils.exportLayerAsPNG(layer, 4, path, layer.name + \"--frame-opacityAndTransform\", true, true);\n            //Utils.exportLayerAsPNG(layer, 4, path, layer.name + \"--noframe-opacityAndTransform\", false, true);\n            //Utils.exportLayerAsPNG(layer, 4, path, layer.name + \"--frame-noopacityAndTransform\", true, false);\n        });\n\n        UI.message(\" Export completed to \" + path);\n        Utils.showInFinder(path);\n    } \n    else \n    {\n        log(\"onExportSelectedLayersAsPNG: action cancelled by user\");\n    } \n};\n\n\nexport function onExportSelectedLayersAsSVG(context) {\n    let Utils = require(\"./utils.js\");\n    let document = require('sketch/dom').getSelectedDocument();\n    let UI = require('sketch/ui');\n\n    let selectedLayers = document.selectedLayers;\n    if (selectedLayers.length == 0) \n    {\n        UI.alert(\"Sketch2QML: can not export SVG\", \" No layers are selected \\n=> Please select one or multiple layers before exporting.\");\n        NSBeep();\n\t\treturn;\n\t}\n\n    let path = Utils.chooseFolder();\n    if (path)\n    {\n        selectedLayers.forEach(layer => {\n            Utils.exportLayerAsSVG(layer, path, layer.name, false, false);\n            //Utils.exportLayerAsSVG(layer, path, layer.name + \"--frame-opacityAndTransform\", true, true);\n            //Utils.exportLayerAsSVG(layer, path, layer.name + \"--noframe-opacityAndTransform\", false, true);\n            //Utils.exportLayerAsSVG(layer, path, layer.name + \"--frame-noopacityAndTransform\", true, false);\n        });\n\n        UI.message(\" Export completed to \" + path);\n        Utils.showInFinder(path);\n    } \n    else \n    {\n        log(\"onExportSelectedLayersAsSVG: action cancelled by user\");\n    } \n};\n\n\nexport function onExportSelectedLayersWithUserPredefinedExportOptions(context) {\n    let Utils = require(\"./utils.js\");\n    let document = require('sketch/dom').getSelectedDocument();\n    let UI = require('sketch/ui');\n   \n    let selectedLayers = document.selectedLayers;\n    if (selectedLayers.length == 0) \n    {\n        UI.alert(\"Sketch2QML: can not export images\", \" No layers are selected \\n=> Please select one or multiple layers before exporting.\");\n        NSBeep();\n\t\treturn;\n\t}\n\n    let path = Utils.chooseFolder();\n    if (path)\n    {\n        selectedLayers.forEach(layer => {\n            Utils.exportLayerWithUserDefinedExportOptions(layer, path, layer.name, false, false);\n            //Utils.exportLayerWithUserDefinedExportOptions(layer, path, layer.name + \"--frame-opacityAndTransform\", true, true);\n            //Utils.exportLayerWithUserDefinedExportOptions(layer, path, layer.name + \"--noframe-opacityAndTransform\", false, true);\n            //Utils.exportLayerWithUserDefinedExportOptions(layer, path, layer.name + \"--frame-noopacityAndTransform\", true, false);\n        });\n\n        UI.message(\" Export completed to \" + path);\n        Utils.showInFinder(path);\n    } \n    else \n    {\n        log(\"onExportSelectedLayersWithUserPredefinedExportOptions: action cancelled by user\");\n    } \n};\n\n\n","// TODO: add all reserved keywords\nlet forbiddenNames = [\n  \"bool\",\n  \"true\",\n  \"false\",\n  \"double\",\n  \"float\",\n  \"real\",\n  \"int\",\n  \"long\",\n  \"short\",\n  \"string\",\n  \"url\",\n  \"var\",\n  \"let\",\n  \"function\",\n  \"if\",\n  \"else\",\n  \"for\",\n  \"while\",\n  \"do\",\n  \"break\",\n  \"switch\",\n  \"case\",\n  \"default\",\n  \"continue\",\n  \"root\",\n  \"delete\",\n  \"bottom\",\n  \"top\",\n  \"left\",\n  \"right\",\n  \"baseline\"\n];\n\n\nlet diacriticsMap = {\n    A: /[\\u0041\\u24B6\\uFF21\\u00C0\\u00C1\\u00C2\\u1EA6\\u1EA4\\u1EAA\\u1EA8\\u00C3\\u0100\\u0102\\u1EB0\\u1EAE\\u1EB4\\u1EB2\\u0226\\u01E0\\u00C4\\u01DE\\u1EA2\\u00C5\\u01FA\\u01CD\\u0200\\u0202\\u1EA0\\u1EAC\\u1EB6\\u1E00\\u0104\\u023A\\u2C6F]/g,\n    AE: /[\\u00C6]/g,\n    E: /[\\u0045\\u24BA\\uFF25\\u00C8\\u00C9\\u00CA\\u1EC0\\u1EBE\\u1EC4\\u1EC2\\u1EBC\\u0112\\u1E14\\u1E16\\u0114\\u0116\\u00CB\\u1EBA\\u011A\\u0204\\u0206\\u1EB8\\u1EC6\\u0228\\u1E1C\\u0118\\u1E18\\u1E1A\\u0190\\u018E]/g,\n    I: /[\\u0049\\u24BE\\uFF29\\u00CC\\u00CD\\u00CE\\u0128\\u012A\\u012C\\u0130\\u00CF\\u1E2E\\u1EC8\\u01CF\\u0208\\u020A\\u1ECA\\u012E\\u1E2C\\u0197]/g,\n    O: /[\\u004F\\u24C4\\uFF2F\\u00D2\\u00D3\\u00D4\\u1ED2\\u1ED0\\u1ED6\\u1ED4\\u00D5\\u1E4C\\u022C\\u1E4E\\u014C\\u1E50\\u1E52\\u014E\\u022E\\u0230\\u00D6\\u022A\\u1ECE\\u0150\\u01D1\\u020C\\u020E\\u01A0\\u1EDC\\u1EDA\\u1EE0\\u1EDE\\u1EE2\\u1ECC\\u1ED8\\u01EA\\u01EC\\u00D8\\u01FE\\u0186\\u019F\\uA74A\\uA74C]/g,\n    OE: /[\\u0152]/g,\n    U: /[\\u0055\\u24CA\\uFF35\\u00D9\\u00DA\\u00DB\\u0168\\u1E78\\u016A\\u1E7A\\u016C\\u00DC\\u01DB\\u01D7\\u01D5\\u01D9\\u1EE6\\u016E\\u0170\\u01D3\\u0214\\u0216\\u01AF\\u1EEA\\u1EE8\\u1EEE\\u1EEC\\u1EF0\\u1EE4\\u1E72\\u0172\\u1E76\\u1E74\\u0244]/g,\n    a: /[\\u0061\\u24D0\\uFF41\\u1E9A\\u00E0\\u00E1\\u00E2\\u1EA7\\u1EA5\\u1EAB\\u1EA9\\u00E3\\u0101\\u0103\\u1EB1\\u1EAF\\u1EB5\\u1EB3\\u0227\\u01E1\\u00E4\\u01DF\\u1EA3\\u00E5\\u01FB\\u01CE\\u0201\\u0203\\u1EA1\\u1EAD\\u1EB7\\u1E01\\u0105\\u2C65\\u0250]/g,\n    ae: /[\\u00E6\\u01FD\\u01E3]/g,\n    c: /[\\u0063\\u24D2\\uFF43\\u0107\\u0109\\u010B\\u010D\\u00E7\\u1E09\\u0188\\u023C\\uA73F\\u2184]/g,\n    e: /[\\u0065\\u24D4\\uFF45\\u00E8\\u00E9\\u00EA\\u1EC1\\u1EBF\\u1EC5\\u1EC3\\u1EBD\\u0113\\u1E15\\u1E17\\u0115\\u0117\\u00EB\\u1EBB\\u011B\\u0205\\u0207\\u1EB9\\u1EC7\\u0229\\u1E1D\\u0119\\u1E19\\u1E1B\\u0247\\u025B\\u01DD]/g,\n    i: /[\\u0069\\u24D8\\uFF49\\u00EC\\u00ED\\u00EE\\u0129\\u012B\\u012D\\u00EF\\u1E2F\\u1EC9\\u01D0\\u0209\\u020B\\u1ECB\\u012F\\u1E2D\\u0268\\u0131]/g,\n    o: /[\\u006F\\u24DE\\uFF4F\\u00F2\\u00F3\\u00F4\\u1ED3\\u1ED1\\u1ED7\\u1ED5\\u00F5\\u1E4D\\u022D\\u1E4F\\u014D\\u1E51\\u1E53\\u014F\\u022F\\u0231\\u00F6\\u022B\\u1ECF\\u0151\\u01D2\\u020D\\u020F\\u01A1\\u1EDD\\u1EDB\\u1EE1\\u1EDF\\u1EE3\\u1ECD\\u1ED9\\u01EB\\u01ED\\u00F8\\u01FF\\u0254\\uA74B\\uA74D\\u0275]/g,\n    oe: /[\\u0153]/g,\n    u: /[\\u0075\\u24E4\\uFF55\\u00F9\\u00FA\\u00FB\\u0169\\u1E79\\u016B\\u1E7B\\u016D\\u00FC\\u01DC\\u01D8\\u01D6\\u01DA\\u1EE7\\u016F\\u0171\\u01D4\\u0215\\u0217\\u01B0\\u1EEB\\u1EE9\\u1EEF\\u1EED\\u1EF1\\u1EE5\\u1E73\\u0173\\u1E77\\u1E75\\u0289]/g\n  };\n\n\nlet numberOfImagesPerLayerExport = 2; // 2 => (original size, @2x), 4 => (original size, @2x, @3x, @4x)\n\nlet maximumImageWidthOrHeight = 16384;\n\nlet GLOBALNAMESINDEX_UNIQUENAME = 0;\nlet GLOBALNAMESINDEX_TYPE = 1;\nlet GLOBALNAMESINDEX_KEYVALUES = 2;\nlet GLOBALNAMESINDEX_RAWNAME = 3;\nlet GLOBALNAMESINDEX_PARENTTYPE = 4;\n\nlet TEMP_CONTEXT = {};\n\n\nlet POINT_DECIMAL_PRECISION = 5; // Number of decimals to export abscissa and ordinate of points\nlet ANGLE_DECIMAL_PRECISION = 3; \n\n\nfunction getUniqueNameFromIndexedData(data) {\n    return data[GLOBALNAMESINDEX_UNIQUENAME];\n}\n\n\nfunction getTypeFromIndexedData(data) {\n    return data[GLOBALNAMESINDEX_TYPE];\n}\n\n\nfunction getKeyValuesFromIndexedData(data) {\n    return data[GLOBALNAMESINDEX_KEYVALUES];\n}\n\n\nfunction getRawNameFromIndexedData(data) {\n    return data[GLOBALNAMESINDEX_RAWNAME];\n}\n\n\nfunction getParentTypeFromIndexedData(data) {\n    return data[GLOBALNAMESINDEX_PARENTTYPE];\n}\n\n\nfunction clearTempContext() {\n    TEMP_CONTEXT = {\n        availableSwatchIDs: [],\n        missingSwatches: {},\n        imageHashToFilePath: {}\n    };\n}\n\n\nfunction initDocumentContext(libraryImagesSubDir) {\n    clearTempContext();\n\n    let documentContext = {\n        libraryImagesSubDir: libraryImagesSubDir,\n        fontFiles: [],\n        sharedLayerStylesIndex: {},\n        sharedTextStylesIndex: {},\n        globalNamesIndex: {},\n        textsWithOutOfSyncStyle: {}\n    };\n\n    let sketch = require('sketch/dom');\n    let document = sketch.getSelectedDocument();\n\n    document.sharedLayerStyles.forEach(style => {\n        documentContext.sharedLayerStylesIndex[style.id] = style;\n    });\n\n    document.sharedTextStyles.forEach(style => {\n        documentContext.sharedTextStylesIndex[style.id] = style;\n    });\n\n    treePopulateGlobalNamesIndex(documentContext);\n    let nb = Object.keys(documentContext.globalNamesIndex).length;\n    log(\"Indexed elements : \" + nb);\n\n    let usedNativeSwatches = document.sketchObject.documentData().allSwatches();\n    if (usedNativeSwatches.length > 0) {\n        usedNativeSwatches.forEach(nativeSwatch => {\n            TEMP_CONTEXT.availableSwatchIDs.push(String(nativeSwatch.objectID()));\n        });\n    }\n\n    return documentContext;\n}\n\n\nfunction addFontFileToContext(context, fontFilePath) {\n    if (context && context.fontFiles && fontFilePath && !context.fontFiles.includes(fontFilePath))\n        context.fontFiles.push(fontFilePath);\n}\n\n\nfunction getFontFilesUsedByLayer(layer, result) {\n    if (layer) {\n        let fontFilePath = layerFontFilePath(layer);\n        if (fontFilePath && !result.includes(fontFilePath)) {\n            result.push(fontFilePath);\n        }\n\n        if (layer.layers && (layer.layers.length > 0)) {\n            layer.layers.forEach(subLayer => {\n                getFontFilesUsedByLayer(subLayer, result);\n            });\n        }\n    }\n}\n\n\nfunction addSymbolMasterOverridesToXml(symbolMaster, xmlRoot, documentContext){\n    if (symbolMaster.overrides){\n        let Xml = require(\"./xml.js\");\n        symbolMaster.overrides.forEach(overR => {\n            // NB: Since october 2022, Sketch allows to override font properties (weight, alignment, etc.) and colors\n            //     within Symbol instances without creating a text style or layer style for each variation\n            //     This plugin only supports the old overridable properties\n            if (overR.editable\n                && ((overR.property == \"image\") || (overR.property == \"textStyle\") || (overR.property == \"stringValue\") \n                    || (overR.property == \"layerStyle\") || (overR.property == \"symbolID\"))\n                ) {\n                let overrideTargetPath = treeBuildOverrideTargetPath(overR, documentContext.globalNamesIndex)\n                Xml.xmlAddElement(xmlRoot, \"overridable\", [\"property\", overR.property, \"on\", overrideTargetPath], null);\n            }\n        });\n    }\n}\n\n\nfunction treeIterateLayers(layers, parent, shallIgnoreSymbolMasters, rootDirPath, imagesSubDir, xmlRoot,\n                            documentContext, mask){\n    let Xml = require(\"./xml.js\");\n    let sketch = require('sketch/dom');\n    let document = sketch.getSelectedDocument();\n    let actualParent = parent; //parent may change during iteration (when finding masks)\n    let currentMask = null;\n    \n    for (let i = 0; layers && (i < layers.length); i++){\n        let l = layers[i]\n        let type = l.sketchObject.class()\n        let name = l.name;\n\n        // We skip special elements\n        if (name.startsWith(\"#\"))\n            continue\n\n        if ((type == \"MSSymbolMaster\") && shallIgnoreSymbolMasters){\n            continue;\n        } else if ((type == \"MSArtboardGroup\") || (type == \"MSSliceLayer\") || (type == \"MSHotspotLayer\")) {\n            continue;\n        } \n        \n        let indexedData = documentContext.globalNamesIndex[l.id];\n        if (!indexedData){\n            log(\"ERROR: could not find indexed data for \" + l.name + \" (\" + l.id + \") : ignore this element.\");\n            continue;\n        }\n        let actualName = getUniqueNameFromIndexedData(indexedData);\n        let actualType = getTypeFromIndexedData(indexedData);\n        let keyValues = getKeyValuesFromIndexedData(indexedData);\n\n        let isCustomClass = false;\n        \n        //handle special types that will add specific beacons in XML or require specific logics\n        if (actualType == \"includeLibrary\"){\n            let rawName = getRawNameFromIndexedData(indexedData);\n            let xmlCurrent = Xml.xmlAddElement(actualParent, \"include\", [\"name\", rawName], null);\n            if (keyValues.length > 0)\n                Xml.xmlAddCustomPropertiesToElement(xmlCurrent, keyValues);\n\n        } else if (actualType == \"includeExternal\") {\n            let xmlCurrent = Xml.xmlAddElement(actualParent, \"external\", [\"name\", actualName], null);\n            if (keyValues.length > 0)\n                Xml.xmlAddCustomPropertiesToElement(xmlCurrent, keyValues);\n            \n        } else if ((type == \"MSTextLayer\") && (actualType == \"includeData\")) {\n            let xmlCurrent = Xml.xmlAddElement(actualParent, \"data\", [\"name\", actualName], l.text);\n            if (keyValues.length > 0)\n                Xml.xmlAddCustomPropertiesToElement(xmlCurrent, keyValues);\n                \n        } else {\n            //FIXME: using internal Sketch API that might change in future versions\n            if (l._object.shouldBreakMaskChain()){\n                actualParent = parent; //restore original parent because we break mask chain with this element\n                currentMask = null;\n            }\n            \n            let xmlCurrent = Xml.xmlAddElement(actualParent, \"item\", [\"name\", actualName], null);\n\n            addFontFileToContext(documentContext, layerFontFilePath(l));\n            \n            if (type == \"MSSymbolInstance\") {\n                if (!l.master) {\n                    log(\"could not find the symbol master used by \" + l.name);\n                    log(\"\\t->Please check that it does not use an external symbol master that has not been made local.\")\n                    continue;\n                }\n\n                //Instance is from a specific class and will be handled as a future software component instance\n                let indexedDataSymbolMaster = documentContext.globalNamesIndex[l.master.id];\n                if (!indexedDataSymbolMaster) {\n                    log(\"could not find indexed data for \" + l.master.name);\n                    log(\"\\t->Please check that it is not an external symbol master that has not been made local.\")\n                    continue;\n                }\n                \n                actualType = getTypeFromIndexedData(indexedDataSymbolMaster); //get resolved type from master symbol\n                isCustomClass = true;\n                type = actualType; //this will relevantly block iteration on subelements at the end of this function\n                \n                //Symbol instances require specific management around overrides\n                //Overrides are stored \"as-is\" to be applied as property values during code generation.\n                if (l.overrides) {\n                    const sketchVersion = require('sketch/dom').version.sketch;\n                    let nb = l.overrides.length;\n                    let symbolOverridesHash = {};\n\n                    for (let j = 0; j < nb; j++) {\n                        let overR = l.overrides[j];\n                        let isEditable = overR.editable;\n                        let isDefault = overR.isDefault;\n\n                        // NB: Since october 2022, Sketch allows to override font properties (weight, alignment, etc.) and colors\n                        //     within Symbol instances without creating a text style or layer style for each variation\n                        //     This plugin only supports the old overridable properties\n                        if ((overR.property == \"image\") || (overR.property == \"textStyle\") || (overR.property == \"stringValue\") \n                            || (overR.property == \"layerStyle\") || (overR.property == \"symbolID\")) {\n                            let indexedDataOverride = documentContext.globalNamesIndex[overR.affectedLayer.id];\n                            let originalOverrideTargetPath = treeBuildOverrideTargetPath(overR, documentContext.globalNamesIndex);\n                            let overrideTargetPath = originalOverrideTargetPath;\n                            if (!indexedDataOverride){\n                                log(\"ERROR: could not find indexed data for \" + overR.affectedLayer.name + \" (\" + overR.affectedLayer.id + \"). Please check that this element is not rendered as an image.\");\n                                continue;\n                            }\n                            //log(\"handling override for \" + overR.affectedLayer.id + \" - \" + overR.affectedLayer.name + \" - \" +  + \" (\" + indexedDataOverride + \")\");\n\n                            // NB: Sketch 96 uses a new API: MSOverridePoint instead of MSAvailableOverride\n                            if (sketchVersion < 96) {\n                                // isDefault flag: handle false positive i.e. overrides that use the default value even if isDefault returns false\n                                // => it happens when:\n                                //  - a symbol overrides a text and this symbol is instantiated in other symbols\n                                //  - a graphic designer changes the style of an instance and then reselect the default style\n                                if (overR.sketchObject && (!overR.sketchObject.overrideValue() || (overR.sketchObject.defaultValue() == overR.sketchObject.currentValue()))) {\n                                    isDefault = true;\n                                }\n                            }\n\n                            //handle possible nesting of overrides\n                            let overrideParent = xmlCurrent; //set default parent for override data (may change with symbol overrides)\n\n                            let prefix = overrideTargetPath;\n                            let dotIndex = overrideTargetPath.lastIndexOf(\".\");\n                            while (dotIndex >= 0) {\n                                prefix = prefix.substring(0, dotIndex);\n                                //log(\"check prefix \" + prefix + \" for \" + overrideTargetPath);\n                                if ((prefix.length > 0) & symbolOverridesHash.hasOwnProperty(prefix)) {\n                                    //log(\"found prefix \" + prefix + \" for \" + overrideTargetPath);\n                                    overrideParent = symbolOverridesHash[prefix];\n                                    overrideTargetPath = overrideTargetPath.substring(dotIndex + 1, overrideTargetPath.length);\n                                    break;\n                                } else {\n                                    dotIndex = prefix.lastIndexOf(\".\");\n                                }\n                            }\n                            \n                            if (overR.property == \"image\") {\n                                let imgHash = overR.value.sketchObject.hash();\n                                let imgRelativePath = \"\";\n                                if (TEMP_CONTEXT.imageHashToFilePath.hasOwnProperty(imgHash)) {\n                                    imgRelativePath = TEMP_CONTEXT.imageHashToFilePath[imgHash];\n                                } else if (!isDefault) {\n                                    let imgUid = overR.affectedLayer.id + \"__\" + imgHash;\n                                    imgRelativePath = imagesSubDir + imgUid + \".png\";\n                                    let imgData = overR.value.nsdata;\n                                    imgData.writeToFile_atomically(NSString.stringWithFormat(\"%@/%@\", rootDirPath, imgRelativePath), false);\n                                    TEMP_CONTEXT.imageHashToFilePath[imgHash] = imgRelativePath;\n                                } else {\n                                    let targetName = getUniqueNameFromIndexedData(indexedDataOverride);\n                                    imgRelativePath = documentContext.libraryImagesSubDir + camelize(targetName) + \"__\" + overR.affectedLayer.id;\n                                }\n                                Xml.xmlAddElement(overrideParent, \"override\", [\"property\", overR.property, \"value\", imgRelativePath, \"on\", overrideTargetPath, \"editable\", isEditable, \"isDefault\", isDefault], null);\n                            } else if (overR.property == \"textStyle\") {\n                                let currentOver =Xml.xmlAddElement(overrideParent, \"override\", [\"property\", overR.property, \"value\", overR.value, \"on\", overrideTargetPath, \"editable\", isEditable, \"isDefault\", isDefault], null);\n                                if (documentContext.sharedTextStylesIndex[overR.value]) {\n                                    let affectedLayerUsesAnOutOfSyncStyle = documentContext.textsWithOutOfSyncStyle.hasOwnProperty(overR.affectedLayer.id);\n                                    let overrideStyle = documentContext.sharedTextStylesIndex[overR.value].style;\n\n                                    if (affectedLayerUsesAnOutOfSyncStyle) {\n                                       Xml.xmlAddElement(currentOver, \"textStyle\", [\"sharedStyleId\", overR.value, \"affectedLayerStyleIsOutOfSync\", true], null);\n                                    } else {\n                                       Xml.xmlAddElement(currentOver, \"textStyle\", [\"sharedStyleId\", overR.value], null);\n                                    }\n\n                                    addFontFileToContext(documentContext, styleFontFilePath(overrideStyle));\n                                } else {\n                                    log(\"could not find textStyle\" + overR.value + \" to override a symbol instance of \"\n                                        + l.name + \". This override will be ignored\");\n                                    log(\"\\t->Please check that it is not an external text style that has not been made local.\")\n                                    continue;\n                                }\n                            } else if (overR.property == \"layerStyle\") {\n                                let currentOver =Xml.xmlAddElement(overrideParent, \"override\", [\"property\", overR.property, \"value\", overR.value, \"on\", overrideTargetPath, \"editable\", isEditable, \"isDefault\", isDefault], null);\n                                if (documentContext.sharedLayerStylesIndex[overR.value]) {\n                                    let styleXML =Xml.xmlAddElement(currentOver, \"layerStyle\", null, null);\n                                    treeAddAttributesFromLayerStyle(styleXML, type, documentContext.sharedLayerStylesIndex[overR.value].style);\n                                } else {\n                                    log(\"could not find layerStyle\" + overR.value + \" to override a symbol instance of \"\n                                        + l.name + \". This override will be ignored\");\n                                    log(\"\\t->Please check that it is not an external layer style that has not been made local.\")\n                                    continue;\n                                }\n                            } else if (overR.property == \"stringValue\") {\n                               Xml.xmlAddElement(overrideParent, \"override\", [\"property\", overR.property, \"value\", escapeCharactersInUnicodePrivateUseArea(overR.value), \"on\", overrideTargetPath, \"editable\", isEditable, \"isDefault\", isDefault], null);\n                            } else if (overR.property == \"symbolID\") {\n                                let indexexDataOldSymbol = documentContext.globalNamesIndex[overR.affectedLayer.master.id];\n                                if (!indexexDataOldSymbol){\n                                    log(\"could not find indexed data for SymbolMaster \" + overR.affectedLayer.master.name + \" to override a symbol instance of \"\n                                        + l.name + \". This override will be ignored\");\n                                    log(\"\\t->Please check that it is not an external master that has not been made local.\")\n                                    continue;\n                                }\n                                \n                                let oldType = getTypeFromIndexedData(indexexDataOldSymbol);\n                                let newType = \"\"; //may be empty id \"no symbol\" override\n                                if (overR.value.length > 0) {\n                                    let newSymbol = document.getSymbolMasterWithID(overR.value);\n                                    if (newSymbol) {\n                                        let indexedDataNewSymbol = documentContext.globalNamesIndex[newSymbol.id];\n                                        if (!indexedDataNewSymbol){\n                                            log(\"could not find indexed data for SymbolMaster \" + newSymbol.name + \" to override a symbol instance of \"\n                                                + l.name + \". This override will be ignored\");\n                                            log(\"\\t->Please check that it is not an external master that has not been made local.\")\n                                            break;\n                                        }\n                                        newType = getTypeFromIndexedData(indexedDataNewSymbol); //symbol extracted class\n                                    } else {\n                                        log(\"could not find SymbolMaster with ID \" + overR.value + \" to override a symbol instance of \"\n                                        + l.name + \". This override will be ignored\");\n                                        log(\"\\t->Please check that it is not an external master that has not been made local.\")\n                                        break;\n                                    }\n                                }\n\n                                let xmlSymbolOverride = Xml.xmlAddElement(overrideParent, \"override\", [\"property\", overR.property, \"newType\", newType, \"oldType\", oldType, \"on\", overrideTargetPath, \"editable\", isEditable, \"isDefault\", isDefault], null);\n                                if (!isDefault)\n                                    symbolOverridesHash[originalOverrideTargetPath] = xmlSymbolOverride;\n                            }\n                        }\n                    }\n                }\n                Xml.xmlAddAttributesToElement(xmlCurrent, [\"symbolMaster\", getUniqueNameFromIndexedData(indexedDataSymbolMaster), \"type\", actualType, \"symbolMasterWidth\", Math.ceil(l.master.frame.width), \"symbolMasterHeight\", Math.ceil(l.master.frame.height)]);\n                \n                let parentType = getParentTypeFromIndexedData(indexedDataSymbolMaster);\n                if (parentType)\n                    Xml.xmlAddAttributesToElement(xmlCurrent, [\"symbolMasterParentType\", parentType]);\n                \n            } else {\n                //other types are handled without anything specific\n                Xml.xmlAddAttributesToElement(xmlCurrent, [\"type\", actualType]);\n                //NB: overrides are applied if necessary when calling treeAddAttributesFromLayerData & co. below.\n                //We do not apply overrides on the model directly as it would modify\n                //the original Sketch file...\n            }\n            \n            //Masks\n            //FIXME: using internal Sketch API that might change in future versions\n            if (l._object.hasClippingMask()) {\n                //log(\"\" + actualName + \" is a mask\");\n                Xml.xmlAddAttributesToElement(xmlCurrent, [\"isMask\", 1]);\n                actualParent = xmlCurrent;\n                currentMask = l;\n            }\n            \n            //Add custom keys and values extracted from layer name\n            if (keyValues.length > 0)\n                Xml.xmlAddCustomPropertiesToElement(xmlCurrent, keyValues);\n            \n            //add layer data\n            //FIXME: compute x/y/width/height changes due to masks and mask chains breaks reparenting\n            //FIXME: also handle proper size for clipped images\n            let shallBlockBecauseExportExists = treeAddAttributesFromLayerData(actualName, xmlCurrent, type, l, rootDirPath, imagesSubDir, isCustomClass, currentMask, actualType);\n\n            if (!shallBlockBecauseExportExists && l && (type == \"MSArtboardGroup\" || type == \"MSLayerGroup\" || type == \"MSShapeGroup\"\n                      || type == \"MSSymbolMaster\" || type == \"MSSymbolInstance\")){\n                treeIterateLayers(l.layers, xmlCurrent, shallIgnoreSymbolMasters, rootDirPath, imagesSubDir, xmlRoot, documentContext, currentMask);\n            }\n        }\n    }\n}\n\n\nfunction treeAddAttributesFromPointData(currentXMLElement, point){\n    if (point && point.sketchObject) {\n        let Xml = require(\"./xml.js\");\n        let Utils = require(\"./utils.js\");\n        \n        let pointType = point.pointType;\n\n        let pointAttributes = [];\n        pointAttributes.push(\"pointType\");\n        pointAttributes.push(point.pointType);\n        pointAttributes.push(\"x\");\n        pointAttributes.push(Utils.roundWithDecimalPrecision(point.point.x, POINT_DECIMAL_PRECISION));\n        pointAttributes.push(\"y\");\n        pointAttributes.push(Utils.roundWithDecimalPrecision(point.point.y, POINT_DECIMAL_PRECISION));\n\n        if (pointType == 'Straight') {\n            pointAttributes.push(\"cornerRadius\");\n            pointAttributes.push(point.cornerRadius);\n\n        } else if (pointType == 'Undefined') {\n            //TODO: check if we can really obtain a point with an undefined type\n            let nativePoint = point.sketchObject;\n\n            if (nativePoint.hasCurveFrom()) {\n                pointAttributes.push(\"curveFromX\");\n                pointAttributes.push(Utils.roundWithDecimalPrecision(point.curveFrom.x, POINT_DECIMAL_PRECISION));\n                pointAttributes.push(\"curveFromY\");\n                pointAttributes.push(Utils.roundWithDecimalPrecision(point.curveFrom.y, POINT_DECIMAL_PRECISION));\n            }\n\n            if (nativePoint.hasCurveTo()) {\n                pointAttributes.push(\"curveToX\");\n                pointAttributes.push(Utils.roundWithDecimalPrecision(point.curveTo.x, POINT_DECIMAL_PRECISION));\n                pointAttributes.push(\"curveToY\");\n                pointAttributes.push(Utils.roundWithDecimalPrecision(point.curveTo.y, POINT_DECIMAL_PRECISION));\n            }\n            \n            pointAttributes.push(\"cornerRadius\");\n            pointAttributes.push(point.cornerRadius);\n\n        } else if (pointType != 'Undefined') {\n            pointAttributes.push(\"curveFromX\");\n            pointAttributes.push(Utils.roundWithDecimalPrecision(point.curveFrom.x, POINT_DECIMAL_PRECISION));\n            pointAttributes.push(\"curveFromY\");\n            pointAttributes.push(Utils.roundWithDecimalPrecision(point.curveFrom.y, POINT_DECIMAL_PRECISION));\n            pointAttributes.push(\"curveToX\");\n            pointAttributes.push(Utils.roundWithDecimalPrecision(point.curveTo.x, POINT_DECIMAL_PRECISION));\n            pointAttributes.push(\"curveToY\");\n            pointAttributes.push(Utils.roundWithDecimalPrecision(point.curveTo.y, POINT_DECIMAL_PRECISION));\n        }\n\n       Xml.xmlAddElement(currentXMLElement, \"point\", pointAttributes, null);\n\n    }  else console.warn(\"treeAddAttributesFromPointData: invalid argument 'point'\");\n}\n\n\nfunction treeAddTextBehaviour(currentXMLElement, layer) {\n    if (!isTextLayer(layer))\n        return;\n\n    let Xml = require(\"./xml.js\");\n    Xml.xmlAddAttributesToElement(currentXMLElement, [\"textBehaviour\", layerTextBehaviour(layer)]);\n}\n\n\nfunction treeAddAttributesFromTextStyle(currentXMLElement, layerOrSharedTextStyle, sharedTextStyle) {\n    let Xml = require(\"./xml.js\");\n\n    if (!layerOrSharedTextStyle)\n        return;\n\n    let isText = isTextLayer(layerOrSharedTextStyle);\n    let style = layerOrSharedTextStyle.style;\n    let sharedStyle = (sharedTextStyle ? sharedTextStyle.style : null); \n    if (!style)\n        return;\n\n    let attributes = [];\n\n    if (!sharedStyle || (style.opacity !== sharedStyle.opacity)) {\n        attributes.push(\"opacity\");\n        attributes.push(style.opacity);\n    }\n\n    if (!sharedStyle || (style.blendingMode !== sharedStyle.blendingMode)) {\n        attributes.push(\"blendingMode\");\n        attributes.push(style.blendingMode);\n    }\n\n    let textBehaviour = \"autoWidth\";\n    if (isText) {\n        textBehaviour = layerTextBehaviour(layerOrSharedTextStyle);\n\n        attributes.push(\"textBehaviour\");\n        attributes.push(textBehaviour);\n    }\n\n    if (!sharedStyle || (style.alignment != sharedStyle.alignment)) {\n        attributes.push(\"alignment\");\n        attributes.push(style.alignment);\n    }\n    \n    // Special case: Sketch does not reset the value of verticalAlignment when we switch from \"fixedSize\" to \"autoWidth\" or \"autoHeight\"\n    let verticalAlignment = (!isText || (textBehaviour === \"fixedSize\")) ? style.verticalAlignment : \"top\";\n    if (!sharedStyle || (verticalAlignment != sharedStyle.verticalAlignment)) {\n        attributes.push(\"verticalAlignment\");\n        attributes.push(verticalAlignment);\n    }\n\n    if (!sharedStyle || (style.textColor != sharedStyle.textColor)) {\n        attributes.push(\"textColor\");\n        attributes.push(getTextColorAsHexValueOrSwatchReference(style));\n    }\n\n    if (!sharedStyle || (style.lineHeight != sharedStyle.lineHeight)) {\n        if (style.lineHeight) {\n            attributes.push(\"lineHeight\");\n            attributes.push(style.lineHeight);\n        }\n    }\n\n    if (!sharedStyle || (style.paragraphSpacing != sharedStyle.paragraphSpacing)) {\n        attributes.push(\"paragraphSpacing\");\n        attributes.push(style.paragraphSpacing);\n    }\n\n    // The following properties define our font\n    let needFontFamily = (!sharedStyle || (style.fontFamily != sharedStyle.fontFamily));\n    let needFontSize = (!sharedStyle || (style.fontSize != sharedStyle.fontSize));\n    let needFontWeight = (!sharedStyle || (style.fontWeight != sharedStyle.fontWeight));\n    let needFontStyle = (!sharedStyle || (style.fontStyle != sharedStyle.fontStyle));\n    let needFontVariant = (!sharedStyle || (style.fontVariant != sharedStyle.fontVariant));\n    let needFontStretch = (!sharedStyle || (style.fontStretch != sharedStyle.fontStretch));\n    let needKerning = (!sharedStyle || (style.kerning != sharedStyle.kerning));\n    let needTextTransform = (!sharedStyle || (style.textTransform != sharedStyle.textTransform));\n    let needTextUnderline = (!sharedStyle || (style.textUnderline != sharedStyle.textUnderline));\n    let needTextStrikethrough = (!sharedStyle || (style.textStrikethrough != sharedStyle.textStrikethrough));\n\n    if (needFontFamily || needFontSize || needFontWeight || needFontStyle || needFontVariant\n        || needFontStretch || needKerning || needTextTransform || needTextUnderline || needTextStrikethrough) {\n        attributes.push(\"fontFamily\");\n        attributes.push(style.fontFamily);\n\n        attributes.push(\"fontSize\");\n        attributes.push(style.fontSize);\n\n        attributes.push(\"fontWeight\");\n        attributes.push(style.fontWeight);\n\n        if (style.fontStyle) {\n            attributes.push(\"fontStyle\");\n            attributes.push(style.fontStyle);\n        }\n\n        if (style.fontVariant) {\n            attributes.push(\"fontVariant\");\n            attributes.push(style.fontVariant);\n        }\n\n        if (style.fontStretch) {\n            attributes.push(\"fontStretch\");\n            attributes.push(style.fontStretch);\n        }\n\n         // NB: we also need to export raw properties to help translation from Sketch to UI toolkits\n        attributes.push(\"fontPostscriptName\");\n        attributes.push(fontPostscriptNameFromStyle(style));\n        attributes.push(\"fontStyleName\");\n        attributes.push(fontStyleNameFromStyle(style));\n\n        if (style.kerning) {\n            attributes.push(\"kerning\");\n            attributes.push(style.kerning);\n        }\n\n        attributes.push(\"textTransform\");\n        attributes.push(style.textTransform);\n\n        if (style.textUnderline) {\n            attributes.push(\"textUnderline\");\n            attributes.push(style.textUnderline);\n        }\n\n        if (style.textStrikethrough) {\n            attributes.push(\"textStrikethrough\");\n            attributes.push(style.textStrikethrough);\n        }\n    }\n\n    Xml.xmlAddAttributesToElement(currentXMLElement, attributes);\n}\n\n\nfunction treeAddAttributesFromLayerStyle(currentXMLElement, type, style) {\n    if (!style)\n        return;\n\n    let Xml = require(\"./xml.js\");\n    let attributes = [];\n\n    attributes.push(\"opacity\");\n    attributes.push(style.opacity);\n    \n    attributes.push(\"blendingMode\");\n    attributes.push(style.blendingMode);\n\n    //TODO: blur, shadows, innershadows\n    \n    if (style.borderOptions) {\n        if (style.borderOptions.startArrowhead != 'None') {\n            attributes.push(\"startArrowhead\");\n            attributes.push(style.borderOptions.startArrowhead);\n        }\n        if (style.borderOptions.endArrowhead != 'None') {\n            attributes.push(\"endArrowhead\");\n            attributes.push(style.borderOptions.endArrowhead);\n        }\n        let dashPatternLength = style.borderOptions.dashPattern.length;\n        if (dashPatternLength != 0) {\n            attributes.push(\"dashPattern\");\n            let dashPatternString = style.borderOptions.dashPattern.join(',');\n            if (dashPatternLength % 2 == 0) {\n                attributes.push(dashPatternString);\n            } else {\n                //NB: In most UI toolkits, the dash pattern must be specified as an even \n                // number of values that specify the lengths of alternating dashes and gaps\n                attributes.push(dashPatternString + \",\" + dashPatternString);\n            }\n        }\n        if (style.borderOptions.lineEnd != 'Butt') {\n            attributes.push(\"lineEnd\");\n            attributes.push(style.borderOptions.lineEnd);\n        }\n        if (style.borderOptions.lineJoin != 'Miter') {\n            attributes.push(\"lineJoin\");\n            attributes.push(style.borderOptions.lineJoin);\n        }\n    }\n\n    if (style.fills.length > 0) {\n        style.fills.forEach(fill => {\n            let xmlFill =Xml.xmlAddElement(currentXMLElement, \"fill\", null, null);\n            let fillAttributes = [];\n            let fillType = fill.fillType;\n            fillAttributes.push(\"fillType\");\n            fillAttributes.push(fillType);\n            fillAttributes.push(\"enabled\");\n            fillAttributes.push(fill.enabled);\n\n            if (fillType == \"Color\") {\n                fillAttributes.push(\"color\");\n                fillAttributes.push(getFillColorAsHexValueOrSwatchReference(fill));\n\n            } else if (fillType == \"Gradient\") {\n                let gradient = fill.gradient;\n                let gradientType = gradient.gradientType;\n                fillAttributes.push(\"gradientType\");\n                fillAttributes.push(gradientType);\n                fillAttributes.push(\"fromX\");\n                fillAttributes.push(gradient.from.x);\n                fillAttributes.push(\"fromY\");\n                fillAttributes.push(gradient.from.y);\n                fillAttributes.push(\"toX\");\n                fillAttributes.push(gradient.to.x);\n                fillAttributes.push(\"toY\");\n                fillAttributes.push(gradient.to.y);\n\n                if (gradientType == \"Radial\") {\n                    fillAttributes.push(\"aspectRatio\");\n                    fillAttributes.push(gradientType.aspectRatio);\n                }\n\n                gradient.stops.forEach(stop => {\n                    let stopAttributes = [];\n                    stopAttributes.push(\"position\");\n                    stopAttributes.push(stop.position);\n                    stopAttributes.push(\"color\");\n                    stopAttributes.push(rgbaToArgbOrRgb(stop.color));\n                    \n                   Xml.xmlAddElement(xmlFill, \"stop\", stopAttributes, null);\n                });\n\n            } else if (fillType == \"Pattern\") {\n                fillAttributes.push(\"patternType\");\n                fillAttributes.push(fill.pattern.patternType);\n                fillAttributes.push(\"tileScale\");\n                fillAttributes.push(fill.pattern.tileScale);\n                //TODO: image\n            }\n\n            Xml.xmlAddAttributesToElement(xmlFill, fillAttributes);     \n        });\n    }\n   \n    if (style.borders.length > 0) {\n        style.borders.forEach(border => {\n            let xmlBorder =Xml.xmlAddElement(currentXMLElement, \"border\", null, null);\n            let borderAttributes = [];\n            let fillType = border.fillType;\n            borderAttributes.push(\"fillType\");\n            borderAttributes.push(fillType);\n            borderAttributes.push(\"thickness\");\n            borderAttributes.push(border.thickness);\n            borderAttributes.push(\"position\");\n            borderAttributes.push(border.position);\n            borderAttributes.push(\"enabled\");\n            borderAttributes.push(border.enabled);\n\n            if (fillType == \"Color\") {\n                borderAttributes.push(\"color\");\n                borderAttributes.push(getFillColorAsHexValueOrSwatchReference(border));\n\n            } else if (fillType == \"Gradient\") {\n                let gradient = border.gradient;\n                let gradientType = gradient.gradientType;\n                borderAttributes.push(\"gradientType\");\n                borderAttributes.push(gradientType);\n                borderAttributes.push(\"fromX\");\n                borderAttributes.push(gradient.from.x);\n                borderAttributes.push(\"fromY\");\n                borderAttributes.push(gradient.from.y);\n                borderAttributes.push(\"toX\");\n                borderAttributes.push(gradient.to.x);\n                borderAttributes.push(\"toY\");\n                borderAttributes.push(gradient.to.y);\n\n                if (gradientType == \"Radial\") {\n                    borderAttributes.push(\"aspectRatio\");\n                    borderAttributes.push(gradientType.aspectRatio);\n                }\n\n                gradient.stops.forEach(stop => {\n                    let stopAttributes = [];\n                    stopAttributes.push(\"position\");\n                    stopAttributes.push(stop.position);\n                    stopAttributes.push(\"color\");\n                    stopAttributes.push(rgbaToArgbOrRgb(stop.color));\n                    \n                   Xml.xmlAddElement(xmlBorder, \"stop\", stopAttributes, null);\n                });\n            }\n\n            Xml.xmlAddAttributesToElement(xmlBorder, borderAttributes);\n        });\n    }\n\n    Xml.xmlAddAttributesToElement(currentXMLElement, attributes);\n}\n\n\nfunction treeAddAttributesFromLayerData(name, currentXMLElement, type, layer, rootDirPath, imagesSubDir,\n                                        isCustomClass, currentMask, actualType){\n    /*\n    return true if item shall stop iteration, generally because it is renderer as an image or has exports\n    return false if item allows iterations\n    */\n    let Xml = require(\"./xml.js\");\n    let Utils = require(\"./utils.js\");\n    let attributes = [];\n    \n    attributes.push(\"id\");\n    attributes.push(layer.id);\n    \n    //generic attributes\n    if (layer.locked){\n        attributes.push(\"locked\");\n        attributes.push(\"1\");\n    }\n    if (layer.hidden){\n        attributes.push(\"hidden\");\n        attributes.push(\"1\");\n    }\n    if (layer.transform){\n        //NB: layer.transform.rotation wraps layer.sketchObject.userVisibleRotation() \n        //     that matches what users see in the inspector which may be different \n        //     from the raw `rotation` value\n        //     Here, we need the raw rotation because the generated code will apply a rotation\n        //\n        //NB: layer.sketchObject.userVisibleRotation and layer.sketchObject.rotation don't use the same rotation direction\n        //    layer.sketchObject.userVisibleRotation  is clockwise, layer.sketchObject.rotation is counterclockwise\n        let rotation = Utils.roundWithDecimalPrecision(-layer.sketchObject.rotation(), ANGLE_DECIMAL_PRECISION);\n\n        if (rotation !== 0) {\n            attributes.push(\"rotation\");\n            attributes.push(rotation);\n        }\n        if (layer.transform.flippedHorizontally){\n            attributes.push(\"flippedHorizontally\");\n            attributes.push(\"1\");\n        }\n        if (layer.transform.flippedVertically){\n            attributes.push(\"flippedVertically\");\n            attributes.push(\"1\");\n        }\n    }\n    if (layer.sketchObject.hasFixedWidth()){\n        attributes.push(\"hasFixedWidth\");\n        attributes.push(\"1\");\n    }\n    if (layer.sketchObject.hasFixedHeight()){\n        attributes.push(\"hasFixedHeight\");\n        attributes.push(\"1\");\n    }\n    if (layer.sketchObject.hasFixedLeft()){\n        attributes.push(\"hasFixedLeft\");\n        attributes.push(\"1\");\n        // NB: fixedLeft is x\n    }\n    if (layer.sketchObject.hasFixedTop()){\n        attributes.push(\"hasFixedTop\");\n        attributes.push(\"1\");\n        // NB: fixedTop is y\n    }\n    if (layer.sketchObject.hasFixedRight()){\n        attributes.push(\"hasFixedRight\");\n        attributes.push(\"1\");\n        attributes.push(\"fixedRight\");\n        attributes.push(layer.parent ? Utils.roundBy(layer.parent.frame.width - (layer.frame.x + layer.frame.width), 0.5) : 0);\n    }\n    if (layer.sketchObject.hasFixedBottom()){\n        attributes.push(\"hasFixedBottom\");\n        attributes.push(\"1\");\n        attributes.push(\"fixedBottom\");\n        attributes.push(layer.parent ? Utils.roundBy(layer.parent.frame.height - (layer.frame.y + layer.frame.height), 0.5) : 0);\n    }\n\n\n    if (layer.frame){\n        // NB: one decimal precision to allow sharp rendering if we use a centered border (BorderPosition = Centered) with an odd thickness value\n        //     If the thickness value is even (2, 4, etc.), x and y must be integer values; whereas if the thickness value is off (1, 3, etc.), \n        //     x and y must be decimal values ending with '.5' (half pixel offset)\n        attributes.push(\"x\");\n        attributes.push(Utils.roundBy(layer.frame.x, 0.5));\n        attributes.push(\"y\");\n        attributes.push(Utils.roundBy(layer.frame.y, 0.5));\n        attributes.push(\"width\");\n        attributes.push(Math.ceil(layer.frame.width));\n        attributes.push(\"height\");\n        attributes.push(Math.ceil(layer.frame.height));\n    }\n\n    //flows\n    if (layer.flow && layer.flow.target){\n       Xml.xmlAddElement(currentXMLElement, \"flow\",\n                      [\"targetName\", layer.flow.target.name,\n                       \"targetId\", layer.flow.targetId,\n                       \"type\", layer.flow.animationType], null);\n    }\n    \n    let renderingAsImage = false;\n    //handle unsupported types by rendering them as an image\n    //NB: supported types are at the moment : text, rectangle, image, group, window\n    //NB: groups come from MSLayerGroup and MSSymbolInstance\n    //See type conversions at the beginning of treeParseName\n    if (!isCustomClass && !isSupportedLayer(layer)){\n        //we have an unsupported type => render it as an image\n        treeForceImageExport(layer, currentXMLElement, rootDirPath, imagesSubDir, name, type);\n        renderingAsImage = true;\n    }\n    \n    //handle images with no export by manually generating image\n    if ((type == \"MSBitmapLayer\") && layer.exportFormats && (layer.exportFormats.length == 0)){\n        treeExportBitmapLayer(layer, currentXMLElement, rootDirPath, imagesSubDir, name, type);\n        renderingAsImage = true;\n    }\n\n    if (renderingAsImage){\n        Xml.xmlAddAttributesToElement(currentXMLElement, attributes);\n        return true;\n    }\n    \n    //exports\n    let hasExports = false;\n    // NB: we don't want to export artboards or symbol masters as images\n    if (layer.exportFormats && (layer.exportFormats.length > 0) && canExportTypeAsImage(type)) {\n        hasExports = treeAddImageExport(name, layer, currentXMLElement, rootDirPath, imagesSubDir);\n    }\n\n    if (hasExports){\n        //this part of the tree will be rendered as an image\n        //=> add already collected elements and return now\n        Xml.xmlAddAttributesToElement(currentXMLElement, attributes);\n        //log(\"abort style inspection because layer has exports (\" + layer.name + \")\");\n        return true;\n    }\n    \n    //style\n    if (type == \"MSArtboardGroup\" || type == \"MSLayerGroup\" || type == \"MSShapeGroup\"\n        || type == \"MSOvalShape\" || type == \"MSRectangleShape\" || type == \"MSPolygonShape\" || type == \"MSStarShape\" || type == \"MSTriangleShape\"\n        || type == \"MSShapePathLayer\" || type == \"MSBitmapLayer\" || type == \"MSTextLayer\" || type == \"MSSliceLayer\"\n        || isCustomClass){\n\n        let style = layer.style;\n        if (style) {\n            if (type == \"MSTextLayer\") {\n                if (layer.sharedStyle) {\n                    attributes.push(\"useSharedStyle\");\n                    attributes.push(1);\n                    attributes.push(\"sharedStyleId\");\n                    attributes.push(layer.sharedStyleId);\n    \n                    if (layer.sketchObject.isSharedStyleOutOfSync()) {\n                        attributes.push(\"isSharedStyleOutOfSync\");\n                        attributes.push(1);\n                        treeAddAttributesFromTextStyle(currentXMLElement, layer, layer.sharedStyle);\n                    } else {\n                        // textBehaviour is not defined by shared styles\n                        treeAddTextBehaviour(currentXMLElement, layer);\n                    }\n                } \n                else {\n                    treeAddAttributesFromTextStyle(currentXMLElement, layer, null);\n                }\n            }\n            else {\n                if (layer.sharedStyle) {\n                    attributes.push(\"useSharedStyle\");\n                    attributes.push(1);\n                } \n                treeAddAttributesFromLayerStyle(currentXMLElement, type, style);\n            }\n        }\n    }\n    \n    //points\n    if (type == \"MSShapePathLayer\" || type == \"MSOvalShape\" || type == \"MSRectangleShape\" || type == \"MSPolygonShape\" || type == \"MSStarShape\" || type == \"MSTriangleShape\" || type == \"MSShapeGroup\"){\n        attributes.push(\"shapeType\");\n        attributes.push(layer.shapeType);\n        attributes.push(\"closed\");\n        if (layer.closed){\n            attributes.push(\"1\");\n        }else{\n            attributes.push(\"0\");\n        }\n        let points = layer.points;\n        if (points){\n            points.forEach(point => {\n                treeAddAttributesFromPointData(currentXMLElement, point);\n            });\n        }\n    }\n    \n    //specific attributes per type\n    if (type == \"MSTextLayer\"){\n        let text = layer.text;\n        if (text)\n           Xml.xmlAddElement(currentXMLElement, \"content\", null, escapeCharactersInUnicodePrivateUseArea(text));\n    } else if (type == \"MSArtboardGroup\"){\n        if (layer.background && layer.background.enabled && layer.background.includedInExport){\n            attributes.push(\"hasBackground\");\n            attributes.push(\"1\");\n            attributes.push(\"backgroundColor\");\n            attributes.push(getBackgroundColorAsHexValueOrSwatchReference(layer));        \n        }        \n    }\n    \n    Xml.xmlAddAttributesToElement(currentXMLElement, attributes);\n    return false;\n}\n\n\nfunction treeExportBitmapLayer(layer, currentXMLElement, rootDirPath, imagesSubDir, name, type){\n    if (isBitmapLayer(layer) && layer.image && isEmptyStyle(layer.style)){\n        // No style => we can directly export the source of this bitmap layer\n        let Xml = require(\"./xml.js\");\n\n        let imgHash = layer.image.sketchObject.hash();\n        let imgRelativePath = \"\";\n        if (TEMP_CONTEXT.imageHashToFilePath.hasOwnProperty(imgHash)) {\n            imgRelativePath = TEMP_CONTEXT.imageHashToFilePath[imgHash];\n        } else {\n            if (!rootDirPath.endsWith(\"/\")) {\n                rootDirPath += \"/\";\n            }\n        \n            if ((imagesSubDir.length > 0) && !imagesSubDir.endsWith(\"/\")) {\n                imagesSubDir += \"/\";\n            }\n        \n            //NB: strange behavior - layer.id is undefined is we try to build a string BUT exists if we use console.log\n            //let toto  = layer.id;console.log(\"Exists \" + layer.id + \" -- \" + toto);\n            // We add our objectID to avoid conflict between different symbols and/or artboards\n            let imgUid = camelize(name) + \"__\" + layer.sketchObject.objectID();\n            imgRelativePath = imagesSubDir + imgUid + \".png\";\n\n            let imgData = layer.image.nsdata;\n            imgData.writeToFile_atomically(NSString.stringWithFormat(\"%@%@\", rootDirPath, imgRelativePath), false);\n            TEMP_CONTEXT.imageHashToFilePath[imgHash] = imgRelativePath;\n        }\n\n        Xml.xmlAddAttributesToElement(currentXMLElement, [\"hasExport\", 1, \n                                                          \"type\", \"image\", \n                                                          \"opacity\", layer.style.opacity,\n                                                          \"topInset\", 0, \n                                                          \"bottomInset\", 0, \n                                                          \"leftInset\", 0,  \n                                                          \"rightInset\", 0\n                                                         ]);\n                         \n        Xml.xmlAddElement(currentXMLElement, \"export\", [\"format\", \"png\",\n                                                        \"size\", \"1x\",\n                                                        \"prefix\", \"\",\n                                                        \"suffix\", \"\",\n                                                        \"file\", imgRelativePath\n                                                       ] , null);                                                   \n    } else {\n        // Our layer has a style (fill, border, shadow, blur)\n        // => we export it as an image to obtain an image with style applied\n        treeForceImageExport(layer, currentXMLElement, rootDirPath, imagesSubDir, name, type);\n    }\n}\n\n\nfunction treeForceImageExport(layer, currentXMLElement, rootDirPath, imagesSubDir, name, type){\n    let Xml = require(\"./xml.js\");\n    let Utils = require(\"./utils.js\");\n\n    if (!rootDirPath.endsWith(\"/\")) {\n        rootDirPath += \"/\";\n    }\n\n    if ((imagesSubDir.length > 0) && !imagesSubDir.endsWith(\"/\")) {\n        imagesSubDir += \"/\";\n    }\n\n    let exportPath = rootDirPath + imagesSubDir;\n\n    //NB: strange behavior - layer.id is undefined is we try to build a string BUT exists if we use console.log\n    //let toto  = layer.id;console.log(\"Exists \" + layer.id + \" -- \" + toto);\n    // We add our objectID to avoid conflict between different symbols and/or artboards\n    name = camelize(name) + \"__\" + layer.sketchObject.objectID();\n\n    // NB: Sketch fails to generate big images. Thus, we must ensure that we don't try to export big images\n    let numberOfImages = 1;\n    let layerWidth = layer.frame.width;\n    let layerHeight = layer.frame.height;\n    for (let currentAtN = 2; currentAtN <= numberOfImagesPerLayerExport; currentAtN++) {\n        if (\n            ((layerWidth * currentAtN) > maximumImageWidthOrHeight)\n            ||\n            ((layerHeight * currentAtN) > maximumImageWidthOrHeight)\n            )\n            {\n                break;\n            }\n        numberOfImages = currentAtN;\n    }\n\n\n    let insets = Utils.exportLayerAsPNG(layer, numberOfImages, exportPath, name, false, false);\n\n    Xml.xmlAddAttributesToElement(currentXMLElement, [\"hasExport\", numberOfImages, \n                                                  \"type\", \"image\", \n                                                  \"opacity\", layer.style.opacity,\n                                                  \"topInset\", Utils.roundBy(insets[0], 0.5), \n                                                  \"bottomInset\", Utils.roundBy(insets[1], 0.5), \n                                                  \"leftInset\", Utils.roundBy(insets[2], 0.5),  \n                                                  \"rightInset\", Utils.roundBy(insets[3], 0.5)\n                                                 ]);\n\n    for (let currentAtN = 1; currentAtN <= numberOfImages; currentAtN++) {\n        let exportAttr = [];\n        let fileName = name + ((currentAtN !== 1) ? \"@\" + currentAtN + \"x\" : \"\") + \".png\";\n\n        exportAttr.push(\"format\");\n        exportAttr.push(\"png\");\n        exportAttr.push(\"size\");\n        exportAttr.push(currentAtN + \"x\");\n        exportAttr.push(\"prefix\");\n        exportAttr.push(\"\");\n        exportAttr.push(\"suffix\");\n        exportAttr.push((currentAtN !== 1) ? \"@\" + currentAtN + \"x\" : \"\");\n        exportAttr.push(\"file\");\n        exportAttr.push(imagesSubDir + fileName);\n\n        Xml.xmlAddElement(currentXMLElement, \"export\", exportAttr, null);\n    }\n}\n\n\nfunction treeAddImageExport(name, layer, currentXMLElement, rootDirPath, imagesSubDir){\n    let succeeded = false;\n\n    if (layer.exportFormats.length > 0) \n    {\n        let Xml = require(\"./xml.js\");\n        let Utils = require(\"./utils.js\");\n\n        if (!rootDirPath.endsWith(\"/\")) {\n            rootDirPath += \"/\";\n        }\n    \n        if ((imagesSubDir.length > 0) && !imagesSubDir.endsWith(\"/\")) {\n            imagesSubDir += \"/\";\n        }\n\n        let exportPath = rootDirPath + imagesSubDir;\n        // We add our objectID to avoid conflict between different symbols and/or artboards\n        name = camelize(name) + \"__\" + layer.sketchObject.objectID(); \n\n        let insets = Utils.exportLayerWithUserDefinedExportOptions(layer, exportPath, name, false, false);\n\n        Xml.xmlAddAttributesToElement(currentXMLElement, [\"hasExport\", layer.exportFormats.length, \n                                                      \"type\", \"image\",  //force type as image\n                                                      \"opacity\", layer.style.opacity,\n                                                      \"topInset\", insets[0], \"bottomInset\", insets[1], \n                                                      \"leftInset\", insets[2], \"rightInset\", insets[3]\n                                                     ]);\n\n        const sketchVersion = require('sketch/dom').version.sketch;\n        if (sketchVersion >= 97) {\n            // Sketch 97 crashes when we call MSExportFormat.exportableFilenameForLayerName_exportFormat\n            layer.exportFormats.forEach(format => {\n                let prefix = \"\";\n                let suffix = \"\";\n\n                //NB: Sketch 97 bug: when we use a 'primary prefix', suffix has the same value than our prefix\n                if (format.prefix)\n                    prefix = format.prefix;\n                else if (format.suffix)\n                    suffix = format.suffix;\n\n                let fileFormat = format.fileFormat;\n\n                let fileName = prefix + name + suffix + \".\" + fileFormat;\n                let sizeText = format.size;\n\n                let exportAttr = [];\n                exportAttr.push(\"format\");\n                exportAttr.push(fileFormat);\n                exportAttr.push(\"size\");\n                exportAttr.push(sizeText);\n                exportAttr.push(\"prefix\");\n                exportAttr.push(prefix);\n                exportAttr.push(\"suffix\");\n                exportAttr.push(suffix);\n                exportAttr.push(\"file\");\n                exportAttr.push(imagesSubDir + fileName);\n\n                Xml.xmlAddElement(currentXMLElement, \"export\", exportAttr, null);\n            });\n        } else {\n            // Sketch 96 and below\n            layer.exportFormats.forEach(format => {\n                let exportFormat = format.sketchObject;\n        \n                let fileName = MSExportFormat.exportableFilenameForLayerName_exportFormat(name, exportFormat);\n\n                let sizeText = format.size;\n                let fileFormat = format.fileFormat;\n                let prefix = (format.prefix) ? format.prefix : \"\";\n                let suffix = (format.suffix) ? format.suffix : \"\";\n            \n                let exportAttr = [];\n                exportAttr.push(\"format\");\n                exportAttr.push(fileFormat);\n                exportAttr.push(\"size\");\n                exportAttr.push(sizeText);\n                exportAttr.push(\"prefix\");\n                exportAttr.push(prefix);\n                exportAttr.push(\"suffix\");\n                exportAttr.push(suffix);\n                exportAttr.push(\"file\");\n                exportAttr.push(imagesSubDir + fileName);\n                \n                Xml.xmlAddElement(currentXMLElement, \"export\", exportAttr, null);\n            });\n        }\n\n        succeeded = true;\n    }\n\n    return succeeded;\n}\n\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////\n// TREE INDEXING\n\n\n/*\nWe use names to add metadata inside Sketch objects.\nHere is the syntax:\nactualName -> actualType |key1|value1|key2|value2|...\nThis function returns an array with:\n- XML beacon name serving as type\n- element name\n- set of keys and values (possibly empty and possibly including legacy class information)\n*/\nfunction treeAddLayerInGlobalNamesIndex(layer, documentContext, layerNamesUnicityByContext, layersStack, contextStack){\n    let type = layer.sketchObject.class();\n\n    //extracting keys and values\n    let elements = layer.name.split(\"|\");\n    let nameAndType = elements.shift().split(\"->\");\n\n    let actualType = \"\" + type;\n    let useActualNameAsType = false;\n    let extractedTypeIsParentType = false;\n    if (type == \"MSLayerGroup\" || type == \"MSShapeGroup\"){\n        actualType = \"group\";\n    }else if (type == \"MSBitmapLayer\"){\n        actualType = \"image\";\n    }else if (type == \"MSRectangleShape\"){\n        actualType = \"rectangle\";\n    }else if (type == \"MSOvalShape\"){\n        actualType = \"oval\";\n    }else if (type == \"MSShapePathLayer\"){\n        if (isLine(layer)) {\n            actualType = \"line\";\n        }\n        //TODO: path\n    }else if (type == \"MSTextLayer\"){\n        actualType = \"text\";\n    }else if (type == \"MSArtboardGroup\"){\n        actualType = \"window\";\n        extractedTypeIsParentType = true;\n    }else if (type == \"MSSymbolMaster\"){\n        useActualNameAsType = true;\n        extractedTypeIsParentType = true;\n    }\n\n    let rawName;\n    let parentType = null;\n    if (nameAndType.length == 1){ //no type specified in name\n        rawName = nameAndType[0].trim();\n    } else if (nameAndType.length == 2){ //type is specified in name\n        rawName = nameAndType[0].trim();\n        let extractedType = nameAndType[1].trim();\n        if (extractedTypeIsParentType){\n            parentType = extractedType;\n        } else {\n            actualType = extractedType;\n        }\n    } else { //name is empty\n        log(\"treeAddLayerInGlobalNamesIndex: format error in layer's name - \" + layer.name);\n        return;\n    }\n    \n    //TODO: not only clean rawName but all captured elements\n\n    //clean possible forbidden characters\n    rawName = rawName.replace(/[^a-zA-Z0-9\\s]/g, ' ').replace(/\\s{2,}/g, ' ').trim();\n\n    if (rawName.match(/^\\d/)) {\n        rawName = \"n \" + rawName;\n    }\n\n    if (rawName.length == 0) {\n        rawName = \"invalidName\";\n    } else if (forbiddenNames.includes(rawName.toLowerCase())) {\n        rawName = \"n \" + rawName;\n    }\n\n\n    let contextKey = contextStack[0];\n    let localLayerNamesUnicityHash = layerNamesUnicityByContext[contextKey];\n\n    /*\n     Ensure name unicity\n     We manage a stack of context (contextStack) because, in the end,\n     we define QML files and we want id unicity in each QML file. \n     This optimization avoids useless suffix addition to layer names and thus makes generated code clearer.\n     */\n    //log(\"checking \" + rawName + \"(\" + contextKey + \")\");\n    let actualName = rawName;\n    let counter = 0;\n    let hashKey = camelize(actualName).toLowerCase();\n\n    if (localLayerNamesUnicityHash.hasOwnProperty(hashKey)){\n        counter = localLayerNamesUnicityHash[hashKey] + 1;\n        while (localLayerNamesUnicityHash.hasOwnProperty(hashKey + \" i\" + counter)) {\n            counter++;\n        }\n\n        actualName = actualName + \" i\" + counter;\n        localLayerNamesUnicityHash[camelize(actualName).toLowerCase()] = 1;\n    } else {\n        counter = 1;\n    }\n    localLayerNamesUnicityHash[hashKey] = counter;\n\n    if (useActualNameAsType) {\n        actualType = actualName;\n    }\n    \n    actualType = actualType.trim();\n    actualName = lowerCaseFirstCharater(actualName);\n\n    if (elements.length %2 !== 0) {\n        //NB: we arbitrarily remove the last element to get an even number\n        elements.pop();\n        log(\"treeAddLayerInGlobalNamesIndex: odd number of key-values in layer's name - \" + layer.name);\n    }\n\n    documentContext.globalNamesIndex[layer.id] = [actualName, \n                                                  actualType,\n                                                  elements, \n                                                  rawName,\n                                                  parentType];\n\n    if ((type == \"MSTextLayer\") && layer.sharedStyle && layer.sketchObject.isSharedStyleOutOfSync()) {\n        documentContext.textsWithOutOfSyncStyle[layer.id] = true;\n    }\n\n    if ((type == \"MSSymbolMaster\") || (type == \"MSArtboardGroup\")) {\n        let layerId = layer.id;\n        layerNamesUnicityByContext[layerId] = {};\n        contextStack.unshift(layerId);\n        layersStack.unshift(\"endOfContextScope\");\n    } \n\n    //exclude hidden layers and layers rendered as images\n    if (\n        !(layer.exportFormats && (layer.exportFormats.length > 0) && canExportTypeAsImage(type))\n        && !layer.hidden \n        &&  (type == \"MSArtboardGroup\" || type == \"MSLayerGroup\" || type == \"MSShapeGroup\" || type == \"MSSymbolMaster\")\n        ) {\n        for (let i = 0; layer.layers && i < layer.layers.length; i++) {\n            layersStack.unshift(layer.layers[i].id);\n        }\n    }\n}\n\n\nfunction treePopulateGlobalNamesIndex(documentContext){\n    let sketch = require('sketch/dom');\n    let document = sketch.getSelectedDocument();\n    let layerNamesUnicityByContext = {};\n    let layersStack = [];\n    \n    document.pages.forEach(page => {\n        if (page.name.startsWith(\"#\")) {\n            // Special case: we don't want to export this page\n            // BUT it may contain relevant information (symbol masters)\n            // that are required to export the content of other pages\n            page.layers.forEach(layer => {\n                let type = layer.sketchObject.class();\n                if (type ==  \"MSSymbolMaster\")\n                    layersStack.unshift(layer.id);\n            });\n        }\n        else {\n            page.layers.forEach(layer => {\n                let type = layer.sketchObject.class();\n                if (\n                     // We don't want to export slices and hotspots\n                     ((type != \"MSSliceLayer\") && (type != \"MSHotspotLayer\")) \n                     &&\n                     // We don't want to export \"private\" layers, BUT we need to list\n                     // all symbol masters to define overrides\n                     (!layer.name.startsWith(\"#\") || (type ==  \"MSSymbolMaster\"))\n                    )\n                {\n                    layersStack.unshift(layer.id);\n                }\n            });\n        }\n    });\n\n    let rootKey = \"DocumentRoot\";\n    let contextStack = [rootKey];\n    layerNamesUnicityByContext[rootKey] = {};\n    while (layersStack.length > 0) {\n        let myId = layersStack.shift();\n        if (myId == \"endOfContextScope\"){\n            let layerId = contextStack.shift();\n            delete layerNamesUnicityByContext[layerId];\n            continue;\n        }\n\n        let layer = document.getLayerWithID(myId);\n        if (layer)\n            treeAddLayerInGlobalNamesIndex(layer, documentContext, layerNamesUnicityByContext, layersStack, contextStack);\n    }\n}\n\n\nfunction treeBuildOverrideTargetPath(overR, globalNamesIndex){\n    let elmts = overR.path.split(\"/\");\n    let result = \"\";\n    for (let i = 0; i < elmts.length; i++){\n        let index = elmts[i];\n        if (globalNamesIndex[index]){\n            let str = camelize(getUniqueNameFromIndexedData(globalNamesIndex[index]));\n            result = result + str + ((i + 1 < elmts.length) ? \".\" : \"\");\n        }else{\n            log(\"undefined index on overriden layer \" + overR.affectedLayer.name + \" that may also be exportable\")\n        }\n    }\n    return result;\n}\n\n\nfunction addFontFilesToXml(xmlParent, rootDirPath, fontsSubDir, fontFiles, excludeSystemFonts) {\n    if (xmlParent && fontFiles && (fontFiles.length > 0)) {\n        let Xml = require(\"./xml.js\");\n        let Utils = require(\"./utils.js\");\n\n        if (!rootDirPath.endsWith(\"/\")) {\n            rootDirPath += \"/\";\n        }\n\n        if ((fontsSubDir.length > 0) && !fontsSubDir.endsWith(\"/\")) {\n            fontsSubDir += \"/\";\n        }\n\n        let exportPath = rootDirPath + fontsSubDir;\n        Utils.createDirectoryIfNeeded(exportPath);\n\n        let fontFileNames = [];\n        fontFiles.sort().forEach(fontFilePath => {\n            if (!excludeSystemFonts || !fontFilePath.startsWith(\"/System/Library/Fonts\")) {\n                let fileName = fontFilePath.substring(fontFilePath.lastIndexOf('/') + 1);\n                if (!fontFileNames.includes(fileName)) {\n                    fontFileNames.push(fileName);\n                   Xml.xmlAddElement(xmlParent, \"font\", [\"name\", fileName.replace(/\\.[^/.]+$/, \"\"), \"file\",  fontsSubDir + fileName], null);\n                    Utils.copyFile(fontFilePath, exportPath + fileName);\n                }\n            } \n        });\n    }\n}\n\n\nfunction swatchNameKey(name) {\n    return name.toLowerCase().replace(/\\s+/g, '');\n}\n\n\nfunction validSwatchName(rawName, colorNames) {\n    let name = rawName.replace(/[^a-zA-Z0-9_]/g, ' ').replace(/\\s{2,}/g, ' ').trim();\n    if (name.match(/^\\d/))\n        name = \"swatch \" + name;\n            \n    if (name.length == 0) {\n        name = \"swatch \" + color.replace(/#/g, '');\n    } else if (forbiddenNames.includes(name.toLowerCase())) {\n        name = \"swatch \" + name;\n    }\n\n    let keyName = swatchNameKey(name);\n    let validName = name;\n    if (colorNames.has(keyName)) {\n        let index = colorNames.get(keyName);\n        validName = name + \" i\" + (++index);\n\n        while (colorNames.has(swatchNameKey(validName))) {\n            validName = name + \" i\" + (++index);\n        }\n\n        colorNames.set(keyName, index);\n    }\n\n    validName = lowerCaseFirstCharater(validName);\n    colorNames.set(swatchNameKey(validName), 0);\n\n    return validName;\n}\n\n\nfunction addColorVariablesToXml(xmlParent) {\n    let sketch = require('sketch/dom');\n    if (sketch.version.sketch >= 69) {\n        let Xml = require(\"./xml.js\");\n\n        let colorNames = new Map();\n        let document = sketch.getSelectedDocument();\n\n        let swatchesData = [];\n\n        // V1: swatches defined by our document\n        /*\n        document.swatches.forEach(swatch => {\n            let color = rgbaToArgbOrRgb(swatch.color);\n            let validName = validSwatchName(swatch.name, colorNames);\n  \n            swatchesData.push({id: swatch.sketchObject.objectID(), name: validName, color: color});\n        });\n        */\n\n        // V2: document swatches and imported swatches\n        let usedNativeSwatches = document.sketchObject.documentData().allSwatches();\n        if (usedNativeSwatches.length > 0) {\n            usedNativeSwatches.forEach(nativeSwatch => {\n                let swatch = sketch.fromNative(nativeSwatch);\n\n                let color = rgbaToArgbOrRgb(swatch.color);\n                let validName = validSwatchName(swatch.name, colorNames);\n\n                swatchesData.push({id: swatch.sketchObject.objectID(), name: validName, color: color});\n            });\n        }\n\n\n        // Add missing swatches\n        for (const key in TEMP_CONTEXT.missingSwatches) {\n            let color = TEMP_CONTEXT.missingSwatches[key];\n            let validName = validSwatchName(\"missingSwatch \" + color, colorNames);\n            log(\"Adding missing swatch \" + key + \" with name '\" + validName + \"' (color: \" + color + \")\");\n            swatchesData.push({id: key, name: validName, color: color});\n        }\n\n        // Sort swatches by name before exporting them\n        swatchesData.sort((a, b) => {\n            return ((a.name !== b.name) ? ((a.name < b.name) ? -1 : 1) : 0); // NB: faster than a.name.localCompare(b.name)\n        }).forEach(swatchData => {\n           Xml.xmlAddElement(xmlParent, \"swatch\", [\"id\", swatchData.id, \"name\", swatchData.name, \"color\", swatchData.color], null);\n        });\n\n    } else {\n        console.warn(\"addColorVariablesToXml: can not export color variables - Sketch \" + sketch.version.sketch + \" is too old (required version is 69 or newer)\")\n    }\n}\n\n\nfunction addSharedTextStylesToXml(xmlParent) {\n    let Xml = require(\"./xml.js\");\n    let sketch = require('sketch/dom');\n    let document = sketch.getSelectedDocument();\n\n    let styleNames = new Map();\n    let stylesData = [];\n\n    // Step 1: get data of all text styles\n    document.sharedTextStyles.forEach(sharedTextStyle => {\n        let name = sharedTextStyle.name.replace(/[^a-zA-Z0-9_]/g, ' ').replace(/\\s{2,}/g, ' ').trim();\n        if (name.match(/^\\d/))\n            name = \"textStyle \" + name;\n        \n        if (name.length == 0) {\n            name = \"textStyle\";\n        } else if (forbiddenNames.includes(name.toLowerCase())) {\n            name = \"textStyle \" + name;\n        }\n\n        let validName = name;\n        if (styleNames.has(validName.toLowerCase())) {\n            let index = styleNames.get(validName.toLowerCase());\n            validName = name + \" i\" + (++index);\n\n            while (styleNames.has(validName.toLowerCase())) {\n                validName = name + \" i\" + (++index);\n            }\n\n            styleNames.set(name.toLowerCase(), index);\n        }\n        \n        validName = lowerCaseFirstCharater(validName);\n        styleNames.set(validName.toLowerCase(), 0);\n\n        stylesData.push({id: sharedTextStyle.id, name: validName, sharedTextStyle: sharedTextStyle});\n    });\n\n    // Step 2: export text styles\n    stylesData.sort((a, b) => {\n        return ((a.name !== b.name) ? ((a.name < b.name) ? -1 : 1) : 0); // NB: faster than a.name.localCompare(b.name)\n    }).forEach(textStyleData => {\n        let sharedTextStyleXml =Xml.xmlAddElement(xmlParent, \"sharedtextstyle\", [\"id\", textStyleData.id, \"name\", textStyleData.name], null);\n        treeAddAttributesFromTextStyle(sharedTextStyleXml, textStyleData.sharedTextStyle, null);\n    });\n}\n\n\nfunction camelize(str) {\n    str = removeDiacritics(str);\n    str = str.replace(/[^a-zA-Z0-9\\-_\\s]/g, \"\")\n    str = str.trim();\n\n    if (firstCharIsInvalid(str))\n      str = \"n\" + str;\n\n    return str.replace(/^([A-Z])|[\\-_\\s]+(\\w)/g, function(match, p1, p2, offset) {\n        if (p2) return p2.toUpperCase();\n        return p1.toLowerCase();\n    });\n}\n\nfunction pascalize(str) {\n    return capitalize(camelize(str));\n}\n\n\nfunction firstCharIsInvalid(str) {\n    return ((str.length > 0) && /[^a-z_]/i.test(str.charAt(0)));\n}\n\n\nfunction removeDiacritics(str) {\n    return Object.keys(diacriticsMap).reduce(function (str, key) {\n        let replaceRegexp = diacriticsMap[key];\n        return str.replace(replaceRegexp, key)\n      }, str);\n}\n\n\nfunction removeIllegalXmlCharacters(str) {\n    // Of the first 31 characters only the horizontal tab (9), line feed (10 => x0A) and carriage return (13 => x0D) may appear in XML\n    return str.replace(/[\\u0000-\\u0008\\u000b\\u000c\\u000e-\\u001f]/g, '')\n}\n\n\nfunction capitalize(str) {\n  if (typeof str !== 'string') return '';\n  std = str.trim();\n  if (str.length === 0) return '';\n  return str.charAt(0).toUpperCase() + str.slice(1)\n}\n\n\nfunction lowerCaseFirstCharater(str) {\n    return (str ? str[0].toLowerCase() + str.slice(1) : \"\");\n}\n\n\nfunction escapeCharactersInUnicodePrivateUseArea(str) {\n    let temp = removeIllegalXmlCharacters(str);\n    temp = temp.replace(/\\\\/g,\"\\\\\\\\\")\n    // NB: escape special characters used by custom icon fonts generated by Fontello\n    //     see https://www.compart.com/fr/unicode/block/U+E000\n    return temp.replace(/[\\uE000-\\uF8FF]/gu, function (c) {\n      return \"\\\\u\" + (\"000\" + c.charCodeAt().toString(16)).slice(-4)\n    });\n}\n\n\nfunction fontPostscriptNameFromStyle(style) {\n    if (!style || !style.sketchObject)\n        return null;\n\n    return style.sketchObject.textStyle().fontPostscriptName();\n}\n\n\nfunction fontStyleNameFromStyle(style) {\n    if (!style || !style.sketchObject)\n        return null;\n\n    let fontDisplayName = style.sketchObject.textStyle().attributes().NSFont.displayName();\n    let fontStyleName = fontDisplayName.replace(style.fontFamily, \"\").trim();\n    if (fontStyleName === \"\")\n        fontStyleName = \"Regular\";\n\n    return fontStyleName;\n}\n\n\nfunction getFillColorAsHexValueOrSwatchReference(fill) {\n    if (fill.sketchObject) {\n        return mscolorToHexValueOrSwatchReference(fill.sketchObject.color());\n    }\n    else {\n        return rgbaToArgbOrRgb(fill.color);\n    }\n}\n\n\nfunction getTextColorAsHexValueOrSwatchReference(style) {\n    if (style.sketchObject && style.sketchObject.textStyle() && style.sketchObject.textStyle().attributes() \n        && style.sketchObject.textStyle().attributes().MSAttributedStringColorAttribute) {\n        return mscolorToHexValueOrSwatchReference(style.sketchObject.textStyle().attributes().MSAttributedStringColorAttribute);\n    } else {\n       return rgbaToArgb(style.textColor);\n    }\n}\n\n\nfunction getBackgroundColorAsHexValueOrSwatchReference(layer) {\n    if (layer.sketchObject) {\n        return mscolorToHexValueOrSwatchReference(layer.sketchObject.backgroundColor());\n    } else {\n        return rgbaToArgbOrRgb(layer.background.color);\n    }\n}\n\n\nfunction mscolorToHexValueOrSwatchReference(mscolor) {\n    let swatchID = mscolor.swatchID();\n    if (swatchID) {\n        let key = String(swatchID);\n        if (!TEMP_CONTEXT.availableSwatchIDs.includes(key)) {\n            if (!TEMP_CONTEXT.missingSwatches.hasOwnProperty(key)) {\n                let color = mscolorToArgbOrRgb(mscolor);\n                log(\"Swatch with ID \" + key + \" not found (color: \" + color + \"). Please check that all named colors are imported\");\n                TEMP_CONTEXT.missingSwatches[key] = color;\n            }\n        }\n\n        return \"swatch(\" + swatchID + \")\";\n    } else {\n        return mscolorToArgbOrRgb(mscolor);\n    }\n}\n\n\nfunction mscolorToArgbOrRgb(mscolor) {\n    return rgbaToArgbOrRgb(\n        \"#\" +mscolor.immutableModelObject().hexValue() \n        + (\"0\" + Math.round(mscolor.alpha() * 255).toString(16).toUpperCase()).slice(-2)\n    );\n}\n\n\nfunction rgbaToArgb(color){\n    return color.replace(/#(......)(..)/, '#$2$1');\n}\n\n\nfunction rgbaToArgbOrRgb(color){\n    if (color.slice(-2).toUpperCase() === \"FF\") {\n        return color.slice(0, -2);\n    } else {\n        return rgbaToArgb(color);\n    }\n}\n\n\nfunction layerTextBehaviour(layer) {\n    if (!isTextLayer(layer))\n        return \"\";\n\n    let textBehaviourValue = layer.sketchObject.textBehaviour();\n    if (textBehaviourValue == 0) {\n        return \"autoWidth\";\n    } else if (textBehaviourValue == 1) {\n        return \"autoHeight\";\n    } else {\n        return \"fixedSize\";\n    }\n}\n\n\nfunction layerFontFilePath(layer) {\n    return ((layer && isTextLayer(layer)) ? styleFontFilePath(layer.style) : null);\n}\n\n\nfunction styleFontFilePath(style) {\n    let fontFilePath = null;\n\n    if (style && style.sketchObject) {\n        let nsFont = style.sketchObject.textStyle().attributes().NSFont;\n        if (nsFont) {\n            let urlAttribute = nsFont.fontDescriptor().objectForKey(\"NSCTFontFileURLAttribute\");\n            if (urlAttribute) {\n                fontFilePath = String(urlAttribute.path());\n            }\n        }\n    } \n\n    return fontFilePath;\n}\n\n\nfunction canExportTypeAsImage(type) {\n    return ((type != \"MSArtboardGroup\") && (type != \"MSSymbolMaster\"));\n}\n\n\nfunction isLayerGroup(layer) {\n    return (layer && layer.sketchObject && layer.sketchObject.isKindOfClass(MSLayerGroup.class()) \n            && !layer.sketchObject.isKindOfClass(MSShapeGroup.class()));\n}\n\n\nfunction isBitmapLayer(layer) {\n    return (layer && layer.sketchObject && layer.sketchObject.isKindOfClass(MSBitmapLayer.class()));\n}\n\n\nfunction isTextLayer(layer) {\n    return (layer && layer.sketchObject && layer.sketchObject.isKindOfClass(MSTextLayer.class()));\n}\n\n\nfunction isShapeLayer(layer) {\n    return (layer && layer.sketchObject \n            && (\n                layer.sketchObject.isKindOfClass(MSRectangleShape.class())  \n                || \n                layer.sketchObject.isKindOfClass(MSOvalShape.class())  \n                ||\n                layer.sketchObject.isKindOfClass(MSPolygonShape.class())  \n                ||\n                layer.sketchObject.isKindOfClass(MSStarShape.class())  \n                ||\n                layer.sketchObject.isKindOfClass(MSTriangleShape.class())  \n                ||\n                layer.sketchObject.isKindOfClass(MSShapePathLayer.class())\n               ) \n            );\n}\n\n\nfunction isRectangleShape(layer) {\n    return (layer && layer.sketchObject.isKindOfClass(MSRectangleShape.class()) && layer.sketchObject.isRectangle());\n    /*\n            && layer.points && (layer.points.length == 4)\n            && (layer.points[0].pointType == \"Straight\") && (layer.points[0].point.x == 0) && (layer.points[0].point.y == 0)\n            && (layer.points[1].pointType == \"Straight\") && (layer.points[1].point.x == 1) && (layer.points[1].point.y == 0)\n            && (layer.points[2].pointType == \"Straight\") && (layer.points[2].point.x == 1) && (layer.points[2].point.y == 1)\n            && (layer.points[3].pointType == \"Straight\") && (layer.points[3].point.x == 0) && (layer.points[3].point.y == 1)\n            );\n    */        \n}\n\n\nfunction isOvalShape(layer) {\n    return (layer && layer.sketchObject.isKindOfClass(MSOvalShape.class()));\n}\n\n\nfunction isLine(layer) {\n    return (layer && layer.sketchObject && layer.sketchObject.isLine());\n};\n\n\nfunction isSliceLayer(layer) {\n    return (layer && layer.sketchObject && layer.sketchObject.isKindOfClass(MSSliceLayer.class()));\n}\n\n\nfunction isArtboard(layer) {\n    return (layer && layer.sketchObject && layer.sketchObject.isKindOfClass(MSArtboardGroup.class()));\n}\n\n\nfunction isSymbolMaster(layer) {\n    return (layer && layer.sketchObject && layer.sketchObject.isKindOfClass(MSSymbolMaster.class()));\n}\n\n\nfunction isSymbolInstance(layer) {\n    return (layer && layer.sketchObject && layer.sketchObject.isKindOfClass(MSSymbolInstance.class()));\n}\n\n\nfunction isSupportedLayer(layer) {\n    return (\n            isTextLayer(layer) || isBitmapLayer(layer) \n            || (\n                 (isRectangleShape(layer) || isOvalShape(layer) || isSupportedLine(layer))\n                 && \n                 isSupportedShapeStyle(layer.style)\n                )\n            || isLayerGroup(layer) \n            || isArtboard(layer) || isSymbolInstance(layer)\n            );\n}\n\n\nfunction isSupportedLine(layer) {\n    return (isLine(layer) && layer.style && layer.style.borderOptions \n            && (layer.style.borderOptions.startArrowhead == 'None') \n            && (layer.style.borderOptions.endArrowhead == 'None'));\n}\n\n\nfunction isSupportedShapeStyle(style) {\n    let isSupported = true;\n\n    if (style) {\n        isSupported = (\n                       !(style.blur.enabled)\n                       &&\n                       (style.shadows.filter(item => { return item.enabled; }).length == 0)\n                       &&\n                       (style.innerShadows.filter(item => { return item.enabled; }).length == 0)\n                      );\n\n        if (isSupported) {\n            let activeItems = style.fills.filter(item => { return item.enabled; });\n            let numberOfActiveItems = activeItems.length;\n            if (numberOfActiveItems > 0) {\n                let lastItem = activeItems[numberOfActiveItems - 1];\n                isSupported = (\n                               (lastItem.fillType == \"Color\")\n                               &&\n                               ((numberOfActiveItems == 1) || (lastItem.color.slice(-2) === \"ff\")) // \"ff\" => fill is opaque\n                               );\n            }\n        }\n\n        if (isSupported) {\n            let activeItems = style.borders.filter(item => { return item.enabled; });\n            let numberOfActiveItems = activeItems.length;\n            if (numberOfActiveItems > 0) {\n                let lastItem = activeItems[numberOfActiveItems - 1];\n                isSupported = (\n                               (lastItem.fillType == \"Color\")\n                               && \n                               (numberOfActiveItems == 1)\n                              );            \n            }\n        }\n    }\n\n    return isSupported;\n}\n\n\nfunction isEmptyStyle(style) {\n    let isEmpty = true;\n\n    if (style) {\n        isEmpty = (\n                   (style.blendingMode == \"Normal\")\n                   && (style.fills.filter(item => { return item.enabled; }).length == 0)\n                   && (style.borders.filter(item => { return item.enabled; }).length == 0)\n                   && (style.shadows.filter(item => { return item.enabled; }).length == 0)\n                   && (style.innerShadows.filter(item => { return item.enabled; }).length == 0)\n                   && !(style.blur.enabled)\n                  );\n    }\n\n    return isEmpty;\n}\n\n\nmodule.exports = {\n    addColorVariablesToXml,\n    addFontFilesToXml,\n    addSharedTextStylesToXml,\n    clearTempContext,\n    getBackgroundColorAsHexValueOrSwatchReference,\n    getFontFilesUsedByLayer,\n    getKeyValuesFromIndexedData,\n    getParentTypeFromIndexedData,\n    getTypeFromIndexedData,\n    getUniqueNameFromIndexedData,\n    initDocumentContext,\n    pascalize,\n    treeIterateLayers,\n    addSymbolMasterOverridesToXml\n};","let Utils = {};\n\n\n//NB: Sound files in /System/Library/Sounds\nUtils.Sounds = {\n    Basso: \"Basso\",\n    Blow: \"Blow\",\n    Bottle: \"Bottle\",\n    Frog: \"Frog\",\n    Funk: \"Funk\",\n    Glass: \"Glass\",\n    Hero: \"Hero\",\n    Morse: \"Morse\",\n    Ping: \"Ping\",\n    Pop: \"Pop\",\n    Purr: \"Purr\",\n    Sosumi: \"Sosumi\",\n    Submarine: \"Submarine\",\n    Tink: \"Tink\"\n};\n\n\nUtils.playSoundNamed = function(name) {\n    let sound = NSSound.soundNamed(name);\n    if (sound) \n        sound.play();\n};\n\n\nUtils.chooseFolder = function() {\n    let panel = NSOpenPanel.openPanel();\n    panel.setCanChooseDirectories(true);\n    panel.setCanChooseFiles(false);\n    panel.setCanCreateDirectories(true);\n    \n    if (panel.runModal() == NSModalResponseOK) {\n        let path = panel.URL().path();\n        if (0 == path.indexOf(\"file://\")) {\n            //remove the file:// path from string\n            path = path.substring(7);\n        }\n\n        if (!path.endsWith(\"/\"))\n            path += \"/\";\n\n        return path;\n    }\n    else\n        return null;\n};\n\n\nUtils.showDialog = function(message) {\n    let app = NSApplication.sharedApplication();\n    if (app)\n        app.displayDialog_withTitle(message, \"Sketch2QML\");\n};\n\n\nUtils.showInFinder = function(directoryPathOrFilePath) {\n    let errorPointer = MOPointer.alloc().init();\n    let fileManager = NSFileManager.defaultManager();\n    let result = fileManager.attributesOfItemAtPath_error(directoryPathOrFilePath, errorPointer);\n    if (result) {\n        if (result.isDirectory()) \n            NSWorkspace.sharedWorkspace().openFile_withApplication(directoryPathOrFilePath, \"Finder\");\n        else \n            NSWorkspace.sharedWorkspace().selectFile_inFileViewerRootedAtPath(directoryPathOrFilePath, nil);\n    }\n    else\n        console.warn(\"Utils.showInFinder: \" + directoryPathOrFilePath + \" does not exist or can't be read\");\n};\n\n\nUtils.runCommand = function (command, args, currentDirectoryPath) {\n    var task = NSTask.alloc().init();\n    task.setLaunchPath_(command);\n    if (currentDirectoryPath)\n        task.setCurrentDirectoryPath(currentDirectoryPath);\n    \n    task.arguments = args;\n    task.launch();\n    task.waitUntilExit();\n    return (task.terminationStatus() == 0)\n};\n\n\nUtils.copyFile = function (source, destination) {\n    const manager = NSFileManager.defaultManager();\n    if (manager.fileExistsAtPath(source))\n        manager.copyItemAtPath_toPath_error(source, destination, null);\n    else\n        console.warn(\"Utils.copyFile: file '\" + source + \"` does not exist\");\n};\n\n\nUtils.fileExists = function (filePath) {\n    return NSFileManager.defaultManager().fileExistsAtPath(filePath);\n};\n\n\nUtils.expandTildeInPath = function (filePath) {\n    return String(NSString.stringWithString(filePath).stringByExpandingTildeInPath());\n};\n\n\nUtils.createDirectoryIfNeeded = function(path) {\n    const manager = NSFileManager.defaultManager();\n    if (manager.fileExistsAtPath(path)) {\n        return true;\n    } else {\n        if (manager.createDirectoryAtPath_withIntermediateDirectories_attributes_error(path, true, nil, nil)) {\n            return true;\n        } else {\n            console.warn(\"Utils.createDirectoryIfNeeded: failed to create directory \" + path);\n            return false;\n        }\n    }\n};\n\n\nUtils.forceNewDirectory = function(path) {\n    const manager = NSFileManager.defaultManager();\n    if (manager.fileExistsAtPath(path))\n        manager.removeItemAtPath_error(path, nil);\n        \n    if (manager.createDirectoryAtPath_withIntermediateDirectories_attributes_error(path, true, nil, nil)) {\n        return true;\n    } else {\n        console.warn(\"Utils.forceNewDirectory: failed to create directory \" + path);\n        return false;\n    }\n};\n\n\nUtils.roundWithDecimalPrecision = function (value, precision){\n    let multiplier = Math.pow(10, precision || 0);\n    return Math.round((value + Number.EPSILON) * multiplier)/multiplier;\n};\n\n\nUtils.roundBy = function(value, rounder) {\n    let multiplier = 1/(rounder || 0.5);\n    return Math.round(value * multiplier)/multiplier;\n}\n\n\nUtils.isLine = function(layer) {\n    return (layer && layer.sketchObject && layer.sketchObject.isLine());\n};\n\n\nUtils.layerAbsoluteRect = function(layer) {\n    const sketchVersion = require('sketch/dom').version.sketch;\n    \n    if (sketchVersion >= 97) {\n        // Sketch 97: method absoluteRect() of MSLayer has been removed\n       let absoluteRect = layer.frame.changeBasis({ from: layer.parent});\n       return absoluteRect.asCGRect();\n    } else {\n        // Sketch 96 and below\n        let nativeLayer = layer.sketchObject;\n        return nativeLayer.absoluteRect().rect();\n    }\n};\n\n\nUtils.layerAbsoluteInfluenceRect = function(layer) {\n    const sketchVersion = require('sketch/dom').version.sketch;\n\n    if (sketchVersion >= 97) {\n        // Sketch 97: method influenceRectForBoundsInDocument() of MSLayer has been removed\n        let nativeLayer = layer.sketchObject;\n        let request = MSExportRequest.exportRequestsFromLayerAncestry_(nativeLayer.ancestry()).firstObject();\n        request.setRect_(NSZeroRect);\n        let exporter = MSExporter.exporterForRequest_colorSpace_(request, nil);\n        exporter.trimmedBounds();\n        return request.rect();\n    } else if (sketchVersion >= 96) {\n        // Sketch 96: method absoluteInfluenceRect() of MSLayer has been removed\n        let nativeLayer = layer.sketchObject;\n        const document = nativeLayer.documentData();\n        const immutable = nativeLayer.immutableModelObject();\n        const relativeInfluenceRect = immutable.influenceRectForBoundsInDocument(document);\n        return nativeLayer.convertRect_toLayer_(relativeInfluenceRect, null);\n    } else {\n        // Sketch 95 and below\n        let nativeLayer = layer.sketchObject;\n        return nativeLayer.absoluteInfluenceRect();\n    }\n};\n\n\nUtils.exportLayerWithFormats = function(layer, exportPath, exportName, formats, preserveFrameSize, applyTransformAndOpacity) {\n    let topInset = 0;\n    let bottomInset = 0;\n    let leftInset = 0;\n    let rightInset = 0;\n\n    if (!layer || !exportPath) {\n        console.warn(\"Utils.exportLayerWithFormats: layer or exportPath is not defined\");\n        return [topInset, bottomInset, leftInset, rightInset];\n    }\n\n    if (formats.length > 0) {\n        let sketchDom = require('sketch/dom');\n        let document = sketchDom.getSelectedDocument();\n        let layerToExport = layer;\n\n        if (!exportName)\n            exportName = layer.name;\n\n        if (!exportPath.endsWith(\"/\"))\n            exportPath += \"/\";\n\n        //NB: layer.transform.rotation wraps layer.sketchObject.userVisibleRotation() \n        //     that matches what users see in the inspector which may be different \n        //     from the raw `rotation` value\n        //     Here, we need the raw rotation because the generated code will apply a rotation\n        //\n        //NB: layer.sketchObject.userVisibleRotation and layer.sketchObject.rotation don't use the same rotation direction\n        //    layer.sketchObject.userVisibleRotation  is clockwise, layer.sketchObject.rotation is counterclockwise\n        let rotation = Utils.roundWithDecimalPrecision(-layer.sketchObject.rotation(), 3);\n\n        let isRotated = (rotation != 0);\n        let isFlippedHorizontally = layer.transform.flippedHorizontally;\n        let isFlippedVertically = layer.transform.flippedVertically;\n        let parentIsGroup = (layer.parent && layer.parent.sketchObject && layer.parent.sketchObject.isKindOfClass(MSLayerGroup.class()));\n\n        // Duplicate our layer if needed\n        let useDuplicate = false;\n        if (\n            !applyTransformAndOpacity \n            && \n            ((layer.style.opacity != 1) || isRotated || isFlippedHorizontally || isFlippedVertically || parentIsGroup)\n            )\n        {\n            useDuplicate = true;\n            layerToExport = layer.duplicate();\n            layerToExport.parent = document.selectedPage;\n\n            layerToExport.style.opacity = 1;\n            \n             if (isFlippedHorizontally)\n                layerToExport.transform.flippedHorizontally = false;\n \n             if (isFlippedVertically)\n                 layerToExport.transform.flippedVertically = false;\n \n            if (isRotated) {\n                if (Utils.isLine(layer)) {\n                    // Special case: Sketch updates the points of a line when we set its rotation\n                    // Rotation = 0 => horizontal line\n                   let frame = layerToExport.frame;\n                   let point0 = layerToExport.points[0];\n                   let pt0X = point0.point.x * frame.width;\n                   let pt0Y = point0.point.y * frame.height;\n                   let point1 = layerToExport.points[1];\n                   let pt1X = point1.point.x * frame.width;\n                   let pt1Y = point1.point.y * frame.height;\n                   let angleInDegrees = Math.atan2(pt1Y - pt0Y, pt1X - pt0X) * 180 / Math.PI;\n\n                   layerToExport.transform.rotation = angleInDegrees;\n                } else\n                    layerToExport.transform.rotation = 0;\n            }\n        }\n\n        let absoluteRect = Utils.layerAbsoluteRect(layerToExport);\n        let absoluteInfluenceRect = Utils.layerAbsoluteInfluenceRect(layerToExport);\n        let exportRect = absoluteRect;\n\n        //log(exportName + \" => absolureRect(\" + absoluteRect.origin.x + \", \" + absoluteRect.origin.y + \", \" + absoluteRect.size.width + \", \" + absoluteRect.size.height + \")\");\n        //log(exportName + \" => absoluteInfluenceRect(\" + absoluteInfluenceRect.origin.x + \", \" + absoluteInfluenceRect.origin.y + \", \" + absoluteInfluenceRect.size.width + \", \" + absoluteInfluenceRect.size.height + \")\");\n\n        if (!preserveFrameSize && !CGRectContainsRect(absoluteRect, absoluteInfluenceRect)) {\n            //TODO: decide if it's better to use the influence rectangle OR to use the union of both rectangles\n            //     - influence rectangle: we export the smallest possible image BUT we can have rather high inset values\n            //     - union: we can have small inset values BUT we export a larger image\n            //exportRect = CGRectUnion(absoluteRect, absoluteInfluenceRect); \n            exportRect = absoluteInfluenceRect;\n\n            let absoluteRectX = Utils.roundBy(absoluteRect.origin.x, 0.5);\n            let absoluteRectY = Utils.roundBy(absoluteRect.origin.y, 0.5);\n            let absoluteRectWidth = Math.ceil(absoluteRect.size.width);\n            let absoluteRectHeight = Math.ceil(absoluteRect.size.height);\n\n            let exportRectX = Utils.roundBy(exportRect.origin.x, 0.5);\n            let exportRectY = Utils.roundBy(exportRect.origin.y, 0.5);\n            let exportRectWidth = Math.ceil(exportRect.size.width);\n            let exportRectHeight = Math.ceil(exportRect.size.height);\n\n            exportRect = NSMakeRect(exportRectX, exportRectY, exportRectWidth, exportRectHeight);\n\n            topInset = exportRectY - absoluteRectY;\n            bottomInset = (absoluteRectY + absoluteRectHeight) - (exportRectY + exportRectHeight);\n            leftInset = exportRectX - absoluteRectX;\n            rightInset = (absoluteRectX + absoluteRectWidth) - (exportRectX + exportRectWidth);\n\n        } else {\n            let exportRectX = Utils.roundBy(exportRect.origin.x, 0.5);\n            let exportRectY = Utils.roundBy(exportRect.origin.y, 0.5);\n            let exportRectWidth = Math.ceil(exportRect.size.width);\n            let exportRectHeight = Math.ceil(exportRect.size.height);\n\n            exportRect = NSMakeRect(exportRectX, exportRectY, exportRectWidth, exportRectHeight);\n        }\n\n        //log(\"Export \" + exportName + \" rect \" + exportRect.origin.x + \", \" + exportRect.origin.y + \", \" + exportRect.size.width + \", \" + exportRect.size.height)\n        //log(\" => insets top=\" + topInset + \", bottom=\" + bottomInset + \" -- left=\" + leftInset + \", right=\" + rightInset)\n     \n        let nativeLayer = layerToExport.sketchObject;\n        const sketchVersion = require('sketch/dom').version.sketch;\n        if (sketchVersion >= 97) {\n            // Sketch 97 crashes when we call MSExportFormat.exportableFilenameForLayerName_exportFormat\n            formats.forEach(format => {\n                let exportFormat = (format.sketchObject ? format.sketchObject : format);\n                let exportRequest = MSExportRequest.exportRequestsFromExportableLayer_exportFormats_inRect_useIDForName(nativeLayer, [exportFormat], exportRect, false).firstObject();\n                exportRequest.setShouldTrim(false);\n                let filePath = exportName;\n\n                if (exportFormat.namingScheme() == 0)\n                    filePath += exportFormat.name();\n                else\n                    filePath = exportFormat.name() + filePath;\n                \n                filePath = exportPath + filePath + \".\" + exportRequest.format();\n\n                document.sketchObject.saveExportRequest_toFile(exportRequest, filePath);\n            });\n        } else if (sketchVersion >= 79) {\n            // Sketch 79 does not contain\n            // -(id)exportRequestFromExportFormat:(id)arg1 layer:(id)arg2 inRect:(struct CGRect)arg3 useIDForName:(BOOL)arg4;\n            formats.forEach(format => {\n                let exportFormat = (format.sketchObject ? format.sketchObject : format);\n                let exportRequest = MSExportRequest.exportRequestsFromExportableLayer_exportFormats_inRect_useIDForName(nativeLayer, [exportFormat], exportRect, false).firstObject();\n                exportRequest.setShouldTrim(false);\n                document.sketchObject.saveArtboardOrSlice_toFile(exportRequest, exportPath + MSExportFormat.exportableFilenameForLayerName_exportFormat(exportName, exportFormat));\n            });\n        } else {\n            // Sketch 78 and below\n            formats.forEach(format => {\n                let exportFormat = (format.sketchObject ? format.sketchObject : format);\n                let exportRequest = MSExportRequest.exportRequestFromExportFormat_layer_inRect_useIDForName(exportFormat, nativeLayer, exportRect, false);\n                exportRequest.setShouldTrim(false);\n                document.sketchObject.saveArtboardOrSlice_toFile(exportRequest, exportPath + MSExportFormat.exportableFilenameForLayerName_exportFormat(exportName, exportFormat));\n            });\n        }\n\n        if (useDuplicate)\n            layerToExport.remove();\n    }\n    else\n        console.warn(\"Utils.exportLayerWithFormats: no export format to export layer \" + layer.name);\n\n    return [topInset, bottomInset, leftInset, rightInset];\n}\n\n\n\nUtils.exportLayerAsPNG = function(layer, maxAtN, exportPath, exportName, preserveFrameSize, applyTransformAndOpacity) {\n    if (!layer || !exportPath) {\n        console.warn(\"Utils.exportLayerAsPNG: layer or exportPath is not defined\");\n        return [0, 0, 0, 0];\n    }\n\n    maxAtN = Math.max(1, maxAtN);\n\n    let exportFormats = [];\n    for (let index = 1; index <= maxAtN; index++) \n    {\n        let pngFormat = MSExportFormat.alloc().init();\n        pngFormat.setFileFormat(\"png\");\n        pngFormat.setScale(index);\n        pngFormat.setName((index === 1) ? \"\" : \"@\" + index + \"x\");\n        \n        exportFormats.push(pngFormat);\n    }\n\n    return Utils.exportLayerWithFormats(layer, exportPath, exportName, exportFormats, preserveFrameSize, applyTransformAndOpacity);\n};\n\n\nUtils.exportLayerAsSVG = function(layer, exportPath, exportName, preserveFrameSize, applyTransformAndOpacity) {\n    if (!layer || !exportPath) {\n        console.warn(\"Utils.exportLayerAsSVG: layer or exportPath is not defined\");\n        return [0, 0, 0, 0];\n    }\n\n    let svgFormat = MSExportFormat.alloc().init();\n    svgFormat.setFileFormat(\"svg\");\n    svgFormat.setScale(1);\n\n    return Utils.exportLayerWithFormats(layer, exportPath, exportName, [svgFormat], preserveFrameSize, applyTransformAndOpacity);\n};\n\n\nUtils.exportLayerWithUserDefinedExportOptions = function(layer, exportPath, exportName, preserveFrameSize, applyTransformAndOpacity) {\n    if (!layer || !exportPath) {\n        console.warn(\"Utils.exportLayerWithUserDefinedExportOptions: layer or exportPath is not defined\");\n        return [0, 0, 0, 0];\n    }\n\n    return Utils.exportLayerWithFormats(layer, exportPath, exportName, layer.exportFormats, preserveFrameSize, applyTransformAndOpacity);\n};\n\n\n\nmodule.exports = Utils;\n","\nfunction xmlAddElement(parent, name, attributes, value){\n    if (parent == null){\n        log (\"parent is null for \" + name);\n        return null;\n    }\n    var el;\n    if (value != null){\n        el = NSXMLElement.elementWithName_stringValue(NSString.stringWithFormat(\"%@\", name),\n                                                      NSString.stringWithFormat(\"%@\", value));\n    }else{\n        el = NSXMLElement.elementWithName(NSString.stringWithFormat(\"%@\", name));\n    }\n    \n    for (var i = 0; attributes && (i < attributes.length); i+=2){\n        el.addAttribute(NSXMLNode.attributeWithName_stringValue(NSString.stringWithFormat(\"%@\", attributes[i]),NSString.stringWithFormat(\"%@\", attributes[i+1])));\n    }\n    parent.addChild(el);\n    return el;\n}\n\nfunction xmlAddAttributesToElement(element, keyValues){\n    if (element == null){\n        log (\"xmlAddAttributesToElement: element is null\");\n        return null;\n    }\n    for (var i = 0; keyValues && (i < keyValues.length); i+=2){\n        element.addAttribute(NSXMLNode.attributeWithName_stringValue(NSString.stringWithFormat(\"%@\", keyValues[i]), NSString.stringWithFormat(\"%@\", keyValues[i+1])));\n    }\n}\n\nfunction xmlAddCustomPropertiesToElement(xmlElement, keyValues) {\n    while (keyValues.length > 0) {\n       xmlAddElement(xmlElement, \"property\", [\"key\", keyValues.shift().trim(), \"value\", keyValues.shift().trim()], null);\n    }\n}\n\nfunction exportXMLToPath(path, root){\n    var doc = NSXMLDocument.documentWithRootElement(root);\n    var xmlData = doc.XMLDataWithOptions(NSXMLNodePrettyPrint);\n    const p = NSString.stringWithFormat(\"%@\", path).stringByExpandingTildeInPath();\n    xmlData.writeToFile(p);\n}\n\nmodule.exports = {xmlAddElement, xmlAddAttributesToElement, xmlAddCustomPropertiesToElement, exportXMLToPath};","module.exports = require(\"sketch/dom\");","module.exports = require(\"sketch/settings\");","module.exports = require(\"sketch/ui\");"],"sourceRoot":""}