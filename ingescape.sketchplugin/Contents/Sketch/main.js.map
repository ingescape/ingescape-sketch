{"version":3,"sources":["webpack://exports/webpack/bootstrap","webpack://exports/./src/main.js","webpack://exports/./src/tree.js","webpack://exports/./src/utils.js","webpack://exports/./src/xml.js","webpack://exports/external \"sketch/dom\"","webpack://exports/external \"sketch/settings\"","webpack://exports/external \"sketch/ui\""],"names":["onShowAboutDialog","context","iconPath","plugin","urlForResourceNamed","path","icon","NSImage","alloc","initByReferencingFile","dialog","NSAlert","init","setMessageText","setInformativeText","addButtonWithTitle","responseCode","runModal","NSAlertFirstButtonReturn","NSWorkspace","sharedWorkspace","openURL","NSURL","URLWithString","onOpenFileAndExportWholeAsXml","file","Document","require","filePath","String","fileName","substring","lastIndexOf","indexOf","replace","trim","fileDir","open","err","document","console","warn","exportWhole","getSelectedDocument","close","onExportLibraryAsXml","Tree","Xml","Utils","sketch","settings","UI","alert","chooseFolder","log","docPath","decodeURI","docPathElements","split","documentName","length","pascalize","libraryName","libraryFontsSubDir","libraryImagesSubDir","createDirectoryIfNeeded","forceNewDirectory","message","documentContext","initDocumentContext","xmlLibraryRoot","NSXMLElement","initWithName","xmlAddAttributesToElement","version","symbols","getSymbols","symbolsIDs","i","currentSymbol","name","startsWith","includes","id","push","indexedData","globalNamesIndex","actualName","getUniqueNameFromIndexedData","actualType","getTypeFromIndexedData","keyValues","getKeyValuesFromIndexedData","parentType","getParentTypeFromIndexedData","xmlComponent","xmlAddElement","frame","width","height","background","enabled","includedInInstance","getBackgroundColorAsHexValueOrSwatchReference","xmlAddCustomPropertiesToElement","treeIterateLayers","layers","addSharedTextStylesToXml","addFontFilesToXml","fontFiles","addColorVariablesToXml","clearTempContext","xmlFilePath","exportXMLToPath","playSoundNamed","Sounds","Glass","showInFinder","onExportApplicationAsXml","appName","appFontsSubDir","appImagesSubDir","xmlAppRoot","pages","page","xmlPage","artboards","j","artboardOrlayer","type","sketchObject","class","artboard","xmlScreen","includedInExport","exportDir","interactionsAllowed","maxNumberOfSteps","onExportWholeAsXml","onExportFonts","forEach","getFontFilesUsedByLayer","fontFile","copyFile","onExportSelectedLayersAsPNG","selectedLayers","NSBeep","layer","exportLayerAsPNG","onExportSelectedLayersAsSVG","exportLayerAsSVG","onExportSelectedLayersWithUserPredefinedExportOptions","exportLayerWithUserDefinedExportOptions","forbiddenNames","diacriticsMap","A","AE","E","I","O","OE","U","a","ae","c","e","o","oe","u","numberOfImagesPerLayerExport","maximumImageWidthOrHeight","GLOBALNAMESINDEX_UNIQUENAME","GLOBALNAMESINDEX_TYPE","GLOBALNAMESINDEX_KEYVALUES","GLOBALNAMESINDEX_RAWNAME","GLOBALNAMESINDEX_PARENTTYPE","TEMP_CONTEXT","data","getRawNameFromIndexedData","availableSwatchIDs","missingSwatches","sharedLayerStylesIndex","sharedTextStylesIndex","textsWithOutOfSyncStyle","sharedLayerStyles","style","sharedTextStyles","treePopulateGlobalNamesIndex","nb","Object","keys","usedNativeSwatches","documentData","allSwatches","nativeSwatch","objectID","addFontFileToContext","fontFilePath","result","layerFontFilePath","subLayer","parent","shallIgnoreSymbolMasters","rootDirPath","imagesSubDir","xmlRoot","mask","actualParent","currentMask","l","isCustomClass","rawName","xmlCurrent","addCustomPropertiesToXml","text","_object","shouldBreakMaskChain","master","indexedDataSymbolMaster","overrides","symbolOverridesHash","overR","isDefault","indexedDataOverride","affectedLayer","originalOverrideTargetPath","treeBuildOverrideTargetPath","overrideTargetPath","overrideValue","defaultValue","currentValue","overrideParent","prefix","dotIndex","hasOwnProperty","property","imgData","value","nsdata","imgName","NSString","stringWithFormat","imgRelativePath","writeToFile_atomically","currentOver","affectedLayerUsesAnOutOfSyncStyle","overrideStyle","styleFontFilePath","styleXML","treeAddAttributesFromLayerStyle","indexexDataOldSymbol","oldType","newType","newSymbol","getSymbolMasterWithID","indexedDataNewSymbol","hasClippingMask","shallBlockBecauseExportExists","treeAddAttributesFromLayerData","treeAddAttributesFromPointData","currentXMLElement","point","pointType","pointAttributes","x","y","cornerRadius","nativePoint","hasCurveFrom","curveFrom","hasCurveTo","curveTo","treeAddTextBehaviour","isTextLayer","layerTextBehaviour","treeAddAttributesFromTextStyle","layerOrSharedTextStyle","sharedTextStyle","isText","sharedStyle","attributes","opacity","blendingMode","textBehaviour","alignment","verticalAlignment","textColor","getTextColorAsHexValueOrSwatchReference","lineHeight","paragraphSpacing","needFontFamily","fontFamily","needFontSize","fontSize","needFontWeight","fontWeight","needFontStyle","fontStyle","needFontVariant","fontVariant","needFontStretch","fontStretch","needKerning","kerning","needTextTransform","textTransform","needTextUnderline","textUnderline","needTextStrikethrough","textStrikethrough","fontPostscriptNameFromStyle","fontStyleNameFromStyle","borderOptions","startArrowhead","endArrowhead","dashPatternLength","dashPattern","dashPatternString","join","lineEnd","lineJoin","fills","fill","xmlFill","fillAttributes","fillType","getFillColorAsHexValueOrSwatchReference","gradient","gradientType","from","to","aspectRatio","stops","stop","stopAttributes","position","rgbaToArgbOrRgb","color","pattern","patternType","tileScale","borders","border","xmlBorder","borderAttributes","thickness","locked","hidden","transform","rotation","flippedHorizontally","flippedVertically","hasFixedWidth","hasFixedHeight","hasFixedLeft","hasFixedTop","hasFixedRight","roundBy","hasFixedBottom","Math","ceil","flow","target","targetId","animationType","renderingAsImage","isSupportedLayer","treeForceImageExport","exportFormats","hasExports","canExportTypeAsImage","treeAddImageExport","sharedStyleId","isSharedStyleOutOfSync","shapeType","closed","points","escapeCharactersInUnicodePrivateUseArea","endsWith","exportPath","numberOfImages","layerWidth","layerHeight","currentAtN","insets","exportAttr","succeeded","format","exportFormat","MSExportFormat","exportableFilenameForLayerName_exportFormat","sizeText","size","fileFormat","suffix","treeAddLayerInGlobalNamesIndex","layerNamesUnicityByContext","layersStack","contextStack","elements","nameAndType","shift","useActualNameAsType","extractedTypeIsParentType","isLine","extractedType","match","toLowerCase","contextKey","localLayerNamesUnicityHash","counter","hashKey","camelize","lowerCaseFirstCharater","pop","layerId","unshift","rootKey","myId","getLayerWithID","elmts","index","str","xmlParent","fontsSubDir","excludeSystemFonts","fontFileNames","sort","validSwatchName","colorNames","validName","has","get","set","Map","swatchesData","swatch","fromNative","key","b","swatchData","styleNames","stylesData","textStyleData","sharedTextStyleXml","removeDiacritics","firstCharIsInvalid","p1","p2","offset","toUpperCase","capitalize","test","charAt","reduce","replaceRegexp","std","slice","charCodeAt","toString","textStyle","fontPostscriptName","fontDisplayName","NSFont","displayName","fontStyleName","mscolorToHexValueOrSwatchReference","MSAttributedStringColorAttribute","rgbaToArgb","backgroundColor","mscolor","swatchID","mscolorToArgbOrRgb","immutableModelObject","hexValue","round","alpha","textBehaviourValue","nsFont","urlAttribute","fontDescriptor","objectForKey","isLayerGroup","isKindOfClass","MSLayerGroup","MSShapeGroup","isBitmapLayer","MSBitmapLayer","MSTextLayer","isShapeLayer","MSRectangleShape","MSOvalShape","MSPolygonShape","MSStarShape","MSTriangleShape","MSShapePathLayer","isRectangleShape","isRectangle","isOvalShape","isSliceLayer","MSSliceLayer","isArtboard","MSArtboardGroup","isSymbolMaster","MSSymbolMaster","isSymbolInstance","MSSymbolInstance","isSupportedShapeStyle","isSupported","blur","shadows","filter","item","innerShadows","activeItems","numberOfActiveItems","lastItem","module","exports","Basso","Blow","Bottle","Frog","Funk","Hero","Morse","Ping","Pop","Purr","Sosumi","Submarine","Tink","sound","NSSound","soundNamed","play","panel","NSOpenPanel","openPanel","setCanChooseDirectories","setCanChooseFiles","setCanCreateDirectories","NSModalResponseOK","URL","showDialog","app","NSApplication","sharedApplication","displayDialog_withTitle","directoryPathOrFilePath","errorPointer","MOPointer","fileManager","NSFileManager","defaultManager","attributesOfItemAtPath_error","isDirectory","openFile_withApplication","selectFile_inFileViewerRootedAtPath","nil","runCommand","command","args","currentDirectoryPath","task","NSTask","setLaunchPath_","setCurrentDirectoryPath","arguments","launch","waitUntilExit","terminationStatus","source","destination","manager","fileExistsAtPath","copyItemAtPath_toPath_error","fileExists","expandTildeInPath","stringWithString","stringByExpandingTildeInPath","createDirectoryAtPath_withIntermediateDirectories_attributes_error","removeItemAtPath_error","roundWithDecimalPrecision","precision","multiplier","pow","rounder","exportLayerWithFormats","exportName","formats","preserveFrameSize","applyTransformAndOpacity","topInset","bottomInset","leftInset","rightInset","sketchDom","layerToExport","useDuplicate","isRotated","isFlippedHorizontally","isFlippedVertically","parentIsGroup","duplicate","selectedPage","point0","pt0X","pt0Y","point1","pt1X","pt1Y","angleInDegrees","atan2","PI","nativeLayer","absoluteRect","rect","absoluteInfluenceRect","exportRect","CGRectContainsRect","absoluteRectX","origin","absoluteRectY","absoluteRectWidth","absoluteRectHeight","sketchVersion","exportRequest","MSExportRequest","exportRequestsFromExportableLayer_exportFormats_inRect_useIDForName","firstObject","setShouldTrim","saveArtboardOrSlice_toFile","exportRequestFromExportFormat_layer_inRect_useIDForName","remove","maxAtN","max","pngFormat","setFileFormat","setScale","setName","svgFormat","el","elementWithName_stringValue","elementWithName","addAttribute","NSXMLNode","attributeWithName_stringValue","addChild","element","xmlElement","root","doc","NSXMLDocument","documentWithRootElement","xmlData","XMLDataWithOptions","NSXMLNodePrettyPrint","p","writeToFile"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/main.js\");\n","export function onShowAboutDialog(context) {\n    let iconPath = context.plugin.urlForResourceNamed('icon.png').path();\n    let icon = NSImage.alloc().initByReferencingFile(iconPath);\n    let dialog = NSAlert.alloc().init();\n    dialog.setMessageText(\"Ingescape plugin\");\n    dialog.setInformativeText(\"This plugin exports a Sketch file to an Ingescape Pivot format for code generation in Qt/QML, etc. to be used in Ingescape Circle\");\n    dialog.icon = icon;\n    dialog.addButtonWithTitle(\"Get Circle\");\n    dialog.addButtonWithTitle(\"Cancel\");\n\n    let responseCode = dialog.runModal();\n    if (responseCode == NSAlertFirstButtonReturn) {\n        NSWorkspace.sharedWorkspace().openURL(NSURL.URLWithString(\"https://ingescape.com/circle/\"));\n    }  \n}\n\n\nexport function onOpenFileAndExportWholeAsXml(context) {\n    if(context.file) \n    {\n        let Document = require('sketch/dom').Document;\n        let filePath = String(context.file);\n        let fileName = filePath.substring(filePath.lastIndexOf(\"/\")+1, filePath.indexOf(\".\"));\n        fileName = fileName.replace(/[^a-zA-Z0-9\\-_\\s]/g, \"\")\n        fileName = fileName.trim();\n        let fileDir = filePath.substring(0, filePath.lastIndexOf(\"/\")+1) + fileName + \"_export/\";\n\n        // because of a bug, we can't call context.file directly, we must cast it as a string\n        Document.open(String(context.file), (err, document) => {\n            if (err) {\n                console.warn(\"Can't open file \", filePath, true)\n            }\n            else {\n                exportWhole(context, fileDir, false);\n                let document = require('sketch/dom').getSelectedDocument();\n                document.close();\n            }\n        });\n    }\n}\n\n/*\n Exporting file as a library consists in looking for the symbol masters\n declared as components (using the -> symbol) and exposing their\n inner parts in XML structures.\n*/\nexport function onExportLibraryAsXml(context) {\n    let Tree = require(\"./tree.js\");\n    let Xml = require(\"./xml.js\");\n    let Utils = require(\"./utils.js\");\n    let sketch = require('sketch/dom');\n    let document = sketch.getSelectedDocument();\n    let settings = require(\"sketch/settings\");\n    let UI = require('sketch/ui');\n\n    if (!document.path) {\n        UI.alert(\"Sketch2QML: can not export library as XML\", \"You must save your Sketch file first\")\n        return;\n    }\n\n    let path = Utils.chooseFolder();\n    if (!path) {\n        log(\"onExportLibraryAsXml: action cancelled by user\");\n        return;\n    }\n\n    let docPath = decodeURI(document.path);\n    let docPathElements = docPath.split('/');\n    let documentName = \"Default\";\n    if (docPathElements.length > 0) {\n        documentName = Tree.pascalize(docPathElements[docPathElements.length - 1].replace(/.sketch/g,\"\"));\n    }\n\n    let libraryName = documentName;\n\n    // Init directories\n    let libraryFontsSubDir = \"resources/\" + libraryName + \"_library/fonts/\";\n    let libraryImagesSubDir = \"resources/\" + libraryName + \"_library/images/\";\n    Utils.createDirectoryIfNeeded(path + libraryFontsSubDir);\n    Utils.forceNewDirectory(path + libraryImagesSubDir);\n\n    UI.message(\" Exporting library as Ingescape Pivot format. Please wait...\");\n\n    let documentContext = Tree.initDocumentContext();\n\n    //init lib\n    let xmlLibraryRoot = NSXMLElement.alloc().initWithName(\"library\");\n    Xml.xmlAddAttributesToElement(xmlLibraryRoot, [\"name\", libraryName, \"sketchVersion\", settings.version.sketch]);\n\n    //export lib\n    let symbols = document.getSymbols();\n    let symbolsIDs = [];\n    for (let i = 0; symbols && (i < symbols.length); i++){\n        let currentSymbol = symbols[i];\n\n        if (currentSymbol.name.startsWith(\"#\")){\n            continue;\n        }\n\n        if (symbolsIDs.includes(currentSymbol.id)){\n            log(\"WARNING: symbol already included (ID=\" + currentSymbol.id + \", name \" + currentSymbol.name + \")\");\n            continue;\n        } else {\n            symbolsIDs.push(currentSymbol.id);\n        }\n\n        let indexedData = documentContext.globalNamesIndex[currentSymbol.id];\n        if (!indexedData){\n            log(\"could not find indexed data for \" + currentSymbol.name + \". This element will be ignored\");\n            log(\"\\t->Please check that it is not an external master that has not been made local.\")\n            continue;\n        }\n        let actualName = Tree.getUniqueNameFromIndexedData(indexedData);\n        let actualType = Tree.getTypeFromIndexedData(indexedData);\n        let keyValues = Tree.getKeyValuesFromIndexedData(indexedData);\n        let parentType = Tree.getParentTypeFromIndexedData(indexedData);\n\n        let xmlComponent = Xml.xmlAddElement(xmlLibraryRoot, \"component\", \n                                        [\"type\", actualType, \"name\", actualName, \n                                        \"width\", currentSymbol.frame.width, \"height\", currentSymbol.frame.height,\n                                        \"hasBackground\", (currentSymbol.background.enabled && currentSymbol.background.includedInInstance),\n                                        \"backgroundColor\", Tree.getBackgroundColorAsHexValueOrSwatchReference(currentSymbol)],\n                                         null);\n\n        if (parentType)\n            Xml.xmlAddAttributesToElement(xmlComponent, [\"parentType\", parentType]);\n\n        if (keyValues.length > 0)\n            Xml.xmlAddCustomPropertiesToElement(xmlComponent, keyValues);\n\n        Tree.treeIterateLayers(currentSymbol.layers, xmlComponent, false, path, libraryImagesSubDir, xmlLibraryRoot, documentContext, null);\n    }\n\n    Tree.addSharedTextStylesToXml(xmlLibraryRoot);\n    Tree.addFontFilesToXml(xmlLibraryRoot, path, libraryFontsSubDir, documentContext.fontFiles, false);\n    Tree.addColorVariablesToXml(xmlLibraryRoot); // NB: it must be done after all exports because styles and items may use not imported swatches\n    Tree.clearTempContext();\n    \n    //export model to XML\n    let xmlFilePath = path + libraryName + \"_library.xml\";\n    Xml.exportXMLToPath(xmlFilePath, xmlLibraryRoot);\n\n    Utils.playSoundNamed(Utils.Sounds.Glass);\n    UI.message(\" Library export completed to \" + xmlFilePath);\n    Utils.showInFinder(xmlFilePath); \n}\n\n\n/*\n Exports all artboards and orphan layers as windows\n */\nexport function onExportApplicationAsXml(context) {\n    let Tree = require(\"./tree.js\");\n    let Xml = require(\"./xml.js\");\n    let Utils = require(\"./utils.js\");\n    let sketch = require('sketch/dom')\n    let document = sketch.getSelectedDocument();\n    let settings = require(\"sketch/settings\");\n    let UI = require('sketch/ui');\n\n    if (!document.path) {\n        UI.alert(\"Sketch2QML: can not export application as XML\", \"You must save your Sketch file first\")\n        return;\n    }\n\n    let path = Utils.chooseFolder();\n    if (!path){\n        log(\"onExportApplicationAsXml: action cancelled by user\");\n        return;\n    }\n\n    let docPath = decodeURI(document.path);\n    let docPathElements = docPath.split('/');\n    let documentName = \"Default\";\n    if (docPathElements.length > 0){\n        documentName = Tree.pascalize(docPathElements[docPathElements.length - 1].replace(/.sketch/g,\"\"));\n    }\n\n    let appName = documentName;\n\n    // Init directories\n    let appFontsSubDir = \"resources/\" + appName + \"_app/fonts/\";\n    let appImagesSubDir = \"resources/\" + appName + \"_app/images/\";\n    Utils.createDirectoryIfNeeded(path + appFontsSubDir);\n    Utils.forceNewDirectory(path + appImagesSubDir);\n \n\n    UI.message(\" Exporting application as Ingescape Pivot format. Please wait...\");\n\n    let documentContext = Tree.initDocumentContext();\n\n    //init app\n    let xmlAppRoot = NSXMLElement.alloc().initWithName(\"app\");\n    Xml.xmlAddAttributesToElement(xmlAppRoot, [\"name\", appName, \"sketchVersion\", settings.version.sketch]);\n    \n\n    //export app\n    for (let i = 0; i < document.pages.length; i++){\n        let page = document.pages[i]\n        if (page.name.startsWith(\"#\")){\n            continue;\n        }\n\n        let xmlPage = Xml.xmlAddElement(xmlAppRoot, \"page\", [\"name\", page.name], null);\n        \n        // Artboard and elements outside of artboards\n        let artboards = [];\n        let layers = [];\n        for (let j = 0; j < page.layers.length; j++){\n            let artboardOrlayer = page.layers[j];\n            let type = artboardOrlayer.sketchObject.class();\n            if (type != \"MSArtboardGroup\"){\n                layers.push(artboardOrlayer);\n            } else {\n                artboards.push(artboardOrlayer);\n            }\n        }\n\n        Tree.treeIterateLayers(layers, xmlPage, true, path, appImagesSubDir, xmlAppRoot, documentContext, null);\n        \n        for (let j = 0; j < artboards.length; j++) {\n            let artboard = artboards[j];\n\n            if (artboard.name.startsWith(\"#\")){\n                continue;\n            }\n\n            let indexedData = documentContext.globalNamesIndex[artboard.id];\n            if (!indexedData){\n                log(\"could not find indexed data for \" + artboard.name + \". This artboard will be ignored\");\n                continue;\n            }\n\n            let actualName = Tree.getUniqueNameFromIndexedData(indexedData);\n            let actualType = Tree.getTypeFromIndexedData(indexedData);\n            let keyValues = Tree.getKeyValuesFromIndexedData(indexedData);\n            let parentType = Tree.getParentTypeFromIndexedData(indexedData);\n\n            let xmlScreen = Xml.xmlAddElement(xmlPage, \"screen\", \n                                        [\"type\", actualType, \"name\", actualName, \n                                        \"width\", artboard.frame.width, \"height\", artboard.frame.height,\n                                        \"hasBackground\", (artboard.background.enabled && artboard.background.includedInExport),\n                                        \"backgroundColor\", Tree.getBackgroundColorAsHexValueOrSwatchReference(artboard)],\n                                         null);\n\n            if (parentType)\n                Xml.xmlAddAttributesToElement(xmlScreen, [\"parentType\", parentType]);                                         \n\n            if (keyValues.length > 0)\n                Xml.xmlAddCustomPropertiesToElement(xmlScreen, keyValues);\n\n            Tree.treeIterateLayers(artboard.layers, xmlScreen, true, path, appImagesSubDir, xmlAppRoot, documentContext, null);\n        }\n     }\n\n    Tree.addSharedTextStylesToXml(xmlAppRoot);\n    Tree.addFontFilesToXml(xmlAppRoot, path, appFontsSubDir, documentContext.fontFiles, false);\n    Tree.addColorVariablesToXml(xmlAppRoot); // NB: it must be done after all exports because styles and items may use not imported swatches\n    Tree.clearTempContext();\n    \n    let xmlFilePath = path + appName + \"_app.xml\"\n    Xml.exportXMLToPath(xmlFilePath, xmlAppRoot);\n\n    Utils.playSoundNamed(Utils.Sounds.Glass);\n    UI.message(\" App export completed to \" + xmlFilePath);\n    Utils.showInFinder(xmlFilePath); \n};\n\n\nfunction exportWhole(context, exportDir = \"\", interactionsAllowed = true) {\n    let Tree = require(\"./tree.js\");\n    let Xml = require(\"./xml.js\");\n    let Utils = require(\"./utils.js\");\n    let sketch = require('sketch/dom');\n    let document = sketch.getSelectedDocument();\n    let settings = require(\"sketch/settings\");\n    let UI = require('sketch/ui');\n\n    let path = (interactionsAllowed && (exportDir === \"\")) ? Utils.chooseFolder() : exportDir;\n    if (!path){\n        log(\"exportWhole: action cancelled by user\");\n        return;\n    }\n\n    let docPath = decodeURI(document.path);\n    let docPathElements = docPath.split('/');\n    let documentName = \"Default\";\n    if (docPathElements.length > 0){\n        documentName = Tree.pascalize(docPathElements[docPathElements.length - 1].replace(/.sketch/g,\"\"));\n    }\n\n    let appName = documentName;\n    let libraryName = documentName;\n\n    // Init directories\n    let appFontsSubDir = \"resources/\" + appName + \"_app/fonts/\";\n    let appImagesSubDir = \"resources/\" + appName + \"_app/images/\";\n    let libraryFontsSubDir = \"resources/\" + libraryName + \"_library/fonts/\";\n    let libraryImagesSubDir = \"resources/\" + libraryName + \"_library/images/\";\n    Utils.createDirectoryIfNeeded(path + appFontsSubDir);\n    Utils.forceNewDirectory(path + appImagesSubDir);\n    Utils.createDirectoryIfNeeded(path + libraryFontsSubDir);\n    Utils.forceNewDirectory(path + libraryImagesSubDir);\n        \n\n    let maxNumberOfSteps = 2;\n    UI.message(\" [1/\" + maxNumberOfSteps+ \"] Exporting library as Ingescape Pivot format. Please wait...\");\n\n    let documentContext = Tree.initDocumentContext();\n\n    //export library\n    let xmlLibraryRoot = NSXMLElement.alloc().initWithName(\"library\");\n    Xml.xmlAddAttributesToElement(xmlLibraryRoot, [\"name\", libraryName, \"sketchVersion\", settings.version.sketch]);\n    \n    let symbols = document.getSymbols();\n    let symbolsIDs = [];\n    for (let i = 0; symbols && (i < symbols.length); i++){\n        let currentSymbol = symbols[i];\n\n        if (currentSymbol.name.startsWith(\"#\")){\n            continue;\n        }\n\n        if (symbolsIDs.includes(currentSymbol.id)){\n            log(\"WARNING: symbol already included (ID=\" + currentSymbol.id + \", name \" + currentSymbol.name + \")\");\n            continue;\n        } else {\n            symbolsIDs.push(currentSymbol.id);\n        }\n\n        let indexedData = documentContext.globalNamesIndex[currentSymbol.id];\n        if (!indexedData){\n            log(\"could not find indexed data for \" + currentSymbol.name + \". This element will be ignored\");\n            log(\"\\t->Please check that it is not an external master that has not been made local.\")\n            continue;\n        }\n\n        let actualName = Tree.getUniqueNameFromIndexedData(indexedData);\n        let actualType = Tree.getTypeFromIndexedData(indexedData);\n        let keyValues = Tree.getKeyValuesFromIndexedData(indexedData);\n        let parentType = Tree.getParentTypeFromIndexedData(indexedData);\n\n        let xmlComponent = Xml.xmlAddElement(xmlLibraryRoot, \"component\", \n                                        [\"type\", actualType, \"name\", actualName, \n                                        \"width\", currentSymbol.frame.width, \"height\", currentSymbol.frame.height,\n                                        \"hasBackground\", (currentSymbol.background.enabled && currentSymbol.background.includedInInstance),\n                                        \"backgroundColor\", Tree.getBackgroundColorAsHexValueOrSwatchReference(currentSymbol)], \n                                        null);\n\n        if (parentType)\n            Xml.xmlAddAttributesToElement(xmlComponent, [\"parentType\", parentType]);\n\n        if (keyValues.length > 0)\n            Xml.xmlAddCustomPropertiesToElement(xmlComponent, keyValues);\n\n        Tree.treeIterateLayers(currentSymbol.layers, xmlComponent, false, path, libraryImagesSubDir, xmlLibraryRoot, documentContext, null);\n    }\n\n    Tree.addSharedTextStylesToXml(xmlLibraryRoot);\n    Tree.addFontFilesToXml(xmlLibraryRoot, path, libraryFontsSubDir, documentContext.fontFiles, false);\n    Tree.addColorVariablesToXml(xmlLibraryRoot); // NB: it must be done after all exports because styles and items may use not imported swatches\n\n    Xml.exportXMLToPath(path+libraryName+\"_library.xml\", xmlLibraryRoot);\n\n\n    \n    //export app\n    UI.message(\" [2/\" + maxNumberOfSteps + \"] Exporting application as Ingescape Pivot format. Please wait...\");\n\n    let xmlAppRoot = NSXMLElement.alloc().initWithName(\"app\");\n    Xml.xmlAddAttributesToElement(xmlAppRoot, [\"name\", appName, \"sketchVersion\", settings.version.sketch]);\n\n    for (let i = 0; i < document.pages.length; i++){\n        let page = document.pages[i]\n        if (page.name.startsWith(\"#\")){\n            continue;\n        }\n\n        let xmlPage = Xml.xmlAddElement(xmlAppRoot, \"page\", [\"name\", page.name], null);\n\n        // Artboard and elements outside of artboards\n        let artboards = [];\n        let layers = [];\n        for (let j = 0; j < page.layers.length; j++) {\n            let artboardOrlayer = page.layers[j];\n            let type = artboardOrlayer.sketchObject.class();\n            if (type != \"MSArtboardGroup\"){\n                layers.push(artboardOrlayer);\n            } else {\n                artboards.push(artboardOrlayer);\n            }\n        }\n        \n        Tree.treeIterateLayers(layers, xmlPage, true, path, appImagesSubDir, xmlAppRoot, documentContext, null);\n        \n        for (let j = 0; j < artboards.length; j++) {\n            let artboard = artboards[j];\n\n            if (artboard.name.startsWith(\"#\")){\n                continue;\n            }\n\n            let indexedData = documentContext.globalNamesIndex[artboard.id];\n            if (!indexedData){\n                log(\"could not find indexed data for \" + artboard.name + \". This artboard will be ignored\");\n                continue;\n            }\n\n            let actualName = Tree.getUniqueNameFromIndexedData(indexedData);\n            let actualType = Tree.getTypeFromIndexedData(indexedData);\n            let keyValues = Tree.getKeyValuesFromIndexedData(indexedData);\n            let parentType = Tree.getParentTypeFromIndexedData(indexedData);\n\n            let xmlScreen = Xml.xmlAddElement(xmlPage, \"screen\", \n                                        [\"type\", actualType, \"name\", actualName, \n                                        \"width\", artboard.frame.width, \"height\", artboard.frame.height,\n                                        \"hasBackground\", (artboard.background.enabled && artboard.background.includedInExport),\n                                        \"backgroundColor\", Tree.getBackgroundColorAsHexValueOrSwatchReference(artboard)],\n                                         null);\n            \n            if (parentType)\n                Xml.xmlAddAttributesToElement(xmlScreen, [\"parentType\", parentType]);\n\n            if (keyValues.length > 0)\n                Xml.xmlAddCustomPropertiesToElement(xmlScreen, keyValues);\n\n            Tree.treeIterateLayers(artboard.layers, xmlScreen, true, path, appImagesSubDir, xmlAppRoot, documentContext, null);\n        }\n    }\n\n    Tree.addSharedTextStylesToXml(xmlAppRoot);\n    Tree.addFontFilesToXml(xmlAppRoot, path, appFontsSubDir, documentContext.fontFiles, false);\n    Tree.addColorVariablesToXml(xmlAppRoot); // NB: it must be done after all exports because styles and items may use not imported swatches\n    Tree.clearTempContext();\n\n    Xml.exportXMLToPath(path+appName+\"_app.xml\", xmlAppRoot);\n\n    if (interactionsAllowed) \n    {\n        Utils.playSoundNamed(Utils.Sounds.Glass);\n        UI.message(\" Export of app and lib completed to \" + path);\n        Utils.showInFinder(path);\n    }\n};\n\n\nexport function onExportWholeAsXml(context) {\n    exportWhole(context);\n};\n\n\n\n/** \n * ----------------------------------------------------\n * DEBUG ONLY\n * ----------------------------------------------------  \n*/\n\n\nexport function onExportFonts(context) {\n    let Utils = require(\"./utils.js\");\n\n    let path = Utils.chooseFolder();\n    if (path)\n    {\n        let Tree = require(\"./tree.js\");\n        let document = require('sketch/dom').getSelectedDocument();\n        let UI = require('sketch/ui');\n        let fontFiles = [];\n\n        document.pages.forEach(page => {\n            Tree.getFontFilesUsedByLayer(page, fontFiles);     \n        });\n\n        if (fontFiles.length > 0) \n        {\n            fontFiles.forEach(fontFile => {\n                let fileName = fontFile.substring(fontFile.lastIndexOf('/') + 1);\n                Utils.copyFile(fontFile, path + fileName);\n            });\n\n            UI.message(\" Export completed - \" + fontFiles.length + \" font(s) exported to \" + path);\n            Utils.showInFinder(path);\n        } \n        else \n        {\n            UI.alert(\"Sketch2QML: can not export fonts\", \" No font found in your Sketch document\");\n        }\n    } \n    else \n    {\n        log(\"onExportFonts: action cancelled by user\");\n    } \n};\n\n\nexport function onExportSelectedLayersAsPNG(context) {\n    let Utils = require(\"./utils.js\");\n    let document = require('sketch/dom').getSelectedDocument();\n    let UI = require('sketch/ui');\n\n    let selectedLayers = document.selectedLayers;\n    if (selectedLayers.length == 0) \n    {\n        UI.alert(\"Sketch2QML: can not export PNG\", \" No layers are selected \\n=> Please select one or multiple layers before exporting.\");\n        NSBeep();\n\t\treturn;\n\t}\n\n    let path = Utils.chooseFolder();\n    if (path)\n    {\n        selectedLayers.forEach(layer => {\n            Utils.exportLayerAsPNG(layer, 4, path, layer.name, false, false);\n            //Utils.exportLayerAsPNG(layer, 4, path, layer.name + \"--frame-opacityAndTransform\", true, true);\n            //Utils.exportLayerAsPNG(layer, 4, path, layer.name + \"--noframe-opacityAndTransform\", false, true);\n            //Utils.exportLayerAsPNG(layer, 4, path, layer.name + \"--frame-noopacityAndTransform\", true, false);\n        });\n\n        UI.message(\" Export completed to \" + path);\n        Utils.showInFinder(path);\n    } \n    else \n    {\n        log(\"onExportSelectedLayersAsPNG: action cancelled by user\");\n    } \n};\n\n\nexport function onExportSelectedLayersAsSVG(context) {\n    let Utils = require(\"./utils.js\");\n    let document = require('sketch/dom').getSelectedDocument();\n    let UI = require('sketch/ui');\n\n    let selectedLayers = document.selectedLayers;\n    if (selectedLayers.length == 0) \n    {\n        UI.alert(\"Sketch2QML: can not export SVG\", \" No layers are selected \\n=> Please select one or multiple layers before exporting.\");\n        NSBeep();\n\t\treturn;\n\t}\n\n    let path = Utils.chooseFolder();\n    if (path)\n    {\n        selectedLayers.forEach(layer => {\n            Utils.exportLayerAsSVG(layer, path, layer.name, false, false);\n            //Utils.exportLayerAsSVG(layer, path, layer.name + \"--frame-opacityAndTransform\", true, true);\n            //Utils.exportLayerAsSVG(layer, path, layer.name + \"--noframe-opacityAndTransform\", false, true);\n            //Utils.exportLayerAsSVG(layer, path, layer.name + \"--frame-noopacityAndTransform\", true, false);\n        });\n\n        UI.message(\" Export completed to \" + path);\n        Utils.showInFinder(path);\n    } \n    else \n    {\n        log(\"onExportSelectedLayersAsSVG: action cancelled by user\");\n    } \n};\n\n\nexport function onExportSelectedLayersWithUserPredefinedExportOptions(context) {\n    let Utils = require(\"./utils.js\");\n    let document = require('sketch/dom').getSelectedDocument();\n    let UI = require('sketch/ui');\n   \n    let selectedLayers = document.selectedLayers;\n    if (selectedLayers.length == 0) \n    {\n        UI.alert(\"Sketch2QML: can not export images\", \" No layers are selected \\n=> Please select one or multiple layers before exporting.\");\n        NSBeep();\n\t\treturn;\n\t}\n\n    let path = Utils.chooseFolder();\n    if (path)\n    {\n        selectedLayers.forEach(layer => {\n            Utils.exportLayerWithUserDefinedExportOptions(layer, path, layer.name, false, false);\n            //Utils.exportLayerWithUserDefinedExportOptions(layer, path, layer.name + \"--frame-opacityAndTransform\", true, true);\n            //Utils.exportLayerWithUserDefinedExportOptions(layer, path, layer.name + \"--noframe-opacityAndTransform\", false, true);\n            //Utils.exportLayerWithUserDefinedExportOptions(layer, path, layer.name + \"--frame-noopacityAndTransform\", true, false);\n        });\n\n        UI.message(\" Export completed to \" + path);\n        Utils.showInFinder(path);\n    } \n    else \n    {\n        log(\"onExportSelectedLayersWithUserPredefinedExportOptions: action cancelled by user\");\n    } \n};\n\n\n","// TODO: add all reserved keywords\nlet forbiddenNames = [\n  \"bool\",\n  \"true\",\n  \"false\",\n  \"double\",\n  \"float\",\n  \"real\",\n  \"int\",\n  \"long\",\n  \"short\",\n  \"string\",\n  \"url\",\n  \"var\",\n  \"let\",\n  \"function\",\n  \"if\",\n  \"else\",\n  \"for\",\n  \"while\",\n  \"do\",\n  \"break\",\n  \"switch\",\n  \"case\",\n  \"default\",\n  \"continue\",\n  \"root\",\n  \"delete\",\n  \"bottom\",\n  \"top\",\n  \"left\",\n  \"right\",\n  \"baseline\"\n];\n\n\nlet diacriticsMap = {\n    A: /[\\u0041\\u24B6\\uFF21\\u00C0\\u00C1\\u00C2\\u1EA6\\u1EA4\\u1EAA\\u1EA8\\u00C3\\u0100\\u0102\\u1EB0\\u1EAE\\u1EB4\\u1EB2\\u0226\\u01E0\\u00C4\\u01DE\\u1EA2\\u00C5\\u01FA\\u01CD\\u0200\\u0202\\u1EA0\\u1EAC\\u1EB6\\u1E00\\u0104\\u023A\\u2C6F]/g,\n    AE: /[\\u00C6]/g,\n    E: /[\\u0045\\u24BA\\uFF25\\u00C8\\u00C9\\u00CA\\u1EC0\\u1EBE\\u1EC4\\u1EC2\\u1EBC\\u0112\\u1E14\\u1E16\\u0114\\u0116\\u00CB\\u1EBA\\u011A\\u0204\\u0206\\u1EB8\\u1EC6\\u0228\\u1E1C\\u0118\\u1E18\\u1E1A\\u0190\\u018E]/g,\n    I: /[\\u0049\\u24BE\\uFF29\\u00CC\\u00CD\\u00CE\\u0128\\u012A\\u012C\\u0130\\u00CF\\u1E2E\\u1EC8\\u01CF\\u0208\\u020A\\u1ECA\\u012E\\u1E2C\\u0197]/g,\n    O: /[\\u004F\\u24C4\\uFF2F\\u00D2\\u00D3\\u00D4\\u1ED2\\u1ED0\\u1ED6\\u1ED4\\u00D5\\u1E4C\\u022C\\u1E4E\\u014C\\u1E50\\u1E52\\u014E\\u022E\\u0230\\u00D6\\u022A\\u1ECE\\u0150\\u01D1\\u020C\\u020E\\u01A0\\u1EDC\\u1EDA\\u1EE0\\u1EDE\\u1EE2\\u1ECC\\u1ED8\\u01EA\\u01EC\\u00D8\\u01FE\\u0186\\u019F\\uA74A\\uA74C]/g,\n    OE: /[\\u0152]/g,\n    U: /[\\u0055\\u24CA\\uFF35\\u00D9\\u00DA\\u00DB\\u0168\\u1E78\\u016A\\u1E7A\\u016C\\u00DC\\u01DB\\u01D7\\u01D5\\u01D9\\u1EE6\\u016E\\u0170\\u01D3\\u0214\\u0216\\u01AF\\u1EEA\\u1EE8\\u1EEE\\u1EEC\\u1EF0\\u1EE4\\u1E72\\u0172\\u1E76\\u1E74\\u0244]/g,\n    a: /[\\u0061\\u24D0\\uFF41\\u1E9A\\u00E0\\u00E1\\u00E2\\u1EA7\\u1EA5\\u1EAB\\u1EA9\\u00E3\\u0101\\u0103\\u1EB1\\u1EAF\\u1EB5\\u1EB3\\u0227\\u01E1\\u00E4\\u01DF\\u1EA3\\u00E5\\u01FB\\u01CE\\u0201\\u0203\\u1EA1\\u1EAD\\u1EB7\\u1E01\\u0105\\u2C65\\u0250]/g,\n    ae: /[\\u00E6\\u01FD\\u01E3]/g,\n    c: /[\\u0063\\u24D2\\uFF43\\u0107\\u0109\\u010B\\u010D\\u00E7\\u1E09\\u0188\\u023C\\uA73F\\u2184]/g,\n    e: /[\\u0065\\u24D4\\uFF45\\u00E8\\u00E9\\u00EA\\u1EC1\\u1EBF\\u1EC5\\u1EC3\\u1EBD\\u0113\\u1E15\\u1E17\\u0115\\u0117\\u00EB\\u1EBB\\u011B\\u0205\\u0207\\u1EB9\\u1EC7\\u0229\\u1E1D\\u0119\\u1E19\\u1E1B\\u0247\\u025B\\u01DD]/g,\n    i: /[\\u0069\\u24D8\\uFF49\\u00EC\\u00ED\\u00EE\\u0129\\u012B\\u012D\\u00EF\\u1E2F\\u1EC9\\u01D0\\u0209\\u020B\\u1ECB\\u012F\\u1E2D\\u0268\\u0131]/g,\n    o: /[\\u006F\\u24DE\\uFF4F\\u00F2\\u00F3\\u00F4\\u1ED3\\u1ED1\\u1ED7\\u1ED5\\u00F5\\u1E4D\\u022D\\u1E4F\\u014D\\u1E51\\u1E53\\u014F\\u022F\\u0231\\u00F6\\u022B\\u1ECF\\u0151\\u01D2\\u020D\\u020F\\u01A1\\u1EDD\\u1EDB\\u1EE1\\u1EDF\\u1EE3\\u1ECD\\u1ED9\\u01EB\\u01ED\\u00F8\\u01FF\\u0254\\uA74B\\uA74D\\u0275]/g,\n    oe: /[\\u0153]/g,\n    u: /[\\u0075\\u24E4\\uFF55\\u00F9\\u00FA\\u00FB\\u0169\\u1E79\\u016B\\u1E7B\\u016D\\u00FC\\u01DC\\u01D8\\u01D6\\u01DA\\u1EE7\\u016F\\u0171\\u01D4\\u0215\\u0217\\u01B0\\u1EEB\\u1EE9\\u1EEF\\u1EED\\u1EF1\\u1EE5\\u1E73\\u0173\\u1E77\\u1E75\\u0289]/g\n  };\n\n\nlet numberOfImagesPerLayerExport = 2; // 2 => (original size, @2x), 4 => (original size, @2x, @3x, @4x)\n\nlet maximumImageWidthOrHeight = 16384;\n\nlet GLOBALNAMESINDEX_UNIQUENAME = 0;\nlet GLOBALNAMESINDEX_TYPE = 1;\nlet GLOBALNAMESINDEX_KEYVALUES = 2;\nlet GLOBALNAMESINDEX_RAWNAME = 3;\nlet GLOBALNAMESINDEX_PARENTTYPE = 4;\n\nlet TEMP_CONTEXT = {};\n\n\nfunction getUniqueNameFromIndexedData(data) {\n    return data[GLOBALNAMESINDEX_UNIQUENAME];\n}\n\n\nfunction getTypeFromIndexedData(data) {\n    return data[GLOBALNAMESINDEX_TYPE];\n}\n\n\nfunction getKeyValuesFromIndexedData(data) {\n    return data[GLOBALNAMESINDEX_KEYVALUES];\n}\n\n\nfunction getRawNameFromIndexedData(data) {\n    return data[GLOBALNAMESINDEX_RAWNAME];\n}\n\n\nfunction getParentTypeFromIndexedData(data) {\n    return data[GLOBALNAMESINDEX_PARENTTYPE];\n}\n\n\nfunction clearTempContext() {\n    TEMP_CONTEXT = {\n        availableSwatchIDs: [],\n        missingSwatches: {}\n    };\n}\n\n\nfunction initDocumentContext() {\n    clearTempContext();\n\n    let documentContext = {\n        fontFiles: [],\n        sharedLayerStylesIndex: {},\n        sharedTextStylesIndex: {},\n        globalNamesIndex: {},\n        textsWithOutOfSyncStyle: {}\n    };\n\n    let sketch = require('sketch/dom');\n    let document = sketch.getSelectedDocument();\n\n    document.sharedLayerStyles.forEach(style => {\n        documentContext.sharedLayerStylesIndex[style.id] = style;\n    });\n\n    document.sharedTextStyles.forEach(style => {\n        documentContext.sharedTextStylesIndex[style.id] = style;\n    });\n\n    treePopulateGlobalNamesIndex(documentContext);\n    let nb = Object.keys(documentContext.globalNamesIndex).length;\n    log(\"Indexed elements : \" + nb);\n\n    let usedNativeSwatches = document.sketchObject.documentData().allSwatches();\n    if (usedNativeSwatches.length > 0) {\n        usedNativeSwatches.forEach(nativeSwatch => {\n            TEMP_CONTEXT.availableSwatchIDs.push(String(nativeSwatch.objectID()));\n        });\n    }\n\n    return documentContext;\n}\n\n\nfunction addFontFileToContext(context, fontFilePath) {\n    if (context && context.fontFiles && fontFilePath && !context.fontFiles.includes(fontFilePath))\n        context.fontFiles.push(fontFilePath);\n}\n\n\nfunction getFontFilesUsedByLayer(layer, result) {\n    if (layer) {\n        let fontFilePath = layerFontFilePath(layer);\n        if (fontFilePath && !result.includes(fontFilePath)) {\n            result.push(fontFilePath);\n        }\n\n        if (layer.layers && (layer.layers.length > 0)) {\n            layer.layers.forEach(subLayer => {\n                getFontFilesUsedByLayer(subLayer, result);\n            });\n        }\n    }\n}\n\n\nfunction treeIterateLayers(layers, parent, shallIgnoreSymbolMasters, rootDirPath, imagesSubDir, xmlRoot,\n                            documentContext, mask){\n    let Xml = require(\"./xml.js\");\n    let sketch = require('sketch/dom');\n    let document = sketch.getSelectedDocument();\n    let actualParent = parent; //parent may change during iteration (when finding masks)\n    let currentMask = null;\n    \n    for (let i = 0; layers && (i < layers.length); i++){\n        let l = layers[i]\n        let type = l.sketchObject.class()\n        let name = l.name;\n\n        // We skip special elements\n        if (name.startsWith(\"#\"))\n            continue\n\n        if ((type == \"MSSymbolMaster\") && shallIgnoreSymbolMasters){\n            continue;\n        } else if ((type == \"MSArtboardGroup\") || (type == \"MSSliceLayer\") || (type == \"MSHotspotLayer\")) {\n            continue;\n        } \n        \n        let indexedData = documentContext.globalNamesIndex[l.id];\n        if (!indexedData){\n            log(\"ERROR: could not find indexed data for \" + l.name + \" (\" + l.id + \") : ignore this element.\");\n            continue;\n        }\n        let actualName = getUniqueNameFromIndexedData(indexedData);\n        let actualType = getTypeFromIndexedData(indexedData);\n        let keyValues = getKeyValuesFromIndexedData(indexedData);\n\n        let isCustomClass = false;\n        \n        //handle special types that will add specific beacons in XML or require specific logics\n        if (actualType == \"includeLibrary\"){\n            let rawName = getRawNameFromIndexedData(indexedData);\n            let xmlCurrent = Xml.xmlAddElement(actualParent, \"include\", [\"name\", rawName], null);\n            if (keyValues.length > 0)\n                addCustomPropertiesToXml(xmlCurrent, keyValues);\n\n        } else if (actualType == \"includeExternal\") {\n            let xmlCurrent = Xml.xmlAddElement(actualParent, \"external\", [\"name\", actualName], null);\n            if (keyValues.length > 0)\n                addCustomPropertiesToXml(xmlCurrent, keyValues);\n            \n        } else if ((type == \"MSTextLayer\") && (actualType == \"includeData\")) {\n            let xmlCurrent = Xml.xmlAddElement(actualParent, \"data\", [\"name\", actualName], l.text);\n            if (keyValues.length > 0)\n                addCustomPropertiesToXml(xmlCurrent, keyValues);\n                \n        } else {\n            //FIXME: using internal Sketch API that might change in future versions\n            if (l._object.shouldBreakMaskChain()){\n                actualParent = parent; //restore original parent because we break mask chain with this element\n                currentMask = null;\n            }\n            \n            let xmlCurrent = Xml.xmlAddElement(actualParent, \"item\", [\"name\", actualName], null);\n\n            addFontFileToContext(documentContext, layerFontFilePath(l));\n            \n            if (type == \"MSSymbolInstance\") {\n                if (!l.master) {\n                    log(\"could not find the symbol master used by \" + l.name);\n                    log(\"\\t->Please check that it does not use an external symbol master that has not been made local.\")\n                    continue;\n                }\n\n                //Instance is from a specific class and will be handled as a future software component instance\n                let indexedDataSymbolMaster = documentContext.globalNamesIndex[l.master.id];\n                if (!indexedDataSymbolMaster) {\n                    log(\"could not find indexed data for \" + l.master.name);\n                    log(\"\\t->Please check that it is not an external symbol master that has not been made local.\")\n                    continue;\n                }\n                \n                actualType = getTypeFromIndexedData(indexedDataSymbolMaster); //get resolved type from master symbol\n                isCustomClass = true;\n                type = actualType; //this will relevantly block iteration on subelements at the end of this function\n                \n                //Symbol instances require specific management around overrides\n                //Overrides are stored \"as-is\" to be applied as property values during code generation.\n                if (l.overrides){\n                    let nb = l.overrides.length;\n                    let symbolOverridesHash = {};\n                    for (let j = 0; j < nb; j++){\n                        let overR = l.overrides[j];\n\n                        if (!overR.isDefault){\n                            let indexedDataOverride = documentContext.globalNamesIndex[overR.affectedLayer.id];\n                            let originalOverrideTargetPath = treeBuildOverrideTargetPath(overR, documentContext.globalNamesIndex);\n                            let overrideTargetPath = originalOverrideTargetPath;\n                            if (!indexedDataOverride){\n                                log(\"ERROR: could not find indexed data for \" + overR.affectedLayer.name + \" (\" + overR.affectedLayer.id + \"). Please check that this element is not rendered as an image.\");\n                                continue;\n                            }\n                            //log(\"handling override for \" + overR.affectedLayer.id + \" - \" + overR.affectedLayer.name + \" - \" +  + \" (\" + indexedDataOverride + \")\");\n\n\n                            //handle false positive i.e. overrides that use the default value even if isDefault returns false\n                            // => it happens when:\n                            //  - a symbol overrides a text and this symbol is instantiated in other symbols\n                            //  - a graphic designer changes the style of an instance and then reselect the default style\n                            if (overR.sketchObject && (!overR.sketchObject.overrideValue() || (overR.sketchObject.defaultValue() == overR.sketchObject.currentValue())))\n                            {\n                                //log(\"Skipping false override: layer=\" + l.name + \" path=\" + originalOverrideTargetPath + \" value=\" + overR.value);\n                                continue;\n                            }\n\n                            \n                            //handle possible nesting of overrides\n                            let overrideParent = xmlCurrent; //set default parent for override data (may change with symbol overrides)\n\n                            let prefix = overrideTargetPath;\n                            let dotIndex = overrideTargetPath.lastIndexOf(\".\");\n                            while (dotIndex >= 0) {\n                                prefix = prefix.substring(0, dotIndex);\n                                //log(\"check prefix \" + prefix + \" for \" + overrideTargetPath);\n                                if ((prefix.length > 0) & symbolOverridesHash.hasOwnProperty(prefix)) {\n                                    //log(\"found prefix \" + prefix + \" for \" + overrideTargetPath);\n                                    overrideParent = symbolOverridesHash[prefix];\n                                    overrideTargetPath = overrideTargetPath.substring(dotIndex + 1, overrideTargetPath.length);\n                                    break;\n                                } else {\n                                    dotIndex = prefix.lastIndexOf(\".\");\n                                }\n                            }\n                            \n                            if (overR.property == \"image\") {\n                                //we generate image file from data\n                                let imgData = overR.value.nsdata;\n                                let imgName = NSString.stringWithFormat(\"%@.png\", overR.id);\n                                let imgRelativePath = NSString.stringWithFormat(\"%@%@\", imagesSubDir, imgName);\n                                imgData.writeToFile_atomically(NSString.stringWithFormat(\"%@/%@\", rootDirPath, imgRelativePath), false);\n                                Xml.xmlAddElement(overrideParent, \"override\", [\"property\", overR.property, \"value\", imgRelativePath, \"on\", overrideTargetPath], null);\n                            } else if (overR.property == \"textStyle\") {\n                                let currentOver =Xml.xmlAddElement(overrideParent, \"override\", [\"property\", overR.property, \"value\", overR.value, \"on\", overrideTargetPath], null);\n                                if (documentContext.sharedTextStylesIndex[overR.value]) {\n                                    let affectedLayerUsesAnOutOfSyncStyle = documentContext.textsWithOutOfSyncStyle.hasOwnProperty(overR.affectedLayer.id);\n                                    let overrideStyle = documentContext.sharedTextStylesIndex[overR.value].style;\n\n                                    if (affectedLayerUsesAnOutOfSyncStyle) {\n                                       Xml.xmlAddElement(currentOver, \"textStyle\", [\"sharedStyleId\", overR.value, \"affectedLayerStyleIsOutOfSync\", true], null);\n                                    } else {\n                                       Xml.xmlAddElement(currentOver, \"textStyle\", [\"sharedStyleId\", overR.value], null);\n                                    }\n\n                                    addFontFileToContext(documentContext, styleFontFilePath(overrideStyle));\n                                } else {\n                                    log(\"could not find textStyle\" + overR.value + \" to override a symbol instance of \"\n                                        + l.name + \". This override will be ignored\");\n                                    log(\"\\t->Please check that it is not an external text style that has not been made local.\")\n                                    continue;\n                                }\n                            } else if (overR.property == \"layerStyle\") {\n                                let currentOver =Xml.xmlAddElement(overrideParent, \"override\", [\"property\", overR.property, \"value\", overR.value, \"on\", overrideTargetPath], null);\n                                if (documentContext.sharedLayerStylesIndex[overR.value]) {\n                                    let styleXML =Xml.xmlAddElement(currentOver, \"layerStyle\", null, null);\n                                    treeAddAttributesFromLayerStyle(styleXML, type, documentContext.sharedLayerStylesIndex[overR.value].style);\n                                } else {\n                                    log(\"could not find layerStyle\" + overR.value + \" to override a symbol instance of \"\n                                        + l.name + \". This override will be ignored\");\n                                    log(\"\\t->Please check that it is not an external layer style that has not been made local.\")\n                                    continue;\n                                }\n                            } else if (overR.property == \"stringValue\") {\n                               Xml.xmlAddElement(overrideParent, \"override\", [\"property\", overR.property, \"value\", overR.value, \"on\", overrideTargetPath], null);\n                            } else if (overR.property == \"symbolID\") {\n                                let indexexDataOldSymbol = documentContext.globalNamesIndex[overR.affectedLayer.master.id];\n                                if (!indexexDataOldSymbol){\n                                    log(\"could not find indexed data for SymbolMaster \" + overR.affectedLayer.master.name + \" to override a symbol instance of \"\n                                        + l.name + \". This override will be ignored\");\n                                    log(\"\\t->Please check that it is not an external master that has not been made local.\")\n                                    continue;\n                                }\n                                \n                                let oldType = getTypeFromIndexedData(indexexDataOldSymbol);\n                                let newType = \"\"; //may be empty id \"no symbol\" override\n                                if (overR.value.length > 0) {\n                                    let newSymbol = document.getSymbolMasterWithID(overR.value);\n                                    if (newSymbol) {\n                                        let indexedDataNewSymbol = documentContext.globalNamesIndex[newSymbol.id];\n                                        if (!indexedDataNewSymbol){\n                                            log(\"could not find indexed data for SymbolMaster \" + newSymbol.name + \" to override a symbol instance of \"\n                                                + l.name + \". This override will be ignored\");\n                                            log(\"\\t->Please check that it is not an external master that has not been made local.\")\n                                            break;\n                                        }\n                                        newType = getTypeFromIndexedData(indexedDataNewSymbol); //symbol extracted class\n                                    } else {\n                                        log(\"could not find SymbolMaster with ID \" + overR.value + \" to override a symbol instance of \"\n                                        + l.name + \". This override will be ignored\");\n                                        log(\"\\t->Please check that it is not an external master that has not been made local.\")\n                                        break;\n                                    }\n                                }\n\n                                symbolOverridesHash[originalOverrideTargetPath] =Xml.xmlAddElement(overrideParent, \"override\", [\"property\", overR.property, \"newType\", newType, \"oldType\", oldType, \"on\", overrideTargetPath], null);\n                            }\n                        }\n                    }\n                }\n                Xml.xmlAddAttributesToElement(xmlCurrent, [\"symbolMaster\", getUniqueNameFromIndexedData(indexedDataSymbolMaster), \"type\", actualType]);\n                \n                let parentType = getParentTypeFromIndexedData(indexedDataSymbolMaster);\n                if (parentType)\n                    Xml.xmlAddAttributesToElement(xmlCurrent, [\"symbolMasterParentType\", parentType]);\n                \n            } else {\n                //other types are handled without anything specific\n                Xml.xmlAddAttributesToElement(xmlCurrent, [\"type\", actualType]);\n                //NB: overrides are applied if necessary when calling treeAddAttributesFromLayerData & co. below.\n                //We do not apply overrides on the model directly as it would modify\n                //the original Sketch file...\n            }\n            \n            //Masks\n            //FIXME: using internal Sketch API that might change in future versions\n            if (l._object.hasClippingMask()) {\n                //log(\"\" + actualName + \" is a mask\");\n                Xml.xmlAddAttributesToElement(xmlCurrent, [\"isMask\", 1]);\n                actualParent = xmlCurrent;\n                currentMask = l;\n            }\n            \n            //Add custom keys and values extracted from layer name\n            if (keyValues.length > 0)\n                addCustomPropertiesToXml(xmlCurrent, keyValues);\n            \n            //add layer data\n            //FIXME: compute x/y/width/height changes due to masks and mask chains breaks reparenting\n            //FIXME: also handle proper size for clipped images\n            let shallBlockBecauseExportExists = treeAddAttributesFromLayerData(actualName, xmlCurrent, type, l, rootDirPath, imagesSubDir, isCustomClass, currentMask, actualType);\n\n            if (!shallBlockBecauseExportExists && l && (type == \"MSArtboardGroup\" || type == \"MSLayerGroup\" || type == \"MSShapeGroup\"\n                      || type == \"MSSymbolMaster\" || type == \"MSSymbolInstance\")){\n                treeIterateLayers(l.layers, xmlCurrent, shallIgnoreSymbolMasters, rootDirPath, imagesSubDir, xmlRoot, documentContext, currentMask);\n            }\n        }\n    }\n}\n\n\nfunction treeAddAttributesFromPointData(currentXMLElement, point){\n    if (point && point.sketchObject) {\n        let Xml = require(\"./xml.js\");\n        let pointType = point.pointType;\n\n        let pointAttributes = [];\n        pointAttributes.push(\"pointType\");\n        pointAttributes.push(point.pointType);\n        pointAttributes.push(\"x\");\n        pointAttributes.push(point.point.x);\n        pointAttributes.push(\"y\");\n        pointAttributes.push(point.point.y);\n\n        if (pointType == 'Straight') {\n            pointAttributes.push(\"cornerRadius\");\n            pointAttributes.push(point.cornerRadius);\n\n        } else if (pointType == 'Undefined') {\n            //TODO: check if we can really obtain a point with an undefined type\n            let nativePoint = point.sketchObject;\n\n            if (nativePoint.hasCurveFrom()) {\n                pointAttributes.push(\"curveFromX\");\n                pointAttributes.push(point.curveFrom.x);\n                pointAttributes.push(\"curveFromY\");\n                pointAttributes.push(point.curveFrom.y);\n            }\n\n            if (nativePoint.hasCurveTo()) {\n                pointAttributes.push(\"curveToX\");\n                pointAttributes.push(point.curveTo.x);\n                pointAttributes.push(\"curveToY\");\n                pointAttributes.push(point.curveTo.y);\n            }\n            \n            pointAttributes.push(\"cornerRadius\");\n            pointAttributes.push(point.cornerRadius);\n\n        } else if (pointType != 'Undefined') {\n            pointAttributes.push(\"curveFromX\");\n            pointAttributes.push(point.curveFrom.x);\n            pointAttributes.push(\"curveFromY\");\n            pointAttributes.push(point.curveFrom.y);\n            pointAttributes.push(\"curveToX\");\n            pointAttributes.push(point.curveTo.x);\n            pointAttributes.push(\"curveToY\");\n            pointAttributes.push(point.curveTo.y);\n        }\n\n       Xml.xmlAddElement(currentXMLElement, \"point\", pointAttributes, null);\n\n    }  else console.warn(\"treeAddAttributesFromPointData: invalid argument 'point'\");\n}\n\n\nfunction treeAddTextBehaviour(currentXMLElement, layer) {\n    if (!isTextLayer(layer))\n        return;\n\n    let Xml = require(\"./xml.js\");\n    Xml.xmlAddAttributesToElement(currentXMLElement, [\"textBehaviour\", layerTextBehaviour(layer)]);\n}\n\n\nfunction treeAddAttributesFromTextStyle(currentXMLElement, layerOrSharedTextStyle, sharedTextStyle) {\n    let Xml = require(\"./xml.js\");\n\n    if (!layerOrSharedTextStyle)\n        return;\n\n    let isText = isTextLayer(layerOrSharedTextStyle);\n    let style = layerOrSharedTextStyle.style;\n    let sharedStyle = (sharedTextStyle ? sharedTextStyle.style : null); \n    if (!style)\n        return;\n\n    let attributes = [];\n\n    if (!sharedStyle || (style.opacity !== sharedStyle.opacity)) {\n        attributes.push(\"opacity\");\n        attributes.push(style.opacity);\n    }\n\n    if (!sharedStyle || (style.blendingMode !== sharedStyle.blendingMode)) {\n        attributes.push(\"blendingMode\");\n        attributes.push(style.blendingMode);\n    }\n\n    let textBehaviour = \"autoWidth\";\n    if (isText) {\n        textBehaviour = layerTextBehaviour(layerOrSharedTextStyle);\n\n        attributes.push(\"textBehaviour\");\n        attributes.push(textBehaviour);\n    }\n\n    if (!sharedStyle || (style.alignment != sharedStyle.alignment)) {\n        attributes.push(\"alignment\");\n        attributes.push(style.alignment);\n    }\n    \n    // Special case: Sketch does not reset the value of verticalAlignment when we switch from \"fixedSize\" to \"autoWidth\" or \"autoHeight\"\n    let verticalAlignment = (!isText || (textBehaviour === \"fixedSize\")) ? style.verticalAlignment : \"top\";\n    if (!sharedStyle || (verticalAlignment != sharedStyle.verticalAlignment)) {\n        attributes.push(\"verticalAlignment\");\n        attributes.push(verticalAlignment);\n    }\n\n    if (!sharedStyle || (style.textColor != sharedStyle.textColor)) {\n        attributes.push(\"textColor\");\n        attributes.push(getTextColorAsHexValueOrSwatchReference(style));\n    }\n\n    if (!sharedStyle || (style.lineHeight != sharedStyle.lineHeight)) {\n        if (style.lineHeight) {\n            attributes.push(\"lineHeight\");\n            attributes.push(style.lineHeight);\n        }\n    }\n\n    if (!sharedStyle || (style.paragraphSpacing != sharedStyle.paragraphSpacing)) {\n        attributes.push(\"paragraphSpacing\");\n        attributes.push(style.paragraphSpacing);\n    }\n\n    // The following properties define our font\n    let needFontFamily = (!sharedStyle || (style.fontFamily != sharedStyle.fontFamily));\n    let needFontSize = (!sharedStyle || (style.fontSize != sharedStyle.fontSize));\n    let needFontWeight = (!sharedStyle || (style.fontWeight != sharedStyle.fontWeight));\n    let needFontStyle = (!sharedStyle || (style.fontStyle != sharedStyle.fontStyle));\n    let needFontVariant = (!sharedStyle || (style.fontVariant != sharedStyle.fontVariant));\n    let needFontStretch = (!sharedStyle || (style.fontStretch != sharedStyle.fontStretch));\n    let needKerning = (!sharedStyle || (style.kerning != sharedStyle.kerning));\n    let needTextTransform = (!sharedStyle || (style.textTransform != sharedStyle.textTransform));\n    let needTextUnderline = (!sharedStyle || (style.textUnderline != sharedStyle.textUnderline));\n    let needTextStrikethrough = (!sharedStyle || (style.textStrikethrough != sharedStyle.textStrikethrough));\n\n    if (needFontFamily || needFontSize || needFontWeight || needFontStyle || needFontVariant\n        || needFontStretch || needKerning || needTextTransform || needTextUnderline || needTextStrikethrough) {\n        attributes.push(\"fontFamily\");\n        attributes.push(style.fontFamily);\n\n        attributes.push(\"fontSize\");\n        attributes.push(style.fontSize);\n\n        attributes.push(\"fontWeight\");\n        attributes.push(style.fontWeight);\n\n        if (style.fontStyle) {\n            attributes.push(\"fontStyle\");\n            attributes.push(style.fontStyle);\n        }\n\n        if (style.fontVariant) {\n            attributes.push(\"fontVariant\");\n            attributes.push(style.fontVariant);\n        }\n\n        if (style.fontStretch) {\n            attributes.push(\"fontStretch\");\n            attributes.push(style.fontStretch);\n        }\n\n         // NB: we also need to export raw properties to help translation from Sketch to UI toolkits\n        attributes.push(\"fontPostscriptName\");\n        attributes.push(fontPostscriptNameFromStyle(style));\n        attributes.push(\"fontStyleName\");\n        attributes.push(fontStyleNameFromStyle(style));\n\n        if (style.kerning) {\n            attributes.push(\"kerning\");\n            attributes.push(style.kerning);\n        }\n\n        attributes.push(\"textTransform\");\n        attributes.push(style.textTransform);\n\n        if (style.textUnderline) {\n            attributes.push(\"textUnderline\");\n            attributes.push(style.textUnderline);\n        }\n\n        if (style.textStrikethrough) {\n            attributes.push(\"textStrikethrough\");\n            attributes.push(style.textStrikethrough);\n        }\n    }\n\n    Xml.xmlAddAttributesToElement(currentXMLElement, attributes);\n}\n\n\nfunction treeAddAttributesFromLayerStyle(currentXMLElement, type, style) {\n    if (!style)\n        return;\n\n    let Xml = require(\"./xml.js\");\n    let attributes = [];\n\n    attributes.push(\"opacity\");\n    attributes.push(style.opacity);\n    \n    attributes.push(\"blendingMode\");\n    attributes.push(style.blendingMode);\n\n    //TODO: blur, shadows, innershadows\n    \n    if (style.borderOptions) {\n        if (style.borderOptions.startArrowhead != 'None') {\n            attributes.push(\"startArrowhead\");\n            attributes.push(style.borderOptions.startArrowhead);\n        }\n        if (style.borderOptions.endArrowhead != 'None') {\n            attributes.push(\"endArrowhead\");\n            attributes.push(style.borderOptions.endArrowhead);\n        }\n        let dashPatternLength = style.borderOptions.dashPattern.length;\n        if (dashPatternLength != 0) {\n            attributes.push(\"dashPattern\");\n            let dashPatternString = style.borderOptions.dashPattern.join(',');\n            if (dashPatternLength % 2 == 0) {\n                attributes.push(dashPatternString);\n            } else {\n                //NB: In most UI toolkits, the dash pattern must be specified as an even \n                // number of values that specify the lengths of alternating dashes and gaps\n                attributes.push(dashPatternString + \",\" + dashPatternString);\n            }\n        }\n        if (style.borderOptions.lineEnd != 'Butt') {\n            attributes.push(\"lineEnd\");\n            attributes.push(style.borderOptions.lineEnd);\n        }\n        if (style.borderOptions.lineJoin != 'Miter') {\n            attributes.push(\"lineJoin\");\n            attributes.push(style.borderOptions.lineJoin);\n        }\n    }\n\n    if (style.fills.length > 0) {\n        style.fills.forEach(fill => {\n            let xmlFill =Xml.xmlAddElement(currentXMLElement, \"fill\", null, null);\n            let fillAttributes = [];\n            let fillType = fill.fillType;\n            fillAttributes.push(\"fillType\");\n            fillAttributes.push(fillType);\n            fillAttributes.push(\"enabled\");\n            fillAttributes.push(fill.enabled);\n\n            if (fillType == \"Color\") {\n                fillAttributes.push(\"color\");\n                fillAttributes.push(getFillColorAsHexValueOrSwatchReference(fill));\n\n            } else if (fillType == \"Gradient\") {\n                let gradient = fill.gradient;\n                let gradientType = gradient.gradientType;\n                fillAttributes.push(\"gradientType\");\n                fillAttributes.push(gradientType);\n                fillAttributes.push(\"fromX\");\n                fillAttributes.push(gradient.from.x);\n                fillAttributes.push(\"fromY\");\n                fillAttributes.push(gradient.from.y);\n                fillAttributes.push(\"toX\");\n                fillAttributes.push(gradient.to.x);\n                fillAttributes.push(\"toY\");\n                fillAttributes.push(gradient.to.y);\n\n                if (gradientType == \"Radial\") {\n                    fillAttributes.push(\"aspectRatio\");\n                    fillAttributes.push(gradientType.aspectRatio);\n                }\n\n                gradient.stops.forEach(stop => {\n                    let stopAttributes = [];\n                    stopAttributes.push(\"position\");\n                    stopAttributes.push(stop.position);\n                    stopAttributes.push(\"color\");\n                    stopAttributes.push(rgbaToArgbOrRgb(stop.color));\n                    \n                   Xml.xmlAddElement(xmlFill, \"stop\", stopAttributes, null);\n                });\n\n            } else if (fillType == \"Pattern\") {\n                fillAttributes.push(\"patternType\");\n                fillAttributes.push(fill.pattern.patternType);\n                fillAttributes.push(\"tileScale\");\n                fillAttributes.push(fill.pattern.tileScale);\n                //TODO: image\n            }\n\n            Xml.xmlAddAttributesToElement(xmlFill, fillAttributes);     \n        });\n    }\n   \n    if (style.borders.length > 0) {\n        style.borders.forEach(border => {\n            let xmlBorder =Xml.xmlAddElement(currentXMLElement, \"border\", null, null);\n            let borderAttributes = [];\n            let fillType = border.fillType;\n            borderAttributes.push(\"fillType\");\n            borderAttributes.push(fillType);\n            borderAttributes.push(\"thickness\");\n            borderAttributes.push(border.thickness);\n            borderAttributes.push(\"position\");\n            borderAttributes.push(border.position);\n            borderAttributes.push(\"enabled\");\n            borderAttributes.push(border.enabled);\n\n            if (fillType == \"Color\") {\n                borderAttributes.push(\"color\");\n                borderAttributes.push(getFillColorAsHexValueOrSwatchReference(border));\n\n            } else if (fillType == \"Gradient\") {\n                let gradient = border.gradient;\n                let gradientType = gradient.gradientType;\n                borderAttributes.push(\"gradientType\");\n                borderAttributes.push(gradientType);\n                borderAttributes.push(\"fromX\");\n                borderAttributes.push(gradient.from.x);\n                borderAttributes.push(\"fromY\");\n                borderAttributes.push(gradient.from.y);\n                borderAttributes.push(\"toX\");\n                borderAttributes.push(gradient.to.x);\n                borderAttributes.push(\"toY\");\n                borderAttributes.push(gradient.to.y);\n\n                if (gradientType == \"Radial\") {\n                    borderAttributes.push(\"aspectRatio\");\n                    borderAttributes.push(gradientType.aspectRatio);\n                }\n\n                gradient.stops.forEach(stop => {\n                    let stopAttributes = [];\n                    stopAttributes.push(\"position\");\n                    stopAttributes.push(stop.position);\n                    stopAttributes.push(\"color\");\n                    stopAttributes.push(rgbaToArgbOrRgb(stop.color));\n                    \n                   Xml.xmlAddElement(xmlBorder, \"stop\", stopAttributes, null);\n                });\n            }\n\n            Xml.xmlAddAttributesToElement(xmlBorder, borderAttributes);\n        });\n    }\n\n    Xml.xmlAddAttributesToElement(currentXMLElement, attributes);\n}\n\n\nfunction treeAddAttributesFromLayerData(name, currentXMLElement, type, layer, rootDirPath, imagesSubDir,\n                                        isCustomClass, currentMask, actualType){\n    /*\n    return true if item shall stop iteration, generally because it is renderer as an image or has exports\n    return false if item allows iterations\n    */\n    let Xml = require(\"./xml.js\");\n    let Utils = require(\"./utils.js\");\n    let attributes = [];\n    \n    attributes.push(\"id\");\n    attributes.push(layer.id);\n    \n    //generic attributes\n    if (layer.locked){\n        attributes.push(\"locked\");\n        attributes.push(\"1\");\n    }\n    if (layer.hidden){\n        attributes.push(\"hidden\");\n        attributes.push(\"1\");\n    }\n    if (layer.transform){\n        if (layer.transform.rotation !== 0) {\n            attributes.push(\"rotation\");\n            attributes.push(layer.transform.rotation);\n        }\n        if (layer.transform.flippedHorizontally){\n            attributes.push(\"flippedHorizontally\");\n            attributes.push(\"1\");\n        }\n        if (layer.transform.flippedVertically){\n            attributes.push(\"flippedVertically\");\n            attributes.push(\"1\");\n        }\n    }\n    if (layer.sketchObject.hasFixedWidth()){\n        attributes.push(\"hasFixedWidth\");\n        attributes.push(\"1\");\n    }\n    if (layer.sketchObject.hasFixedHeight()){\n        attributes.push(\"hasFixedHeight\");\n        attributes.push(\"1\");\n    }\n    if (layer.sketchObject.hasFixedLeft()){\n        attributes.push(\"hasFixedLeft\");\n        attributes.push(\"1\");\n        // NB: fixedLeft is x\n    }\n    if (layer.sketchObject.hasFixedTop()){\n        attributes.push(\"hasFixedTop\");\n        attributes.push(\"1\");\n        // NB: fixedTop is y\n    }\n    if (layer.sketchObject.hasFixedRight()){\n        attributes.push(\"hasFixedRight\");\n        attributes.push(\"1\");\n        attributes.push(\"fixedRight\");\n        attributes.push(layer.parent ? Utils.roundBy(layer.parent.frame.width - (layer.frame.x + layer.frame.width), 0.5) : 0);\n    }\n    if (layer.sketchObject.hasFixedBottom()){\n        attributes.push(\"hasFixedBottom\");\n        attributes.push(\"1\");\n        attributes.push(\"fixedBottom\");\n        attributes.push(layer.parent ? Utils.roundBy(layer.parent.frame.height - (layer.frame.y + layer.frame.height), 0.5) : 0);\n    }\n\n\n    if (layer.frame){\n        // NB: one decimal precision to allow sharp rendering if we use a centered border (BorderPosition = Centered) with an odd thickness value\n        //     If the thickness value is even (2, 4, etc.), x and y must be integer values; whereas if the thickness value is off (1, 3, etc.), \n        //     x and y must be decimal values ending with '.5' (half pixel offset)\n        attributes.push(\"x\");\n        attributes.push(Utils.roundBy(layer.frame.x, 0.5));\n        attributes.push(\"y\");\n        attributes.push(Utils.roundBy(layer.frame.y, 0.5));\n        attributes.push(\"width\");\n        attributes.push(Math.ceil(layer.frame.width));\n        attributes.push(\"height\");\n        attributes.push(Math.ceil(layer.frame.height));\n    }\n\n    //flows\n    if (layer.flow && layer.flow.target){\n       Xml.xmlAddElement(currentXMLElement, \"flow\",\n                      [\"targetName\", layer.flow.target.name,\n                       \"targetId\", layer.flow.targetId,\n                       \"type\", layer.flow.animationType], null);\n    }\n    \n    let renderingAsImage = false;\n    //handle unsupported types by rendering them as an image\n    //NB: supported types are at the moment : text, rectangle, image, group, window\n    //NB: groups come from MSLayerGroup and MSSymbolInstance\n    //See type conversions at the beginning of treeParseName\n    if (!isCustomClass && !isSupportedLayer(layer)){\n        //we have an unsupported type => render it as an image\n        treeForceImageExport(layer, currentXMLElement, rootDirPath, imagesSubDir, name, type);\n        renderingAsImage = true;\n    }\n    \n    //handle images with no export by manually generating image\n    if ((type == \"MSBitmapLayer\") && layer.exportFormats && (layer.exportFormats.length == 0)){\n        //we have an unsupported type => render it as an image\n        treeForceImageExport(layer, currentXMLElement, rootDirPath, imagesSubDir, name, type);\n        //log(\"force export on image \" + layer.name);\n        renderingAsImage = true;\n    }\n\n    if (renderingAsImage){\n        Xml.xmlAddAttributesToElement(currentXMLElement, attributes);\n        return true;\n    }\n    \n    //exports\n    let hasExports = false;\n    // NB: we don't want to export artboards or symbol masters as images\n    if (layer.exportFormats && (layer.exportFormats.length > 0) && canExportTypeAsImage(type)) {\n        hasExports = treeAddImageExport(name, layer, currentXMLElement, rootDirPath, imagesSubDir);\n    }\n\n    if (hasExports){\n        //this part of the tree will be rendered as an image\n        //=> add already collected elements and return now\n        Xml.xmlAddAttributesToElement(currentXMLElement, attributes);\n        //log(\"abort style inspection because layer has exports (\" + layer.name + \")\");\n        return true;\n    }\n    \n    //style\n    if (type == \"MSArtboardGroup\" || type == \"MSLayerGroup\" || type == \"MSShapeGroup\"\n        || type == \"MSOvalShape\" || type == \"MSRectangleShape\" || type == \"MSPolygonShape\" || type == \"MSStarShape\" || type == \"MSTriangleShape\"\n        || type == \"MSShapePathLayer\" || type == \"MSBitmapLayer\" || type == \"MSTextLayer\" || type == \"MSSliceLayer\"\n        || isCustomClass){\n\n        let style = layer.style;\n        if (style) {\n            if (type == \"MSTextLayer\") {\n                if (layer.sharedStyle) {\n                    attributes.push(\"sharedStyleId\");\n                    attributes.push(layer.sharedStyleId);\n    \n                    if (layer.sketchObject.isSharedStyleOutOfSync()) {\n                        attributes.push(\"isSharedStyleOutOfSync\");\n                        attributes.push(1);\n                        treeAddAttributesFromTextStyle(currentXMLElement, layer, layer.sharedStyle);\n                    } else {\n                        // textBehaviour is not defined by shared styles\n                        treeAddTextBehaviour(currentXMLElement, layer);\n                    }\n                } \n                else {\n                    treeAddAttributesFromTextStyle(currentXMLElement, layer, null);\n                }\n            }\n            else {\n                treeAddAttributesFromLayerStyle(currentXMLElement, type, style);\n            }\n        }\n    }\n    \n    //points\n    if (type == \"MSShapePathLayer\" || type == \"MSOvalShape\" || type == \"MSRectangleShape\" || type == \"MSPolygonShape\" || type == \"MSStarShape\" || type == \"MSTriangleShape\" || type == \"MSShapeGroup\"){\n        attributes.push(\"shapeType\");\n        attributes.push(layer.shapeType);\n        attributes.push(\"closed\");\n        if (layer.closed){\n            attributes.push(\"1\");\n        }else{\n            attributes.push(\"0\");\n        }\n        let points = layer.points;\n        if (points){\n            points.forEach(point => {\n                treeAddAttributesFromPointData(currentXMLElement, point);\n            });\n        }\n    }\n    \n    //specific attributes per type\n    if (type == \"MSTextLayer\"){\n        let text = layer.text;\n        if (text){\n           Xml.xmlAddElement(currentXMLElement, \"content\", null, escapeCharactersInUnicodePrivateUseArea(text));\n        }\n    } else if (type == \"MSArtboardGroup\"){\n        if (layer.background && layer.background.enabled && layer.background.includedInExport){\n            attributes.push(\"hasBackground\");\n            attributes.push(\"1\");\n            attributes.push(\"backgroundColor\");\n            attributes.push(getBackgroundColorAsHexValueOrSwatchReference(layer));        \n        }        \n    }\n    \n    Xml.xmlAddAttributesToElement(currentXMLElement, attributes);\n    return false;\n}\n\n\nfunction treeForceImageExport(layer, currentXMLElement, rootDirPath, imagesSubDir, name, type){\n    let Xml = require(\"./xml.js\");\n    let Utils = require(\"./utils.js\");\n\n    if (!rootDirPath.endsWith(\"/\")) {\n        rootDirPath += \"/\";\n    }\n\n    if ((imagesSubDir.length > 0) && !imagesSubDir.endsWith(\"/\")) {\n        imagesSubDir += \"/\";\n    }\n\n    let exportPath = rootDirPath + imagesSubDir;\n\n    //NB: strange behavior - layer.id is undefined is we try to build a string BUT exists if we use console.log\n    //let toto  = layer.id;console.log(\"Exists \" + layer.id + \" -- \" + toto);\n    // We add our objectID to avoid conflict between different symbols and/or artboards\n    name = name + \"__\" + layer.sketchObject.objectID();\n\n\n    // NB: Sketch fails to generate big images. Thus, we must ensure that we don't try to export big images\n    let numberOfImages = 1;\n    let layerWidth = layer.frame.width;\n    let layerHeight = layer.frame.height;\n    for (let currentAtN = 2; currentAtN <= numberOfImagesPerLayerExport; currentAtN++) {\n        if (\n            ((layerWidth * currentAtN) > maximumImageWidthOrHeight)\n            ||\n            ((layerHeight * currentAtN) > maximumImageWidthOrHeight)\n            )\n            {\n                break;\n            }\n        numberOfImages = currentAtN;\n    }\n\n\n    let insets = Utils.exportLayerAsPNG(layer, numberOfImages, exportPath, name, false, false);\n\n    Xml.xmlAddAttributesToElement(currentXMLElement, [\"hasExport\", numberOfImages, \n                                                  \"type\", \"image\", \n                                                  \"opacity\", layer.style.opacity,\n                                                  \"topInset\", Utils.roundBy(insets[0], 0.5), \n                                                  \"bottomInset\", Utils.roundBy(insets[1], 0.5), \n                                                  \"leftInset\", Utils.roundBy(insets[2], 0.5),  \n                                                  \"rightInset\", Utils.roundBy(insets[3], 0.5)\n                                                 ]);\n\n    for (let currentAtN = 1; currentAtN <= numberOfImages; currentAtN++) {\n        let exportAttr = [];\n        let fileName = name + ((currentAtN !== 1) ? \"@\" + currentAtN + \"x\" : \"\") + \".png\";\n\n        exportAttr.push(\"format\");\n        exportAttr.push(\"png\");\n        exportAttr.push(\"size\");\n        exportAttr.push(currentAtN + \"x\");\n        exportAttr.push(\"prefix\");\n        exportAttr.push(\"\");\n        exportAttr.push(\"suffix\");\n        exportAttr.push((currentAtN !== 1) ? \"@\" + currentAtN + \"x\" : \"\");\n        exportAttr.push(\"file\");\n        exportAttr.push(imagesSubDir + fileName);\n\n       Xml.xmlAddElement(currentXMLElement, \"export\", exportAttr, null);\n    }\n}\n\n\nfunction treeAddImageExport(name, layer, currentXMLElement, rootDirPath, imagesSubDir){\n    let succeeded = false;\n\n    if (layer.exportFormats.length > 0) \n    {\n        let Xml = require(\"./xml.js\");\n        let Utils = require(\"./utils.js\");\n\n        if (!rootDirPath.endsWith(\"/\")) {\n            rootDirPath += \"/\";\n        }\n    \n        if ((imagesSubDir.length > 0) && !imagesSubDir.endsWith(\"/\")) {\n            imagesSubDir += \"/\";\n        }\n\n        let exportPath = rootDirPath + imagesSubDir;\n        // We add our objectID to avoid conflict between different symbols and/or artboards\n        name = name + \"__\" + layer.sketchObject.objectID(); \n\n        let insets = Utils.exportLayerWithUserDefinedExportOptions(layer, exportPath, name, false, false);\n\n        Xml.xmlAddAttributesToElement(currentXMLElement, [\"hasExport\", layer.exportFormats.length, \n                                                      \"type\", \"image\",  //force type as image\n                                                      \"opacity\", layer.style.opacity,\n                                                      \"topInset\", insets[0], \"bottomInset\", insets[1], \n                                                      \"leftInset\", insets[2], \"rightInset\", insets[3]\n                                                     ]);\n\n        layer.exportFormats.forEach(format => {\n            let exportFormat = format.sketchObject;\n            \n            let fileName = MSExportFormat.exportableFilenameForLayerName_exportFormat(name, exportFormat);\n\n            let sizeText = format.size;\n            let fileFormat = format.fileFormat;\n            let prefix = (format.prefix) ? format.prefix : \"\";\n            let suffix = (format.suffix) ? format.suffix : \"\";\n        \n            let exportAttr = [];\n            exportAttr.push(\"format\");\n            exportAttr.push(fileFormat);\n            exportAttr.push(\"size\");\n            exportAttr.push(sizeText);\n            exportAttr.push(\"prefix\");\n            exportAttr.push(prefix);\n            exportAttr.push(\"suffix\");\n            exportAttr.push(suffix);\n            exportAttr.push(\"file\");\n            exportAttr.push(imagesSubDir + fileName);\n            \n           Xml.xmlAddElement(currentXMLElement, \"export\", exportAttr, null);\n        });\n\n\n        succeeded = true;\n    }\n\n    return succeeded;\n}\n\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////\n// TREE INDEXING\n\n\n/*\nWe use names to add metadata inside Sketch objects.\nHere is the syntax:\nactualName -> actualType |key1|value1|key2|value2|...\nThis function returns an array with:\n- XML beacon name serving as type\n- element name\n- set of keys and values (possibly empty and possibly including legacy class information)\n*/\nfunction treeAddLayerInGlobalNamesIndex(layer, documentContext, layerNamesUnicityByContext, layersStack, contextStack){\n    let type = layer.sketchObject.class();\n\n    //extracting keys and values\n    let elements = layer.name.split(\"|\");\n    let nameAndType = elements.shift().split(\"->\");\n\n    let actualType = \"\" + type;\n    let useActualNameAsType = false;\n    let extractedTypeIsParentType = false;\n    if (type == \"MSLayerGroup\" || type == \"MSShapeGroup\"){\n        actualType = \"group\";\n    }else if (type == \"MSBitmapLayer\"){\n        actualType = \"image\";\n    }else if (type == \"MSRectangleShape\"){\n        actualType = \"rectangle\";\n    }else if (type == \"MSOvalShape\"){\n        actualType = \"oval\";\n    }else if (type == \"MSShapePathLayer\"){\n        if (isLine(layer)) {\n            actualType = \"line\";\n        }\n        //TODO: path\n    }else if (type == \"MSTextLayer\"){\n        actualType = \"text\";\n    }else if (type == \"MSArtboardGroup\"){\n        actualType = \"window\";\n        extractedTypeIsParentType = true;\n    }else if (type == \"MSSymbolMaster\"){\n        useActualNameAsType = true;\n        extractedTypeIsParentType = true;\n    }\n\n    let rawName;\n    let parentType = null;\n    if (nameAndType.length == 1){ //no type specified in name\n        rawName = nameAndType[0].trim();\n    } else if (nameAndType.length == 2){ //type is specified in name\n        rawName = nameAndType[0].trim();\n        let extractedType = nameAndType[1].trim();\n        if (extractedTypeIsParentType){\n            parentType = extractedType;\n        } else {\n            actualType = extractedType;\n        }\n    } else { //name is empty\n        log(\"treeAddLayerInGlobalNamesIndex: format error in layer's name - \" + layer.name);\n        return;\n    }\n    \n    //TODO: not only clean rawName but all captured elements\n\n    //clean possible forbidden characters\n    rawName = rawName.replace(/[^a-zA-Z0-9\\s]/g, ' ').replace(/\\s{2,}/g, ' ').trim();\n\n    if (rawName.match(/^\\d/)) {\n        rawName = \"n \" + rawName;\n    }\n\n    if (rawName.length == 0) {\n        rawName = \"invalidName\";\n    } else if (forbiddenNames.includes(rawName.toLowerCase())) {\n        rawName = \"n \" + rawName;\n    }\n\n\n    let contextKey = contextStack[0];\n    let localLayerNamesUnicityHash = layerNamesUnicityByContext[contextKey];\n\n    /*\n     Ensure name unicity\n     We manage a stack of context (contextStack) because, in the end,\n     we define QML files and we want id unicity in each QML file. \n     This optimization avoids useless suffix addition to layer names and thus makes generated code clearer.\n     */\n    //log(\"checking \" + rawName + \"(\" + contextKey + \")\");\n    let actualName = rawName;\n    let counter = 0;\n    let hashKey = camelize(actualName).toLowerCase();\n\n    if (localLayerNamesUnicityHash.hasOwnProperty(hashKey)){\n        counter = localLayerNamesUnicityHash[hashKey] + 1;\n        while (localLayerNamesUnicityHash.hasOwnProperty(hashKey + \" i\" + counter)) {\n            counter++;\n        }\n\n        actualName = actualName + \" i\" + counter;\n        localLayerNamesUnicityHash[camelize(actualName).toLowerCase()] = 1;\n    } else {\n        counter = 1;\n    }\n    localLayerNamesUnicityHash[hashKey] = counter;\n\n    if (useActualNameAsType) {\n        actualType = actualName;\n    }\n    \n    actualType = actualType.trim();\n    actualName = lowerCaseFirstCharater(actualName);\n\n    if (elements.length %2 !== 0) {\n        //NB: we arbitrarily remove the last element to get an even number\n        elements.pop();\n        log(\"treeAddLayerInGlobalNamesIndex: odd number of key-values in layer's name - \" + layer.name);\n    }\n\n    documentContext.globalNamesIndex[layer.id] = [actualName, \n                                                  actualType,\n                                                  elements, \n                                                  rawName,\n                                                  parentType];\n\n    if ((type == \"MSTextLayer\") && layer.sharedStyle && layer.sketchObject.isSharedStyleOutOfSync()) {\n        documentContext.textsWithOutOfSyncStyle[layer.id] = true;\n    }\n\n    if ((type == \"MSSymbolMaster\") || (type == \"MSArtboardGroup\")) {\n        let layerId = layer.id;\n        layerNamesUnicityByContext[layerId] = {};\n        contextStack.unshift(layerId);\n        layersStack.unshift(\"endOfContextScope\");\n    } \n\n    //exclude hidden layers and layers rendered as images\n    if (\n        !(layer.exportFormats && (layer.exportFormats.length > 0) && canExportTypeAsImage(type))\n        && !layer.hidden \n        &&  (type == \"MSArtboardGroup\" || type == \"MSLayerGroup\" || type == \"MSShapeGroup\" || type == \"MSSymbolMaster\")\n        ) {\n        for (let i = 0; layer.layers && i < layer.layers.length; i++) {\n            layersStack.unshift(layer.layers[i].id);\n        }\n    }\n}\n\n\nfunction treePopulateGlobalNamesIndex(documentContext){\n    let sketch = require('sketch/dom');\n    let document = sketch.getSelectedDocument();\n    let layerNamesUnicityByContext = {};\n    let layersStack = [];\n    \n    document.pages.forEach(page => {\n        if (page.name.startsWith(\"#\")) {\n            // Special case: we don't want to export this page\n            // BUT it may contain relevant information (symbol masters)\n            // that are required to export the content of other pages\n            page.layers.forEach(layer => {\n                let type = layer.sketchObject.class();\n                if (type ==  \"MSSymbolMaster\")\n                    layersStack.unshift(layer.id);\n            });\n        }\n        else {\n            page.layers.forEach(layer => {\n                let type = layer.sketchObject.class();\n                if (\n                     // We don't want to export slices and hotspots\n                     ((type != \"MSSliceLayer\") && (type != \"MSHotspotLayer\")) \n                     &&\n                     // We don't want to export \"private\" layers, BUT we need to list\n                     // all symbol masters to define overrides\n                     (!layer.name.startsWith(\"#\") || (type ==  \"MSSymbolMaster\"))\n                    )\n                {\n                    layersStack.unshift(layer.id);\n                }\n            });\n        }\n    });\n\n    let rootKey = \"DocumentRoot\";\n    let contextStack = [rootKey];\n    layerNamesUnicityByContext[rootKey] = {};\n    while (layersStack.length > 0) {\n        let myId = layersStack.shift();\n        if (myId == \"endOfContextScope\"){\n            let layerId = contextStack.shift();\n            delete layerNamesUnicityByContext[layerId];\n            continue;\n        }\n\n        let layer = document.getLayerWithID(myId);\n        if (layer)\n            treeAddLayerInGlobalNamesIndex(layer, documentContext, layerNamesUnicityByContext, layersStack, contextStack);\n    }\n}\n\n\nfunction treeBuildOverrideTargetPath(overR, globalNamesIndex){\n    let elmts = overR.path.split(\"/\");\n    let result = \"\";\n    for (let i = 0; i < elmts.length; i++){\n        let index = elmts[i];\n        if (globalNamesIndex[index]){\n            let str = camelize(getUniqueNameFromIndexedData(globalNamesIndex[index]));\n            result = result + str + ((i + 1 < elmts.length) ? \".\" : \"\");\n        }else{\n            log(\"undefined index on overriden layer \" + overR.affectedLayer.name + \" that may also be exportable\")\n        }\n    }\n    //log(\"PATH: \" + result);\n    return result;\n}\n\n\n\nfunction addFontFilesToXml(xmlParent, rootDirPath, fontsSubDir, fontFiles, excludeSystemFonts) {\n    if (xmlParent && fontFiles && (fontFiles.length > 0)) {\n        let Xml = require(\"./xml.js\");\n        let Utils = require(\"./utils.js\");\n\n        if (!rootDirPath.endsWith(\"/\")) {\n            rootDirPath += \"/\";\n        }\n\n        if ((fontsSubDir.length > 0) && !fontsSubDir.endsWith(\"/\")) {\n            fontsSubDir += \"/\";\n        }\n\n        let exportPath = rootDirPath + fontsSubDir;\n        Utils.createDirectoryIfNeeded(exportPath);\n\n        let fontFileNames = [];\n        fontFiles.sort().forEach(fontFilePath => {\n            if (!excludeSystemFonts || !fontFilePath.startsWith(\"/System/Library/Fonts\")) {\n                let fileName = fontFilePath.substring(fontFilePath.lastIndexOf('/') + 1);\n                if (!fontFileNames.includes(fileName)) {\n                    fontFileNames.push(fileName);\n                   Xml.xmlAddElement(xmlParent, \"font\", [\"name\", fileName.replace(/\\.[^/.]+$/, \"\"), \"file\",  fontsSubDir + fileName], null);\n                    Utils.copyFile(fontFilePath, exportPath + fileName);\n                }\n            } \n        });\n    }\n}\n\n\nfunction validSwatchName(rawName, colorNames) {\n    let name = rawName.replace(/[^a-zA-Z0-9_]/g, ' ').replace(/\\s{2,}/g, ' ').trim();\n    if (name.match(/^\\d/))\n        name = \"swatch \" + name;\n            \n    if (name.length == 0) {\n        name = \"swatch \" + color.replace(/#/g, '');\n    } else if (forbiddenNames.includes(name.toLowerCase())) {\n        name = \"swatch \" + name;\n    }\n\n    let validName = name;\n    if (colorNames.has(validName.toLowerCase())) {\n        let index = colorNames.get(validName.toLowerCase());\n        validName = name + \" i\" + (++index);\n\n        while (colorNames.has(validName.toLowerCase())) {\n            validName = name + \" i\" + (++index);\n        }\n\n        colorNames.set(name.toLowerCase(), index);\n    }\n\n    validName = lowerCaseFirstCharater(validName);\n    colorNames.set(validName.toLowerCase(), 0);\n\n    return validName;\n}\n\n\nfunction addColorVariablesToXml(xmlParent) {\n    let sketch = require('sketch/dom');\n    if (sketch.version.sketch >= 69) {\n        let Xml = require(\"./xml.js\");\n\n        let colorNames = new Map();\n        let document = sketch.getSelectedDocument();\n\n        let swatchesData = [];\n\n        // V1: swatches defined by our document\n        /*\n        document.swatches.forEach(swatch => {\n            let color = rgbaToArgbOrRgb(swatch.color);\n            let validName = validSwatchName(swatch.name, colorNames);\n  \n            swatchesData.push({id: swatch.sketchObject.objectID(), name: validName, color: color});\n        });\n        */\n\n        // V2: document swatches and imported swatches\n        let usedNativeSwatches = document.sketchObject.documentData().allSwatches();\n        if (usedNativeSwatches.length > 0) {\n            usedNativeSwatches.forEach(nativeSwatch => {\n                let swatch = sketch.fromNative(nativeSwatch);\n\n                let color = rgbaToArgbOrRgb(swatch.color);\n                let validName = validSwatchName(swatch.name, colorNames);\n\n                swatchesData.push({id: swatch.sketchObject.objectID(), name: validName, color: color});\n            });\n        }\n\n\n        // Add missing swatches\n        for (const key in TEMP_CONTEXT.missingSwatches) {\n            let color = TEMP_CONTEXT.missingSwatches[key];\n            let validName = validSwatchName(\"missingSwatch \" + color, colorNames);\n            log(\"Adding missing swatch \" + key + \" with name '\" + validName + \"' (color: \" + color + \")\");\n            swatchesData.push({id: key, name: validName, color: color});\n        }\n\n        // Sort swatches by name before exporting them\n        swatchesData.sort((a, b) => {\n            return ((a.name !== b.name) ? ((a.name < b.name) ? -1 : 1) : 0); // NB: faster than a.name.localCompare(b.name)\n        }).forEach(swatchData => {\n           Xml.xmlAddElement(xmlParent, \"swatch\", [\"id\", swatchData.id, \"name\", swatchData.name, \"color\", swatchData.color], null);\n        });\n\n    } else {\n        console.warn(\"addColorVariablesToXml: can not export color variables - Sketch \" + sketch.version.sketch + \" is too old (required version is 69 or newer)\")\n    }\n}\n\n\nfunction addSharedTextStylesToXml(xmlParent) {\n    let Xml = require(\"./xml.js\");\n    let sketch = require('sketch/dom');\n    let document = sketch.getSelectedDocument();\n\n    let styleNames = new Map();\n    let stylesData = [];\n\n    // Step 1: get data of all text styles\n    document.sharedTextStyles.forEach(sharedTextStyle => {\n        let name = sharedTextStyle.name.replace(/[^a-zA-Z0-9_]/g, ' ').replace(/\\s{2,}/g, ' ').trim();\n        if (name.match(/^\\d/))\n            name = \"textStyle \" + name;\n        \n        if (name.length == 0) {\n            name = \"textStyle\";\n        } else if (forbiddenNames.includes(name.toLowerCase())) {\n            name = \"textStyle \" + name;\n        }\n\n        let validName = name;\n        if (styleNames.has(validName.toLowerCase())) {\n            let index = styleNames.get(validName.toLowerCase());\n            validName = name + \" i\" + (++index);\n\n            while (styleNames.has(validName.toLowerCase())) {\n                validName = name + \" i\" + (++index);\n            }\n\n            styleNames.set(name.toLowerCase(), index);\n        }\n        \n        validName = lowerCaseFirstCharater(validName);\n        styleNames.set(validName.toLowerCase(), 0);\n\n        stylesData.push({id: sharedTextStyle.id, name: validName, sharedTextStyle: sharedTextStyle});\n    });\n\n    // Step 2: export text styles\n    stylesData.sort((a, b) => {\n        return ((a.name !== b.name) ? ((a.name < b.name) ? -1 : 1) : 0); // NB: faster than a.name.localCompare(b.name)\n    }).forEach(textStyleData => {\n        let sharedTextStyleXml =Xml.xmlAddElement(xmlParent, \"sharedtextstyle\", [\"id\", textStyleData.id, \"name\", textStyleData.name], null);\n        treeAddAttributesFromTextStyle(sharedTextStyleXml, textStyleData.sharedTextStyle, null);\n    });\n}\n\n\nfunction camelize(str) {\n    str = removeDiacritics(str);\n    str = str.replace(/[^a-zA-Z0-9\\-_\\s]/g, \"\")\n    str = str.trim();\n\n    if (firstCharIsInvalid(str))\n      str = \"n\" + str;\n\n    return str.replace(/^([A-Z])|[\\-_\\s]+(\\w)/g, function(match, p1, p2, offset) {\n        if (p2) return p2.toUpperCase();\n        return p1.toLowerCase();\n    });\n}\n\nfunction pascalize(str) {\n    return capitalize(camelize(str));\n}\n\n\nfunction firstCharIsInvalid(str) {\n    return ((str.length > 0) && /[^a-z_]/i.test(str.charAt(0)));\n}\n\n\nfunction removeDiacritics (str) {\n    return Object.keys(diacriticsMap).reduce(function (str, key) {\n        let replaceRegexp = diacriticsMap[key];\n        return str.replace(replaceRegexp, key)\n      }, str);\n}\n\n\nfunction capitalize(str) {\n  if (typeof str !== 'string') return '';\n  std = str.trim();\n  if (str.length === 0) return '';\n  return str.charAt(0).toUpperCase() + str.slice(1)\n}\n\n\nfunction lowerCaseFirstCharater(str) {\n    return (str ? str[0].toLowerCase() + str.slice(1) : \"\");\n}\n\n\nfunction escapeCharactersInUnicodePrivateUseArea(str) {\n    // NB: escape special characters used by custom icon fonts generated by Fontello\n    //     see https://www.compart.com/fr/unicode/block/U+E000\n    return str.replace(/[\\uE000-\\uF8FF]/gu, function (c) {\n      return \"\\\\u\" + (\"000\" + c.charCodeAt().toString(16)).slice(-4)\n    });\n}\n\n\nfunction fontPostscriptNameFromStyle(style) {\n    if (!style || !style.sketchObject)\n        return null;\n\n    return style.sketchObject.textStyle().fontPostscriptName();\n}\n\n\nfunction fontStyleNameFromStyle(style) {\n    if (!style || !style.sketchObject)\n        return null;\n\n    let fontDisplayName = style.sketchObject.textStyle().attributes().NSFont.displayName();\n    let fontStyleName = fontDisplayName.replace(style.fontFamily, \"\").trim();\n    if (fontStyleName === \"\")\n        fontStyleName = \"Regular\";\n\n    return fontStyleName;\n}\n\n\nfunction getFillColorAsHexValueOrSwatchReference(fill) {\n    if (fill.sketchObject) {\n        return mscolorToHexValueOrSwatchReference(fill.sketchObject.color());\n    }\n    else {\n        return rgbaToArgbOrRgb(fill.color);\n    }\n}\n\n\nfunction getTextColorAsHexValueOrSwatchReference(style) {\n    if (style.sketchObject && style.sketchObject.textStyle() && style.sketchObject.textStyle().attributes() \n        && style.sketchObject.textStyle().attributes().MSAttributedStringColorAttribute) {\n        return mscolorToHexValueOrSwatchReference(style.sketchObject.textStyle().attributes().MSAttributedStringColorAttribute);\n    } else {\n       return rgbaToArgb(style.textColor);\n    }\n}\n\n\nfunction getBackgroundColorAsHexValueOrSwatchReference(layer) {\n    if (layer.sketchObject) {\n        return mscolorToHexValueOrSwatchReference(layer.sketchObject.backgroundColor());\n    } else {\n        return rgbaToArgbOrRgb(layer.background.color);\n    }\n}\n\n\nfunction mscolorToHexValueOrSwatchReference(mscolor) {\n    let swatchID = mscolor.swatchID();\n    if (swatchID) {\n        let key = String(swatchID);\n        if (!TEMP_CONTEXT.availableSwatchIDs.includes(key)) {\n            if (!TEMP_CONTEXT.missingSwatches.hasOwnProperty(key)) {\n                let color = mscolorToArgbOrRgb(mscolor);\n                log(\"Swatch with ID \" + key + \" not found (color: \" + color + \"). Please check that all named colors are imported\");\n                TEMP_CONTEXT.missingSwatches[key] = color;\n            }\n        }\n\n        return \"swatch(\" + swatchID + \")\";\n    } else {\n        return mscolorToArgbOrRgb(mscolor);\n    }\n}\n\n\nfunction mscolorToArgbOrRgb(mscolor) {\n    return rgbaToArgbOrRgb(\n        \"#\" +mscolor.immutableModelObject().hexValue() \n        + (\"0\" + Math.round(mscolor.alpha() * 255).toString(16).toUpperCase()).slice(-2)\n    );\n}\n\n\nfunction rgbaToArgb(color){\n    return color.replace(/#(......)(..)/, '#$2$1');\n}\n\n\nfunction rgbaToArgbOrRgb(color){\n    if (color.slice(-2).toUpperCase() === \"FF\") {\n        return color.slice(0, -2);\n    } else {\n        return rgbaToArgb(color);\n    }\n}\n\n\nfunction layerTextBehaviour(layer) {\n    if (!isTextLayer(layer))\n        return \"\";\n\n    let textBehaviourValue = layer.sketchObject.textBehaviour();\n    if (textBehaviourValue == 0) {\n        return \"autoWidth\";\n    } else if (textBehaviourValue == 1) {\n        return \"autoHeight\";\n    } else {\n        return \"fixedSize\";\n    }\n}\n\n\nfunction layerFontFilePath(layer) {\n    return ((layer && isTextLayer(layer)) ? styleFontFilePath(layer.style) : null);\n}\n\n\nfunction styleFontFilePath(style) {\n    let fontFilePath = null;\n\n    if (style && style.sketchObject) {\n        let nsFont = style.sketchObject.textStyle().attributes().NSFont;\n        if (nsFont) {\n            let urlAttribute = nsFont.fontDescriptor().objectForKey(\"NSCTFontFileURLAttribute\");\n            if (urlAttribute) {\n                fontFilePath = String(urlAttribute.path());\n            }\n        }\n    } \n\n    return fontFilePath;\n}\n\n\nfunction canExportTypeAsImage(type) {\n    return ((type != \"MSArtboardGroup\") && (type != \"MSSymbolMaster\"));\n}\n\n\nfunction isLayerGroup(layer) {\n    return (layer && layer.sketchObject && layer.sketchObject.isKindOfClass(MSLayerGroup.class()) \n            && !layer.sketchObject.isKindOfClass(MSShapeGroup.class()));\n}\n\n\nfunction isBitmapLayer(layer) {\n    return (layer && layer.sketchObject && layer.sketchObject.isKindOfClass(MSBitmapLayer.class()));\n}\n\n\nfunction isTextLayer(layer) {\n    return (layer && layer.sketchObject && layer.sketchObject.isKindOfClass(MSTextLayer.class()));\n}\n\n\nfunction isShapeLayer(layer) {\n    return (layer && layer.sketchObject \n            && (\n                layer.sketchObject.isKindOfClass(MSRectangleShape.class())  \n                || \n                layer.sketchObject.isKindOfClass(MSOvalShape.class())  \n                ||\n                layer.sketchObject.isKindOfClass(MSPolygonShape.class())  \n                ||\n                layer.sketchObject.isKindOfClass(MSStarShape.class())  \n                ||\n                layer.sketchObject.isKindOfClass(MSTriangleShape.class())  \n                ||\n                layer.sketchObject.isKindOfClass(MSShapePathLayer.class())\n               ) \n            );\n}\n\n\nfunction isRectangleShape(layer) {\n    return (layer && layer.sketchObject.isKindOfClass(MSRectangleShape.class()) && layer.sketchObject.isRectangle());\n    /*\n            && layer.points && (layer.points.length == 4)\n            && (layer.points[0].pointType == \"Straight\") && (layer.points[0].point.x == 0) && (layer.points[0].point.y == 0)\n            && (layer.points[1].pointType == \"Straight\") && (layer.points[1].point.x == 1) && (layer.points[1].point.y == 0)\n            && (layer.points[2].pointType == \"Straight\") && (layer.points[2].point.x == 1) && (layer.points[2].point.y == 1)\n            && (layer.points[3].pointType == \"Straight\") && (layer.points[3].point.x == 0) && (layer.points[3].point.y == 1)\n            );\n    */        \n}\n\n\nfunction isOvalShape(layer) {\n    return (layer && layer.sketchObject.isKindOfClass(MSOvalShape.class()));\n}\n\n\nfunction isLine(layer) {\n    return (\n            layer && layer.sketchObject \n            && layer.sketchObject.isKindOfClass(MSShapePathLayer.class())\n            && (layer.shapeType == \"Custom\") && (layer.points.length == 2)\n            );\n};\n\n\nfunction isSliceLayer(layer) {\n    return (layer && layer.sketchObject && layer.sketchObject.isKindOfClass(MSSliceLayer.class()));\n}\n\n\nfunction isArtboard(layer) {\n    return (layer && layer.sketchObject && layer.sketchObject.isKindOfClass(MSArtboardGroup.class()));\n}\n\n\nfunction isSymbolMaster(layer) {\n    return (layer && layer.sketchObject && layer.sketchObject.isKindOfClass(MSSymbolMaster.class()));\n}\n\n\nfunction isSymbolInstance(layer) {\n    return (layer && layer.sketchObject && layer.sketchObject.isKindOfClass(MSSymbolInstance.class()));\n}\n\n\nfunction isSupportedLayer(layer) {\n    return (\n            isTextLayer(layer) || isBitmapLayer(layer) \n            || (\n                 (isRectangleShape(layer) || isOvalShape(layer) || isLine(layer))\n                 && \n                 isSupportedShapeStyle(layer.style)\n                )\n            || isLayerGroup(layer) \n            || isArtboard(layer) || isSymbolInstance(layer)\n            );\n}\n\n\nfunction isSupportedShapeStyle(style) {\n    let isSupported = true;\n\n    if (style) {\n        isSupported = (\n                       !(style.blur.enabled)\n                       &&\n                       (style.shadows.filter(item => { return item.enabled; }).length == 0)\n                       &&\n                       (style.innerShadows.filter(item => { return item.enabled; }).length == 0)\n                      );\n\n        if (isSupported) {\n            let activeItems = style.fills.filter(item => { return item.enabled; });\n            let numberOfActiveItems = activeItems.length;\n            if (numberOfActiveItems > 0) {\n                let lastItem = activeItems[numberOfActiveItems - 1];\n                isSupported = (\n                               (lastItem.fillType == \"Color\")\n                               &&\n                               ((numberOfActiveItems == 1) || (lastItem.color.slice(-2) === \"ff\")) // \"ff\" => fill is opaque\n                               );\n            }\n        }\n\n        if (isSupported) {\n            let activeItems = style.borders.filter(item => { return item.enabled; });\n            let numberOfActiveItems = activeItems.length;\n            if (numberOfActiveItems > 0) {\n                let lastItem = activeItems[numberOfActiveItems - 1];\n                isSupported = (\n                               (lastItem.fillType == \"Color\")\n                               && \n                               (numberOfActiveItems == 1)\n                              );            \n            }\n        }\n    }\n\n    return isSupported;\n}\n\n\nmodule.exports = {\n    addColorVariablesToXml,\n    addFontFilesToXml,\n    addSharedTextStylesToXml,\n    clearTempContext,\n    getBackgroundColorAsHexValueOrSwatchReference,\n    getFontFilesUsedByLayer,\n    getKeyValuesFromIndexedData,\n    getParentTypeFromIndexedData,\n    getTypeFromIndexedData,\n    getUniqueNameFromIndexedData,\n    initDocumentContext,\n    pascalize,\n    treeIterateLayers\n};","let Utils = {};\n\n\n//NB: Sound files in /System/Library/Sounds\nUtils.Sounds = {\n    Basso: \"Basso\",\n    Blow: \"Blow\",\n    Bottle: \"Bottle\",\n    Frog: \"Frog\",\n    Funk: \"Funk\",\n    Glass: \"Glass\",\n    Hero: \"Hero\",\n    Morse: \"Morse\",\n    Ping: \"Ping\",\n    Pop: \"Pop\",\n    Purr: \"Purr\",\n    Sosumi: \"Sosumi\",\n    Submarine: \"Submarine\",\n    Tink: \"Tink\"\n};\n\n\nUtils.playSoundNamed = function(name) {\n    let sound = NSSound.soundNamed(name);\n    if (sound) \n        sound.play();\n};\n\n\nUtils.chooseFolder = function() {\n    let panel = NSOpenPanel.openPanel();\n    panel.setCanChooseDirectories(true);\n    panel.setCanChooseFiles(false);\n    panel.setCanCreateDirectories(true);\n    \n    if (panel.runModal() == NSModalResponseOK) \n    {\n        let path = panel.URL().path();\n        if (0 == path.indexOf(\"file://\")) \n        {\n            //remove the file:// path from string\n            path = path.substring(7);\n        }\n\n        if (!path.endsWith(\"/\"))\n            path += \"/\";\n\n        return path;\n    }\n    else\n    {\n        return null;\n    }\n};\n\n\nUtils.showDialog = function(message) {\n    let app = NSApplication.sharedApplication();\n    if (app)\n        app.displayDialog_withTitle(message, \"Sketch2QML\");\n};\n\n\nUtils.showInFinder = function(directoryPathOrFilePath) {\n    let errorPointer = MOPointer.alloc().init();\n    let fileManager = NSFileManager.defaultManager();\n    let result = fileManager.attributesOfItemAtPath_error(directoryPathOrFilePath, errorPointer);\n    if (result)\n    {\n        if (result.isDirectory()) \n            NSWorkspace.sharedWorkspace().openFile_withApplication(directoryPathOrFilePath, \"Finder\");\n        else \n            NSWorkspace.sharedWorkspace().selectFile_inFileViewerRootedAtPath(directoryPathOrFilePath, nil);\n    }\n    else\n        console.warn(\"Utils.showInFinder: \" + directoryPathOrFilePath + \" does not exist or can't be read\");\n};\n\n\nUtils.runCommand = function (command, args, currentDirectoryPath) {\n    var task = NSTask.alloc().init();\n    task.setLaunchPath_(command);\n    if (currentDirectoryPath)\n        task.setCurrentDirectoryPath(currentDirectoryPath);\n    \n    task.arguments = args;\n    task.launch();\n    task.waitUntilExit();\n    return (task.terminationStatus() == 0)\n};\n\n\nUtils.copyFile = function (source, destination) {\n    const manager = NSFileManager.defaultManager();\n    if (manager.fileExistsAtPath(source))\n        manager.copyItemAtPath_toPath_error(source, destination, null);\n    else\n        console.warn(\"Utils.copyFile: file '\" + source + \"` does not exist\");\n};\n\n\nUtils.fileExists = function (filePath) {\n    return NSFileManager.defaultManager().fileExistsAtPath(filePath);\n};\n\n\nUtils.expandTildeInPath = function (filePath) {\n    return String(NSString.stringWithString(filePath).stringByExpandingTildeInPath());\n};\n\n\nUtils.createDirectoryIfNeeded = function(path) {\n    const manager = NSFileManager.defaultManager();\n    if (manager.fileExistsAtPath(path)) {\n        return true;\n    } else {\n        if (manager.createDirectoryAtPath_withIntermediateDirectories_attributes_error(path, true, nil, nil)) {\n            return true;\n        } else {\n            console.warn(\"Utils.createDirectoryIfNeeded: failed to create directory \" + path);\n            return false;\n        }\n    }\n};\n\n\nUtils.forceNewDirectory = function(path) {\n    const manager = NSFileManager.defaultManager();\n    if (manager.fileExistsAtPath(path)) {\n        manager.removeItemAtPath_error(path, nil);\n    }\n        \n    if (manager.createDirectoryAtPath_withIntermediateDirectories_attributes_error(path, true, nil, nil)) {\n        return true;\n    } else {\n        console.warn(\"Utils.forceNewDirectory: failed to create directory \" + path);\n        return false;\n    }\n};\n\n\nUtils.roundWithDecimalPrecision = function (value, precision){\n    let multiplier = Math.pow(10, precision || 0);\n    return Math.round(value * multiplier)/multiplier;\n};\n\n\nUtils.roundBy = function(value, rounder) {\n    let multiplier = 1/(rounder || 0.5);\n    return Math.round(value * multiplier)/multiplier;\n}\n\n\nUtils.isLine = function(layer) {\n    return (\n            layer && layer.sketchObject \n            && layer.sketchObject.isKindOfClass(MSShapePathLayer.class())\n            && (layer.shapeType == \"Custom\") && (layer.points.length == 2)\n            );\n};\n\n\n\nUtils.exportLayerWithFormats = function(layer, exportPath, exportName, formats, preserveFrameSize, applyTransformAndOpacity) {\n    let topInset = 0;\n    let bottomInset = 0;\n    let leftInset = 0;\n    let rightInset = 0;\n\n    if (!layer || !exportPath)\n    {\n        console.warn(\"Utils.exportLayerWithFormats: layer or exportPath is not defined\");\n        return [topInset, bottomInset, leftInset, rightInset];\n    }\n\n    if (formats.length > 0) \n    {\n        let sketchDom = require('sketch/dom');\n        let document = sketchDom.getSelectedDocument();\n        let layerToExport = layer;\n\n        if (!exportName)\n            exportName = layer.name;\n\n        if (!exportPath.endsWith(\"/\"))\n            exportPath += \"/\";\n\n        // Duplicate our layer if needed\n        let useDuplicate = false;\n        let isRotated = (layer.transform.rotation != 0);\n        let isFlippedHorizontally = layer.transform.flippedHorizontally;\n        let isFlippedVertically = layer.transform.flippedVertically;\n        let parentIsGroup = (layer.parent && layer.parent.sketchObject && layer.parent.sketchObject.isKindOfClass(MSLayerGroup.class()));\n        if (\n            !applyTransformAndOpacity \n            && \n            ((layer.style.opacity != 1) || isRotated || isFlippedHorizontally || layer.transform.flippedVertically || parentIsGroup)\n            )\n        {\n            useDuplicate = true;\n            layerToExport = layer.duplicate();\n            layerToExport.parent = document.selectedPage;\n\n            layerToExport.style.opacity = 1;\n            \n             if (isFlippedHorizontally)\n                layerToExport.transform.flippedHorizontally = false;\n \n             if (isFlippedVertically)\n                 layerToExport.transform.flippedVertically = false;\n \n            if (isRotated) {\n                if (Utils.isLine(layer)) {\n                    // Special case: Sketch updates the points of a line when we set its rotation\n                    // Rotation = 0 => horizontal line\n                   let frame = layerToExport.frame;\n                   let point0 = layerToExport.points[0];\n                   let pt0X = point0.point.x * frame.width;\n                   let pt0Y = point0.point.y * frame.height;\n                   let point1 = layerToExport.points[1];\n                   let pt1X = point1.point.x * frame.width;\n                   let pt1Y = point1.point.y * frame.height;\n                   let angleInDegrees = Math.atan2(pt1Y - pt0Y, pt1X - pt0X) * 180 / Math.PI;\n\n                   layerToExport.transform.rotation = angleInDegrees;\n                } else {\n                    layerToExport.transform.rotation = 0;\n                }\n            }\n        }\n\n        let nativeLayer = layerToExport.sketchObject;\n        let absoluteRect = nativeLayer.absoluteRect().rect();\n        let absoluteInfluenceRect = nativeLayer.absoluteInfluenceRect();\n\n        let exportRect = absoluteRect;\n        if (!preserveFrameSize && !CGRectContainsRect(absoluteRect, absoluteInfluenceRect))\n        {\n            //TODO: decide if it's better to use the influence rectangle OR to use the union of both rectangles\n            //     - influence rectangle: we export the smallest possible image BUT we can have rather high inset values\n            //     - union: we can have small inset values BUT we export a larger image\n            //exportRect = CGRectUnion(absoluteRect, absoluteInfluenceRect); \n            exportRect = absoluteInfluenceRect;\n\n            let absoluteRectX = Utils.roundBy(absoluteRect.origin.x, 0.5);\n            let absoluteRectY = Utils.roundBy(absoluteRect.origin.y, 0.5);\n            let absoluteRectWidth = Math.ceil(absoluteRect.size.width);\n            let absoluteRectHeight = Math.ceil(absoluteRect.size.height);\n\n            topInset = exportRect.origin.y - absoluteRectY;\n            bottomInset = (absoluteRectY + absoluteRectHeight) - (exportRect.origin.y + exportRect.size.height);\n            leftInset = exportRect.origin.x - absoluteRectX;\n            rightInset = (absoluteRectX + absoluteRectWidth) - (exportRect.origin.x + exportRect.size.width);\n\n//         log(\"Utils.exportLayerWithFormats: we don't use the frame size of our layer, we will use insets to extend the visual size of our layer. Layer=\" + layer.name + \", top=\" + topInset + \", bottom=\" + bottomInset + \", left=\" + leftInset + \", right=\" + rightInset);\n        }\n//      else log(\"Utils.exportLayerWithFormats: we use the frame size of our layer to avoid trimming of transparent pixels. Layer=\" + layer.name);\n\n        //log(\"Export \" + exportName + \" rect \" + exportRect.origin.x + \", \" + exportRect.origin.y + \", \" + exportRect.size.width + \", \" + exportRect.size.height)\n        //log(\" => insets top=\" + topInset + \", bottom=\" + bottomInset + \" -- left=\" + leftInset + \", right=\" + rightInset)\n     \n        const sketchVersion = require('sketch/dom').version.sketch;\n        if (sketchVersion >= 79) {\n            // Version 79 of Sketch-Headers does not contain\n            // -(id)exportRequestFromExportFormat:(id)arg1 layer:(id)arg2 inRect:(struct CGRect)arg3 useIDForName:(BOOL)arg4;\n            formats.forEach(format => {\n                let exportFormat = (format.sketchObject ? format.sketchObject : format);\n                let exportRequest = MSExportRequest.exportRequestsFromExportableLayer_exportFormats_inRect_useIDForName(nativeLayer, [exportFormat], exportRect, false).firstObject();\n                exportRequest.setShouldTrim(false);\n                document.sketchObject.saveArtboardOrSlice_toFile(exportRequest, exportPath + MSExportFormat.exportableFilenameForLayerName_exportFormat(exportName, exportFormat));\n            });\n        } else {\n            formats.forEach(format => {\n                let exportFormat = (format.sketchObject ? format.sketchObject : format);\n                let exportRequest = MSExportRequest.exportRequestFromExportFormat_layer_inRect_useIDForName(exportFormat, nativeLayer, exportRect, false);\n                exportRequest.setShouldTrim(false);\n                document.sketchObject.saveArtboardOrSlice_toFile(exportRequest, exportPath + MSExportFormat.exportableFilenameForLayerName_exportFormat(exportName, exportFormat));\n            });\n        }\n\n        if (useDuplicate)\n        {\n            layerToExport.remove();\n        }\n    }\n    else\n    {\n        console.warn(\"Utils.exportLayerWithFormats: no export format to export layer \" + layer.name);\n    }\n\n    return [topInset, bottomInset, leftInset, rightInset];\n}\n\n\n\nUtils.exportLayerAsPNG = function(layer, maxAtN, exportPath, exportName, preserveFrameSize, applyTransformAndOpacity) {\n    if (!layer || !exportPath)\n    {\n        console.warn(\"Utils.exportLayerAsPNG: layer or exportPath is not defined\");\n        return [0, 0, 0, 0];\n    }\n\n    maxAtN = Math.max(1, maxAtN);\n\n    let exportFormats = [];\n    for (let index = 1; index <= maxAtN; index++) \n    {\n        let pngFormat = MSExportFormat.alloc().init();\n        pngFormat.setFileFormat(\"png\");\n        pngFormat.setScale(index);\n        pngFormat.setName((index === 1) ? \"\" : \"@\" + index + \"x\");\n        \n        exportFormats.push(pngFormat);\n    }\n\n    return Utils.exportLayerWithFormats(layer, exportPath, exportName, exportFormats, preserveFrameSize, applyTransformAndOpacity);\n};\n\n\nUtils.exportLayerAsSVG = function(layer, exportPath, exportName, preserveFrameSize, applyTransformAndOpacity) {\n    if (!layer || !exportPath)\n    {\n        console.warn(\"Utils.exportLayerAsSVG: layer or exportPath is not defined\");\n        return [0, 0, 0, 0];\n    }\n\n    let svgFormat = MSExportFormat.alloc().init();\n    svgFormat.setFileFormat(\"svg\");\n    svgFormat.setScale(1);\n\n    return Utils.exportLayerWithFormats(layer, exportPath, exportName, [svgFormat], preserveFrameSize, applyTransformAndOpacity);\n};\n\n\nUtils.exportLayerWithUserDefinedExportOptions = function(layer, exportPath, exportName, preserveFrameSize, applyTransformAndOpacity) {\n    if (!layer || !exportPath)\n    {\n        console.warn(\"Utils.exportLayerWithUserDefinedExportOptions: layer or exportPath is not defined\");\n        return [0, 0, 0, 0];\n    }\n\n    return Utils.exportLayerWithFormats(layer, exportPath, exportName, layer.exportFormats, preserveFrameSize, applyTransformAndOpacity);\n};\n\n\n\nmodule.exports = Utils;\n","\nfunction xmlAddElement(parent, name, attributes, value){\n    if (parent == null){\n        log (\"parent is null for \" + name);\n        return null;\n    }\n    var el;\n    if (value != null){\n        el = NSXMLElement.elementWithName_stringValue(NSString.stringWithFormat(\"%@\", name),\n                                                      NSString.stringWithFormat(\"%@\", value));\n    }else{\n        el = NSXMLElement.elementWithName(NSString.stringWithFormat(\"%@\", name));\n    }\n    \n    for (var i = 0; attributes && (i < attributes.length); i+=2){\n        el.addAttribute(NSXMLNode.attributeWithName_stringValue(NSString.stringWithFormat(\"%@\", attributes[i]),NSString.stringWithFormat(\"%@\", attributes[i+1])));\n    }\n    parent.addChild(el);\n    return el;\n}\n\nfunction xmlAddAttributesToElement(element, keyValues){\n    if (element == null){\n        log (\"xmlAddAttributesToElement: element is null\");\n        return null;\n    }\n    for (var i = 0; keyValues && (i < keyValues.length); i+=2){\n        element.addAttribute(NSXMLNode.attributeWithName_stringValue(NSString.stringWithFormat(\"%@\", keyValues[i]), NSString.stringWithFormat(\"%@\", keyValues[i+1])));\n    }\n}\n\nfunction xmlAddCustomPropertiesToElement(xmlElement, keyValues) {\n    while (keyValues.length > 0) {\n       xmlAddElement(xmlElement, \"property\", [\"key\", keyValues.shift().trim(), \"value\", keyValues.shift().trim()], null);\n    }\n}\n\nfunction exportXMLToPath(path, root){\n    var doc = NSXMLDocument.documentWithRootElement(root);\n    var xmlData = doc.XMLDataWithOptions(NSXMLNodePrettyPrint);\n    const p = NSString.stringWithFormat(\"%@\", path).stringByExpandingTildeInPath();\n    xmlData.writeToFile(p);\n}\n\nmodule.exports = {xmlAddElement, xmlAddAttributesToElement, xmlAddCustomPropertiesToElement, exportXMLToPath};","module.exports = require(\"sketch/dom\");","module.exports = require(\"sketch/settings\");","module.exports = require(\"sketch/ui\");"],"sourceRoot":""}