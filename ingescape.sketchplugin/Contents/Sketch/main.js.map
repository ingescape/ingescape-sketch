{"version":3,"sources":["webpack://exports/webpack/bootstrap","webpack://exports/./src/main.js","webpack://exports/./src/tree.js","webpack://exports/./src/utils.js","webpack://exports/./src/xml.js","webpack://exports/external \"sketch/dom\"","webpack://exports/external \"sketch/settings\"","webpack://exports/external \"sketch/ui\""],"names":["onShowAboutDialog","context","iconPath","plugin","urlForResourceNamed","path","icon","NSImage","alloc","initByReferencingFile","dialog","NSAlert","init","setMessageText","setInformativeText","addButtonWithTitle","responseCode","runModal","NSAlertFirstButtonReturn","NSWorkspace","sharedWorkspace","openURL","NSURL","URLWithString","onOpenFileAndExportWholeAsXml","file","Document","require","filePath","String","fileName","substring","lastIndexOf","indexOf","replace","trim","fileDir","open","err","document","console","warn","exportWhole","getSelectedDocument","close","onExportLibraryAsXml","Tree","Xml","Utils","sketch","settings","UI","alert","chooseFolder","log","docPath","decodeURI","docPathElements","split","documentName","length","pascalize","libraryName","libraryFontsSubDir","libraryImagesSubDir","createDirectoryIfNeeded","forceNewDirectory","message","documentContext","initDocumentContext","xmlLibraryRoot","NSXMLElement","initWithName","xmlAddAttributesToElement","version","symbols","getSymbols","symbolsIDs","i","currentSymbol","name","startsWith","includes","id","push","indexedData","globalNamesIndex","actualName","getUniqueNameFromIndexedData","actualType","getTypeFromIndexedData","keyValues","getKeyValuesFromIndexedData","parentType","getParentTypeFromIndexedData","xmlComponent","xmlAddElement","frame","width","height","background","enabled","includedInInstance","getBackgroundColorAsHexValueOrSwatchReference","xmlAddCustomPropertiesToElement","addSymbolMasterOverridesToXml","treeIterateLayers","layers","addSharedTextStylesToXml","addFontFilesToXml","fontFiles","addColorVariablesToXml","clearTempContext","xmlFilePath","exportXMLToPath","playSoundNamed","Sounds","Glass","showInFinder","onExportApplicationAsXml","appName","appFontsSubDir","appImagesSubDir","xmlAppRoot","pages","page","xmlPage","artboards","j","artboardOrlayer","type","sketchObject","class","artboard","xmlScreen","includedInExport","exportDir","interactionsAllowed","maxNumberOfSteps","onExportWholeAsXml","onExportFonts","forEach","getFontFilesUsedByLayer","fontFile","copyFile","onExportSelectedLayersAsPNG","selectedLayers","NSBeep","layer","exportLayerAsPNG","onExportSelectedLayersAsSVG","exportLayerAsSVG","onExportSelectedLayersWithUserPredefinedExportOptions","exportLayerWithUserDefinedExportOptions","forbiddenNames","diacriticsMap","A","AE","E","I","O","OE","U","a","ae","c","e","o","oe","u","numberOfImagesPerLayerExport","maximumImageWidthOrHeight","GLOBALNAMESINDEX_UNIQUENAME","GLOBALNAMESINDEX_TYPE","GLOBALNAMESINDEX_KEYVALUES","GLOBALNAMESINDEX_RAWNAME","GLOBALNAMESINDEX_PARENTTYPE","TEMP_CONTEXT","POINT_DECIMAL_PRECISION","ANGLE_DECIMAL_PRECISION","data","getRawNameFromIndexedData","availableSwatchIDs","missingSwatches","sharedLayerStylesIndex","sharedTextStylesIndex","textsWithOutOfSyncStyle","sharedLayerStyles","style","sharedTextStyles","treePopulateGlobalNamesIndex","nb","Object","keys","usedNativeSwatches","documentData","allSwatches","nativeSwatch","objectID","addFontFileToContext","fontFilePath","result","layerFontFilePath","subLayer","symbolMaster","xmlRoot","overrides","overR","editable","property","overrideTargetPath","treeBuildOverrideTargetPath","parent","shallIgnoreSymbolMasters","rootDirPath","imagesSubDir","mask","actualParent","currentMask","l","isCustomClass","rawName","xmlCurrent","addCustomPropertiesToXml","text","_object","shouldBreakMaskChain","master","indexedDataSymbolMaster","sketchVersion","symbolOverridesHash","isEditable","isDefault","indexedDataOverride","affectedLayer","originalOverrideTargetPath","overrideValue","defaultValue","currentValue","overrideParent","prefix","dotIndex","hasOwnProperty","imgData","value","nsdata","imgName","NSString","stringWithFormat","imgRelativePath","writeToFile_atomically","currentOver","affectedLayerUsesAnOutOfSyncStyle","overrideStyle","styleFontFilePath","styleXML","treeAddAttributesFromLayerStyle","indexexDataOldSymbol","oldType","newType","newSymbol","getSymbolMasterWithID","indexedDataNewSymbol","xmlSymbolOverride","hasClippingMask","shallBlockBecauseExportExists","treeAddAttributesFromLayerData","treeAddAttributesFromPointData","currentXMLElement","point","pointType","pointAttributes","roundWithDecimalPrecision","x","y","cornerRadius","nativePoint","hasCurveFrom","curveFrom","hasCurveTo","curveTo","treeAddTextBehaviour","isTextLayer","layerTextBehaviour","treeAddAttributesFromTextStyle","layerOrSharedTextStyle","sharedTextStyle","isText","sharedStyle","attributes","opacity","blendingMode","textBehaviour","alignment","verticalAlignment","textColor","getTextColorAsHexValueOrSwatchReference","lineHeight","paragraphSpacing","needFontFamily","fontFamily","needFontSize","fontSize","needFontWeight","fontWeight","needFontStyle","fontStyle","needFontVariant","fontVariant","needFontStretch","fontStretch","needKerning","kerning","needTextTransform","textTransform","needTextUnderline","textUnderline","needTextStrikethrough","textStrikethrough","fontPostscriptNameFromStyle","fontStyleNameFromStyle","borderOptions","startArrowhead","endArrowhead","dashPatternLength","dashPattern","dashPatternString","join","lineEnd","lineJoin","fills","fill","xmlFill","fillAttributes","fillType","getFillColorAsHexValueOrSwatchReference","gradient","gradientType","from","to","aspectRatio","stops","stop","stopAttributes","position","rgbaToArgbOrRgb","color","pattern","patternType","tileScale","borders","border","xmlBorder","borderAttributes","thickness","locked","hidden","transform","rotation","flippedHorizontally","flippedVertically","hasFixedWidth","hasFixedHeight","hasFixedLeft","hasFixedTop","hasFixedRight","roundBy","hasFixedBottom","Math","ceil","flow","target","targetId","animationType","renderingAsImage","isSupportedLayer","treeForceImageExport","exportFormats","hasExports","canExportTypeAsImage","treeAddImageExport","sharedStyleId","isSharedStyleOutOfSync","shapeType","closed","points","escapeCharactersInUnicodePrivateUseArea","endsWith","exportPath","numberOfImages","layerWidth","layerHeight","currentAtN","insets","exportAttr","succeeded","format","exportFormat","MSExportFormat","exportableFilenameForLayerName_exportFormat","sizeText","size","fileFormat","suffix","treeAddLayerInGlobalNamesIndex","layerNamesUnicityByContext","layersStack","contextStack","elements","nameAndType","shift","useActualNameAsType","extractedTypeIsParentType","isLine","extractedType","match","toLowerCase","contextKey","localLayerNamesUnicityHash","counter","hashKey","camelize","lowerCaseFirstCharater","pop","layerId","unshift","rootKey","myId","getLayerWithID","elmts","index","str","xmlParent","fontsSubDir","excludeSystemFonts","fontFileNames","sort","validSwatchName","colorNames","validName","has","get","set","Map","swatchesData","swatch","fromNative","key","b","swatchData","styleNames","stylesData","textStyleData","sharedTextStyleXml","removeDiacritics","firstCharIsInvalid","p1","p2","offset","toUpperCase","capitalize","test","charAt","reduce","replaceRegexp","std","slice","charCodeAt","toString","textStyle","fontPostscriptName","fontDisplayName","NSFont","displayName","fontStyleName","mscolorToHexValueOrSwatchReference","MSAttributedStringColorAttribute","rgbaToArgb","backgroundColor","mscolor","swatchID","mscolorToArgbOrRgb","immutableModelObject","hexValue","round","alpha","textBehaviourValue","nsFont","urlAttribute","fontDescriptor","objectForKey","isLayerGroup","isKindOfClass","MSLayerGroup","MSShapeGroup","isBitmapLayer","MSBitmapLayer","MSTextLayer","isShapeLayer","MSRectangleShape","MSOvalShape","MSPolygonShape","MSStarShape","MSTriangleShape","MSShapePathLayer","isRectangleShape","isRectangle","isOvalShape","isSliceLayer","MSSliceLayer","isArtboard","MSArtboardGroup","isSymbolMaster","MSSymbolMaster","isSymbolInstance","MSSymbolInstance","isSupportedLine","isSupportedShapeStyle","isSupported","blur","shadows","filter","item","innerShadows","activeItems","numberOfActiveItems","lastItem","module","exports","Basso","Blow","Bottle","Frog","Funk","Hero","Morse","Ping","Pop","Purr","Sosumi","Submarine","Tink","sound","NSSound","soundNamed","play","panel","NSOpenPanel","openPanel","setCanChooseDirectories","setCanChooseFiles","setCanCreateDirectories","NSModalResponseOK","URL","showDialog","app","NSApplication","sharedApplication","displayDialog_withTitle","directoryPathOrFilePath","errorPointer","MOPointer","fileManager","NSFileManager","defaultManager","attributesOfItemAtPath_error","isDirectory","openFile_withApplication","selectFile_inFileViewerRootedAtPath","nil","runCommand","command","args","currentDirectoryPath","task","NSTask","setLaunchPath_","setCurrentDirectoryPath","arguments","launch","waitUntilExit","terminationStatus","source","destination","manager","fileExistsAtPath","copyItemAtPath_toPath_error","fileExists","expandTildeInPath","stringWithString","stringByExpandingTildeInPath","createDirectoryAtPath_withIntermediateDirectories_attributes_error","removeItemAtPath_error","precision","multiplier","pow","Number","EPSILON","rounder","MSLayerAbsoluteInfluenceRect","nativeLayer","immutable","relativeInfluenceRect","influenceRectForBoundsInDocument","convertRect_toLayer_","absoluteInfluenceRect","exportLayerWithFormats","exportName","formats","preserveFrameSize","applyTransformAndOpacity","topInset","bottomInset","leftInset","rightInset","sketchDom","layerToExport","isRotated","isFlippedHorizontally","isFlippedVertically","parentIsGroup","useDuplicate","duplicate","selectedPage","point0","pt0X","pt0Y","point1","pt1X","pt1Y","angleInDegrees","atan2","PI","absoluteRect","rect","exportRect","CGRectContainsRect","absoluteRectX","origin","absoluteRectY","absoluteRectWidth","absoluteRectHeight","exportRequest","MSExportRequest","exportRequestsFromExportableLayer_exportFormats_inRect_useIDForName","firstObject","setShouldTrim","saveArtboardOrSlice_toFile","exportRequestFromExportFormat_layer_inRect_useIDForName","remove","maxAtN","max","pngFormat","setFileFormat","setScale","setName","svgFormat","el","elementWithName_stringValue","elementWithName","addAttribute","NSXMLNode","attributeWithName_stringValue","addChild","element","xmlElement","root","doc","NSXMLDocument","documentWithRootElement","xmlData","XMLDataWithOptions","NSXMLNodePrettyPrint","p","writeToFile"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/main.js\");\n","export function onShowAboutDialog(context) {\n    let iconPath = context.plugin.urlForResourceNamed('icon.png').path();\n    let icon = NSImage.alloc().initByReferencingFile(iconPath);\n    let dialog = NSAlert.alloc().init();\n    dialog.setMessageText(\"Ingescape plugin\");\n    dialog.setInformativeText(\"This plugin exports a Sketch file to an Ingescape Pivot format for code generation in Qt/QML, etc. to be used in Ingescape Circle\");\n    dialog.icon = icon;\n    dialog.addButtonWithTitle(\"Get Circle\");\n    dialog.addButtonWithTitle(\"Close\");\n\n    let responseCode = dialog.runModal();\n    if (responseCode == NSAlertFirstButtonReturn) {\n        NSWorkspace.sharedWorkspace().openURL(NSURL.URLWithString(\"https://ingescape.com/circle/\"));\n    }  \n}\n\n\nexport function onOpenFileAndExportWholeAsXml(context) {\n    if(context.file) \n    {\n        let Document = require('sketch/dom').Document;\n        let filePath = String(context.file);\n        let fileName = filePath.substring(filePath.lastIndexOf(\"/\")+1, filePath.indexOf(\".\"));\n        fileName = fileName.replace(/[^a-zA-Z0-9\\-_\\s]/g, \"\")\n        fileName = fileName.trim();\n        let fileDir = filePath.substring(0, filePath.lastIndexOf(\"/\")+1) + fileName + \"_export/\";\n\n        // because of a bug, we can't call context.file directly, we must cast it as a string\n        Document.open(String(context.file), (err, document) => {\n            if (err) {\n                console.warn(\"Can't open file \", filePath, true)\n            }\n            else {\n                exportWhole(context, fileDir, false);\n                let document = require('sketch/dom').getSelectedDocument();\n                document.close();\n            }\n        });\n    }\n}\n\n/*\n Exporting file as a library consists in looking for the symbol masters\n declared as components (using the -> symbol) and exposing their\n inner parts in XML structures.\n*/\nexport function onExportLibraryAsXml(context) {\n    let Tree = require(\"./tree.js\");\n    let Xml = require(\"./xml.js\");\n    let Utils = require(\"./utils.js\");\n    let sketch = require('sketch/dom');\n    let document = sketch.getSelectedDocument();\n    let settings = require(\"sketch/settings\");\n    let UI = require('sketch/ui');\n\n    if (!document.path) {\n        UI.alert(\"Sketch2QML: can not export library as XML\", \"You must save your Sketch file first\")\n        return;\n    }\n\n    let path = Utils.chooseFolder();\n    if (!path) {\n        log(\"onExportLibraryAsXml: action cancelled by user\");\n        return;\n    }\n\n    let docPath = decodeURI(document.path);\n    let docPathElements = docPath.split('/');\n    let documentName = \"Default\";\n    if (docPathElements.length > 0) {\n        documentName = Tree.pascalize(docPathElements[docPathElements.length - 1].replace(/.sketch/g,\"\"));\n    }\n\n    let libraryName = documentName;\n\n    // Init directories\n    let libraryFontsSubDir = \"resources/\" + libraryName + \"_library/fonts/\";\n    let libraryImagesSubDir = \"resources/\" + libraryName + \"_library/images/\";\n    Utils.createDirectoryIfNeeded(path + libraryFontsSubDir);\n    Utils.forceNewDirectory(path + libraryImagesSubDir);\n\n    UI.message(\" Exporting library as Ingescape Pivot format. Please wait...\");\n\n    let documentContext = Tree.initDocumentContext();\n\n    //init lib\n    let xmlLibraryRoot = NSXMLElement.alloc().initWithName(\"library\");\n    Xml.xmlAddAttributesToElement(xmlLibraryRoot, [\"name\", libraryName, \"sketchVersion\", settings.version.sketch]);\n\n    //export lib\n    let symbols = document.getSymbols();\n    let symbolsIDs = [];\n    for (let i = 0; symbols && (i < symbols.length); i++){\n        let currentSymbol = symbols[i];\n\n        if (currentSymbol.name.startsWith(\"#\")){\n            continue;\n        }\n\n        if (symbolsIDs.includes(currentSymbol.id)){\n            log(\"WARNING: symbol already included (ID=\" + currentSymbol.id + \", name \" + currentSymbol.name + \")\");\n            continue;\n        } else {\n            symbolsIDs.push(currentSymbol.id);\n        }\n\n        let indexedData = documentContext.globalNamesIndex[currentSymbol.id];\n        if (!indexedData){\n            log(\"could not find indexed data for \" + currentSymbol.name + \". This element will be ignored\");\n            log(\"\\t->Please check that it is not an external master that has not been made local.\")\n            continue;\n        }\n        let actualName = Tree.getUniqueNameFromIndexedData(indexedData);\n        let actualType = Tree.getTypeFromIndexedData(indexedData);\n        let keyValues = Tree.getKeyValuesFromIndexedData(indexedData);\n        let parentType = Tree.getParentTypeFromIndexedData(indexedData);\n\n        let xmlComponent = Xml.xmlAddElement(xmlLibraryRoot, \"component\", \n                                        [\"type\", actualType, \"name\", actualName, \n                                        \"width\", currentSymbol.frame.width, \"height\", currentSymbol.frame.height,\n                                        \"hasBackground\", (currentSymbol.background.enabled && currentSymbol.background.includedInInstance),\n                                        \"backgroundColor\", Tree.getBackgroundColorAsHexValueOrSwatchReference(currentSymbol)],\n                                        null);\n\n        if (parentType)\n            Xml.xmlAddAttributesToElement(xmlComponent, [\"parentType\", parentType]);\n\n        if (keyValues.length > 0)\n            Xml.xmlAddCustomPropertiesToElement(xmlComponent, keyValues);\n\n        Tree.addSymbolMasterOverridesToXml(currentSymbol, xmlComponent, documentContext);\n        Tree.treeIterateLayers(currentSymbol.layers, xmlComponent, false, path, libraryImagesSubDir, xmlLibraryRoot, documentContext, null);\n    }\n\n    Tree.addSharedTextStylesToXml(xmlLibraryRoot);\n    Tree.addFontFilesToXml(xmlLibraryRoot, path, libraryFontsSubDir, documentContext.fontFiles, false);\n    Tree.addColorVariablesToXml(xmlLibraryRoot); // NB: it must be done after all exports because styles and items may use not imported swatches\n    Tree.clearTempContext();\n    \n    //export model to XML\n    let xmlFilePath = path + libraryName + \"_library.xml\";\n    Xml.exportXMLToPath(xmlFilePath, xmlLibraryRoot);\n\n    Utils.playSoundNamed(Utils.Sounds.Glass);\n    UI.message(\" Library export completed to \" + xmlFilePath);\n    Utils.showInFinder(xmlFilePath); \n}\n\n\n/*\n Exports all artboards and orphan layers as windows\n */\nexport function onExportApplicationAsXml(context) {\n    let Tree = require(\"./tree.js\");\n    let Xml = require(\"./xml.js\");\n    let Utils = require(\"./utils.js\");\n    let sketch = require('sketch/dom')\n    let document = sketch.getSelectedDocument();\n    let settings = require(\"sketch/settings\");\n    let UI = require('sketch/ui');\n\n    if (!document.path) {\n        UI.alert(\"Sketch2QML: can not export application as XML\", \"You must save your Sketch file first\")\n        return;\n    }\n\n    let path = Utils.chooseFolder();\n    if (!path){\n        log(\"onExportApplicationAsXml: action cancelled by user\");\n        return;\n    }\n\n    let docPath = decodeURI(document.path);\n    let docPathElements = docPath.split('/');\n    let documentName = \"Default\";\n    if (docPathElements.length > 0){\n        documentName = Tree.pascalize(docPathElements[docPathElements.length - 1].replace(/.sketch/g,\"\"));\n    }\n\n    let appName = documentName;\n\n    // Init directories\n    let appFontsSubDir = \"resources/\" + appName + \"_app/fonts/\";\n    let appImagesSubDir = \"resources/\" + appName + \"_app/images/\";\n    Utils.createDirectoryIfNeeded(path + appFontsSubDir);\n    Utils.forceNewDirectory(path + appImagesSubDir);\n \n\n    UI.message(\" Exporting application as Ingescape Pivot format. Please wait...\");\n\n    let documentContext = Tree.initDocumentContext();\n\n    //init app\n    let xmlAppRoot = NSXMLElement.alloc().initWithName(\"app\");\n    Xml.xmlAddAttributesToElement(xmlAppRoot, [\"name\", appName, \"sketchVersion\", settings.version.sketch]);\n    \n\n    //export app\n    for (let i = 0; i < document.pages.length; i++){\n        let page = document.pages[i]\n        if (page.name.startsWith(\"#\")){\n            continue;\n        }\n\n        let xmlPage = Xml.xmlAddElement(xmlAppRoot, \"page\", [\"name\", page.name], null);\n        \n        // Artboard and elements outside of artboards\n        let artboards = [];\n        let layers = [];\n        for (let j = 0; j < page.layers.length; j++){\n            let artboardOrlayer = page.layers[j];\n            let type = artboardOrlayer.sketchObject.class();\n            if (type != \"MSArtboardGroup\"){\n                layers.push(artboardOrlayer);\n            } else {\n                artboards.push(artboardOrlayer);\n            }\n        }\n\n        Tree.treeIterateLayers(layers, xmlPage, true, path, appImagesSubDir, xmlAppRoot, documentContext, null);\n        \n        for (let j = 0; j < artboards.length; j++) {\n            let artboard = artboards[j];\n\n            if (artboard.name.startsWith(\"#\")){\n                continue;\n            }\n\n            let indexedData = documentContext.globalNamesIndex[artboard.id];\n            if (!indexedData){\n                log(\"could not find indexed data for \" + artboard.name + \". This artboard will be ignored\");\n                continue;\n            }\n\n            let actualName = Tree.getUniqueNameFromIndexedData(indexedData);\n            let actualType = Tree.getTypeFromIndexedData(indexedData);\n            let keyValues = Tree.getKeyValuesFromIndexedData(indexedData);\n            let parentType = Tree.getParentTypeFromIndexedData(indexedData);\n\n            let xmlScreen = Xml.xmlAddElement(xmlPage, \"screen\", \n                                        [\"type\", actualType, \"name\", actualName, \n                                        \"width\", artboard.frame.width, \"height\", artboard.frame.height,\n                                        \"hasBackground\", (artboard.background.enabled && artboard.background.includedInExport),\n                                        \"backgroundColor\", Tree.getBackgroundColorAsHexValueOrSwatchReference(artboard)],\n                                         null);\n\n            if (parentType)\n                Xml.xmlAddAttributesToElement(xmlScreen, [\"parentType\", parentType]);                                         \n\n            if (keyValues.length > 0)\n                Xml.xmlAddCustomPropertiesToElement(xmlScreen, keyValues);\n\n            Tree.treeIterateLayers(artboard.layers, xmlScreen, true, path, appImagesSubDir, xmlAppRoot, documentContext, null);\n        }\n     }\n\n    Tree.addSharedTextStylesToXml(xmlAppRoot);\n    Tree.addFontFilesToXml(xmlAppRoot, path, appFontsSubDir, documentContext.fontFiles, false);\n    Tree.addColorVariablesToXml(xmlAppRoot); // NB: it must be done after all exports because styles and items may use not imported swatches\n    Tree.clearTempContext();\n    \n    let xmlFilePath = path + appName + \"_app.xml\"\n    Xml.exportXMLToPath(xmlFilePath, xmlAppRoot);\n\n    Utils.playSoundNamed(Utils.Sounds.Glass);\n    UI.message(\" App export completed to \" + xmlFilePath);\n    Utils.showInFinder(xmlFilePath); \n};\n\n\nfunction exportWhole(context, exportDir = \"\", interactionsAllowed = true) {\n    let Tree = require(\"./tree.js\");\n    let Xml = require(\"./xml.js\");\n    let Utils = require(\"./utils.js\");\n    let sketch = require('sketch/dom');\n    let document = sketch.getSelectedDocument();\n    let settings = require(\"sketch/settings\");\n    let UI = require('sketch/ui');\n\n    let path = (interactionsAllowed && (exportDir === \"\")) ? Utils.chooseFolder() : exportDir;\n    if (!path){\n        log(\"exportWhole: action cancelled by user\");\n        return;\n    }\n\n    let docPath = decodeURI(document.path);\n    let docPathElements = docPath.split('/');\n    let documentName = \"Default\";\n    if (docPathElements.length > 0){\n        documentName = Tree.pascalize(docPathElements[docPathElements.length - 1].replace(/.sketch/g,\"\"));\n    }\n\n    let appName = documentName;\n    let libraryName = documentName;\n\n    // Init directories\n    let appFontsSubDir = \"resources/\" + appName + \"_app/fonts/\";\n    let appImagesSubDir = \"resources/\" + appName + \"_app/images/\";\n    let libraryFontsSubDir = \"resources/\" + libraryName + \"_library/fonts/\";\n    let libraryImagesSubDir = \"resources/\" + libraryName + \"_library/images/\";\n    Utils.createDirectoryIfNeeded(path + appFontsSubDir);\n    Utils.forceNewDirectory(path + appImagesSubDir);\n    Utils.createDirectoryIfNeeded(path + libraryFontsSubDir);\n    Utils.forceNewDirectory(path + libraryImagesSubDir);\n        \n\n    let maxNumberOfSteps = 2;\n    UI.message(\" [1/\" + maxNumberOfSteps+ \"] Exporting library as Ingescape Pivot format. Please wait...\");\n\n    let documentContext = Tree.initDocumentContext();\n\n    //export library\n    let xmlLibraryRoot = NSXMLElement.alloc().initWithName(\"library\");\n    Xml.xmlAddAttributesToElement(xmlLibraryRoot, [\"name\", libraryName, \"sketchVersion\", settings.version.sketch]);\n    \n    let symbols = document.getSymbols();\n    let symbolsIDs = [];\n    for (let i = 0; symbols && (i < symbols.length); i++){\n        let currentSymbol = symbols[i];\n\n        if (currentSymbol.name.startsWith(\"#\")){\n            continue;\n        }\n\n        if (symbolsIDs.includes(currentSymbol.id)){\n            log(\"WARNING: symbol already included (ID=\" + currentSymbol.id + \", name \" + currentSymbol.name + \")\");\n            continue;\n        } else {\n            symbolsIDs.push(currentSymbol.id);\n        }\n\n        let indexedData = documentContext.globalNamesIndex[currentSymbol.id];\n        if (!indexedData){\n            log(\"could not find indexed data for \" + currentSymbol.name + \". This element will be ignored\");\n            log(\"\\t->Please check that it is not an external master that has not been made local.\")\n            continue;\n        }\n\n        let actualName = Tree.getUniqueNameFromIndexedData(indexedData);\n        let actualType = Tree.getTypeFromIndexedData(indexedData);\n        let keyValues = Tree.getKeyValuesFromIndexedData(indexedData);\n        let parentType = Tree.getParentTypeFromIndexedData(indexedData);\n\n        let xmlComponent = Xml.xmlAddElement(xmlLibraryRoot, \"component\", \n                                        [\"type\", actualType, \"name\", actualName, \n                                        \"width\", currentSymbol.frame.width, \"height\", currentSymbol.frame.height,\n                                        \"hasBackground\", (currentSymbol.background.enabled && currentSymbol.background.includedInInstance),\n                                        \"backgroundColor\", Tree.getBackgroundColorAsHexValueOrSwatchReference(currentSymbol)], \n                                        null);\n\n        if (parentType)\n            Xml.xmlAddAttributesToElement(xmlComponent, [\"parentType\", parentType]);\n\n        if (keyValues.length > 0)\n            Xml.xmlAddCustomPropertiesToElement(xmlComponent, keyValues);\n\n        Tree.addSymbolMasterOverridesToXml(currentSymbol, xmlComponent, documentContext);\n        Tree.treeIterateLayers(currentSymbol.layers, xmlComponent, false, path, libraryImagesSubDir, xmlLibraryRoot, documentContext, null);\n    }\n\n    Tree.addSharedTextStylesToXml(xmlLibraryRoot);\n    Tree.addFontFilesToXml(xmlLibraryRoot, path, libraryFontsSubDir, documentContext.fontFiles, false);\n    Tree.addColorVariablesToXml(xmlLibraryRoot); // NB: it must be done after all exports because styles and items may use not imported swatches\n\n    Xml.exportXMLToPath(path+libraryName+\"_library.xml\", xmlLibraryRoot);\n\n\n    \n    //export app\n    UI.message(\" [2/\" + maxNumberOfSteps + \"] Exporting application as Ingescape Pivot format. Please wait...\");\n\n    let xmlAppRoot = NSXMLElement.alloc().initWithName(\"app\");\n    Xml.xmlAddAttributesToElement(xmlAppRoot, [\"name\", appName, \"sketchVersion\", settings.version.sketch]);\n\n    for (let i = 0; i < document.pages.length; i++){\n        let page = document.pages[i]\n        if (page.name.startsWith(\"#\")){\n            continue;\n        }\n\n        let xmlPage = Xml.xmlAddElement(xmlAppRoot, \"page\", [\"name\", page.name], null);\n\n        // Artboard and elements outside of artboards\n        let artboards = [];\n        let layers = [];\n        for (let j = 0; j < page.layers.length; j++) {\n            let artboardOrlayer = page.layers[j];\n            let type = artboardOrlayer.sketchObject.class();\n            if (type != \"MSArtboardGroup\"){\n                layers.push(artboardOrlayer);\n            } else {\n                artboards.push(artboardOrlayer);\n            }\n        }\n        \n        Tree.treeIterateLayers(layers, xmlPage, true, path, appImagesSubDir, xmlAppRoot, documentContext, null);\n        \n        for (let j = 0; j < artboards.length; j++) {\n            let artboard = artboards[j];\n\n            if (artboard.name.startsWith(\"#\")){\n                continue;\n            }\n\n            let indexedData = documentContext.globalNamesIndex[artboard.id];\n            if (!indexedData){\n                log(\"could not find indexed data for \" + artboard.name + \". This artboard will be ignored\");\n                continue;\n            }\n\n            let actualName = Tree.getUniqueNameFromIndexedData(indexedData);\n            let actualType = Tree.getTypeFromIndexedData(indexedData);\n            let keyValues = Tree.getKeyValuesFromIndexedData(indexedData);\n            let parentType = Tree.getParentTypeFromIndexedData(indexedData);\n\n            let xmlScreen = Xml.xmlAddElement(xmlPage, \"screen\", \n                                        [\"type\", actualType, \"name\", actualName, \n                                        \"width\", artboard.frame.width, \"height\", artboard.frame.height,\n                                        \"hasBackground\", (artboard.background.enabled && artboard.background.includedInExport),\n                                        \"backgroundColor\", Tree.getBackgroundColorAsHexValueOrSwatchReference(artboard)],\n                                         null);\n            \n            if (parentType)\n                Xml.xmlAddAttributesToElement(xmlScreen, [\"parentType\", parentType]);\n\n            if (keyValues.length > 0)\n                Xml.xmlAddCustomPropertiesToElement(xmlScreen, keyValues);\n\n            Tree.treeIterateLayers(artboard.layers, xmlScreen, true, path, appImagesSubDir, xmlAppRoot, documentContext, null);\n        }\n    }\n\n    Tree.addSharedTextStylesToXml(xmlAppRoot);\n    Tree.addFontFilesToXml(xmlAppRoot, path, appFontsSubDir, documentContext.fontFiles, false);\n    Tree.addColorVariablesToXml(xmlAppRoot); // NB: it must be done after all exports because styles and items may use not imported swatches\n    Tree.clearTempContext();\n\n    Xml.exportXMLToPath(path+appName+\"_app.xml\", xmlAppRoot);\n\n    if (interactionsAllowed) \n    {\n        Utils.playSoundNamed(Utils.Sounds.Glass);\n        UI.message(\" Export of app and lib completed to \" + path);\n        Utils.showInFinder(path);\n    }\n};\n\n\nexport function onExportWholeAsXml(context) {\n    exportWhole(context);\n};\n\n\n\n/** \n * ----------------------------------------------------\n * DEBUG ONLY\n * ----------------------------------------------------  \n*/\n\n\nexport function onExportFonts(context) {\n    let Utils = require(\"./utils.js\");\n\n    let path = Utils.chooseFolder();\n    if (path)\n    {\n        let Tree = require(\"./tree.js\");\n        let document = require('sketch/dom').getSelectedDocument();\n        let UI = require('sketch/ui');\n        let fontFiles = [];\n\n        document.pages.forEach(page => {\n            Tree.getFontFilesUsedByLayer(page, fontFiles);     \n        });\n\n        if (fontFiles.length > 0) \n        {\n            fontFiles.forEach(fontFile => {\n                let fileName = fontFile.substring(fontFile.lastIndexOf('/') + 1);\n                Utils.copyFile(fontFile, path + fileName);\n            });\n\n            UI.message(\" Export completed - \" + fontFiles.length + \" font(s) exported to \" + path);\n            Utils.showInFinder(path);\n        } \n        else \n        {\n            UI.alert(\"Sketch2QML: can not export fonts\", \" No font found in your Sketch document\");\n        }\n    } \n    else \n    {\n        log(\"onExportFonts: action cancelled by user\");\n    } \n};\n\n\nexport function onExportSelectedLayersAsPNG(context) {\n    let Utils = require(\"./utils.js\");\n    let document = require('sketch/dom').getSelectedDocument();\n    let UI = require('sketch/ui');\n\n    let selectedLayers = document.selectedLayers;\n    if (selectedLayers.length == 0) \n    {\n        UI.alert(\"Sketch2QML: can not export PNG\", \" No layers are selected \\n=> Please select one or multiple layers before exporting.\");\n        NSBeep();\n\t\treturn;\n\t}\n\n    let path = Utils.chooseFolder();\n    if (path)\n    {\n        selectedLayers.forEach(layer => {\n            Utils.exportLayerAsPNG(layer, 4, path, layer.name, false, false);\n            //Utils.exportLayerAsPNG(layer, 4, path, layer.name + \"--frame-opacityAndTransform\", true, true);\n            //Utils.exportLayerAsPNG(layer, 4, path, layer.name + \"--noframe-opacityAndTransform\", false, true);\n            //Utils.exportLayerAsPNG(layer, 4, path, layer.name + \"--frame-noopacityAndTransform\", true, false);\n        });\n\n        UI.message(\" Export completed to \" + path);\n        Utils.showInFinder(path);\n    } \n    else \n    {\n        log(\"onExportSelectedLayersAsPNG: action cancelled by user\");\n    } \n};\n\n\nexport function onExportSelectedLayersAsSVG(context) {\n    let Utils = require(\"./utils.js\");\n    let document = require('sketch/dom').getSelectedDocument();\n    let UI = require('sketch/ui');\n\n    let selectedLayers = document.selectedLayers;\n    if (selectedLayers.length == 0) \n    {\n        UI.alert(\"Sketch2QML: can not export SVG\", \" No layers are selected \\n=> Please select one or multiple layers before exporting.\");\n        NSBeep();\n\t\treturn;\n\t}\n\n    let path = Utils.chooseFolder();\n    if (path)\n    {\n        selectedLayers.forEach(layer => {\n            Utils.exportLayerAsSVG(layer, path, layer.name, false, false);\n            //Utils.exportLayerAsSVG(layer, path, layer.name + \"--frame-opacityAndTransform\", true, true);\n            //Utils.exportLayerAsSVG(layer, path, layer.name + \"--noframe-opacityAndTransform\", false, true);\n            //Utils.exportLayerAsSVG(layer, path, layer.name + \"--frame-noopacityAndTransform\", true, false);\n        });\n\n        UI.message(\" Export completed to \" + path);\n        Utils.showInFinder(path);\n    } \n    else \n    {\n        log(\"onExportSelectedLayersAsSVG: action cancelled by user\");\n    } \n};\n\n\nexport function onExportSelectedLayersWithUserPredefinedExportOptions(context) {\n    let Utils = require(\"./utils.js\");\n    let document = require('sketch/dom').getSelectedDocument();\n    let UI = require('sketch/ui');\n   \n    let selectedLayers = document.selectedLayers;\n    if (selectedLayers.length == 0) \n    {\n        UI.alert(\"Sketch2QML: can not export images\", \" No layers are selected \\n=> Please select one or multiple layers before exporting.\");\n        NSBeep();\n\t\treturn;\n\t}\n\n    let path = Utils.chooseFolder();\n    if (path)\n    {\n        selectedLayers.forEach(layer => {\n            Utils.exportLayerWithUserDefinedExportOptions(layer, path, layer.name, false, false);\n            //Utils.exportLayerWithUserDefinedExportOptions(layer, path, layer.name + \"--frame-opacityAndTransform\", true, true);\n            //Utils.exportLayerWithUserDefinedExportOptions(layer, path, layer.name + \"--noframe-opacityAndTransform\", false, true);\n            //Utils.exportLayerWithUserDefinedExportOptions(layer, path, layer.name + \"--frame-noopacityAndTransform\", true, false);\n        });\n\n        UI.message(\" Export completed to \" + path);\n        Utils.showInFinder(path);\n    } \n    else \n    {\n        log(\"onExportSelectedLayersWithUserPredefinedExportOptions: action cancelled by user\");\n    } \n};\n\n\n","// TODO: add all reserved keywords\nlet forbiddenNames = [\n  \"bool\",\n  \"true\",\n  \"false\",\n  \"double\",\n  \"float\",\n  \"real\",\n  \"int\",\n  \"long\",\n  \"short\",\n  \"string\",\n  \"url\",\n  \"var\",\n  \"let\",\n  \"function\",\n  \"if\",\n  \"else\",\n  \"for\",\n  \"while\",\n  \"do\",\n  \"break\",\n  \"switch\",\n  \"case\",\n  \"default\",\n  \"continue\",\n  \"root\",\n  \"delete\",\n  \"bottom\",\n  \"top\",\n  \"left\",\n  \"right\",\n  \"baseline\"\n];\n\n\nlet diacriticsMap = {\n    A: /[\\u0041\\u24B6\\uFF21\\u00C0\\u00C1\\u00C2\\u1EA6\\u1EA4\\u1EAA\\u1EA8\\u00C3\\u0100\\u0102\\u1EB0\\u1EAE\\u1EB4\\u1EB2\\u0226\\u01E0\\u00C4\\u01DE\\u1EA2\\u00C5\\u01FA\\u01CD\\u0200\\u0202\\u1EA0\\u1EAC\\u1EB6\\u1E00\\u0104\\u023A\\u2C6F]/g,\n    AE: /[\\u00C6]/g,\n    E: /[\\u0045\\u24BA\\uFF25\\u00C8\\u00C9\\u00CA\\u1EC0\\u1EBE\\u1EC4\\u1EC2\\u1EBC\\u0112\\u1E14\\u1E16\\u0114\\u0116\\u00CB\\u1EBA\\u011A\\u0204\\u0206\\u1EB8\\u1EC6\\u0228\\u1E1C\\u0118\\u1E18\\u1E1A\\u0190\\u018E]/g,\n    I: /[\\u0049\\u24BE\\uFF29\\u00CC\\u00CD\\u00CE\\u0128\\u012A\\u012C\\u0130\\u00CF\\u1E2E\\u1EC8\\u01CF\\u0208\\u020A\\u1ECA\\u012E\\u1E2C\\u0197]/g,\n    O: /[\\u004F\\u24C4\\uFF2F\\u00D2\\u00D3\\u00D4\\u1ED2\\u1ED0\\u1ED6\\u1ED4\\u00D5\\u1E4C\\u022C\\u1E4E\\u014C\\u1E50\\u1E52\\u014E\\u022E\\u0230\\u00D6\\u022A\\u1ECE\\u0150\\u01D1\\u020C\\u020E\\u01A0\\u1EDC\\u1EDA\\u1EE0\\u1EDE\\u1EE2\\u1ECC\\u1ED8\\u01EA\\u01EC\\u00D8\\u01FE\\u0186\\u019F\\uA74A\\uA74C]/g,\n    OE: /[\\u0152]/g,\n    U: /[\\u0055\\u24CA\\uFF35\\u00D9\\u00DA\\u00DB\\u0168\\u1E78\\u016A\\u1E7A\\u016C\\u00DC\\u01DB\\u01D7\\u01D5\\u01D9\\u1EE6\\u016E\\u0170\\u01D3\\u0214\\u0216\\u01AF\\u1EEA\\u1EE8\\u1EEE\\u1EEC\\u1EF0\\u1EE4\\u1E72\\u0172\\u1E76\\u1E74\\u0244]/g,\n    a: /[\\u0061\\u24D0\\uFF41\\u1E9A\\u00E0\\u00E1\\u00E2\\u1EA7\\u1EA5\\u1EAB\\u1EA9\\u00E3\\u0101\\u0103\\u1EB1\\u1EAF\\u1EB5\\u1EB3\\u0227\\u01E1\\u00E4\\u01DF\\u1EA3\\u00E5\\u01FB\\u01CE\\u0201\\u0203\\u1EA1\\u1EAD\\u1EB7\\u1E01\\u0105\\u2C65\\u0250]/g,\n    ae: /[\\u00E6\\u01FD\\u01E3]/g,\n    c: /[\\u0063\\u24D2\\uFF43\\u0107\\u0109\\u010B\\u010D\\u00E7\\u1E09\\u0188\\u023C\\uA73F\\u2184]/g,\n    e: /[\\u0065\\u24D4\\uFF45\\u00E8\\u00E9\\u00EA\\u1EC1\\u1EBF\\u1EC5\\u1EC3\\u1EBD\\u0113\\u1E15\\u1E17\\u0115\\u0117\\u00EB\\u1EBB\\u011B\\u0205\\u0207\\u1EB9\\u1EC7\\u0229\\u1E1D\\u0119\\u1E19\\u1E1B\\u0247\\u025B\\u01DD]/g,\n    i: /[\\u0069\\u24D8\\uFF49\\u00EC\\u00ED\\u00EE\\u0129\\u012B\\u012D\\u00EF\\u1E2F\\u1EC9\\u01D0\\u0209\\u020B\\u1ECB\\u012F\\u1E2D\\u0268\\u0131]/g,\n    o: /[\\u006F\\u24DE\\uFF4F\\u00F2\\u00F3\\u00F4\\u1ED3\\u1ED1\\u1ED7\\u1ED5\\u00F5\\u1E4D\\u022D\\u1E4F\\u014D\\u1E51\\u1E53\\u014F\\u022F\\u0231\\u00F6\\u022B\\u1ECF\\u0151\\u01D2\\u020D\\u020F\\u01A1\\u1EDD\\u1EDB\\u1EE1\\u1EDF\\u1EE3\\u1ECD\\u1ED9\\u01EB\\u01ED\\u00F8\\u01FF\\u0254\\uA74B\\uA74D\\u0275]/g,\n    oe: /[\\u0153]/g,\n    u: /[\\u0075\\u24E4\\uFF55\\u00F9\\u00FA\\u00FB\\u0169\\u1E79\\u016B\\u1E7B\\u016D\\u00FC\\u01DC\\u01D8\\u01D6\\u01DA\\u1EE7\\u016F\\u0171\\u01D4\\u0215\\u0217\\u01B0\\u1EEB\\u1EE9\\u1EEF\\u1EED\\u1EF1\\u1EE5\\u1E73\\u0173\\u1E77\\u1E75\\u0289]/g\n  };\n\n\nlet numberOfImagesPerLayerExport = 2; // 2 => (original size, @2x), 4 => (original size, @2x, @3x, @4x)\n\nlet maximumImageWidthOrHeight = 16384;\n\nlet GLOBALNAMESINDEX_UNIQUENAME = 0;\nlet GLOBALNAMESINDEX_TYPE = 1;\nlet GLOBALNAMESINDEX_KEYVALUES = 2;\nlet GLOBALNAMESINDEX_RAWNAME = 3;\nlet GLOBALNAMESINDEX_PARENTTYPE = 4;\n\nlet TEMP_CONTEXT = {};\n\n\nlet POINT_DECIMAL_PRECISION = 5; // Number of decimals to export abscissa and ordinate of points\nlet ANGLE_DECIMAL_PRECISION = 3; \n\n\nfunction getUniqueNameFromIndexedData(data) {\n    return data[GLOBALNAMESINDEX_UNIQUENAME];\n}\n\n\nfunction getTypeFromIndexedData(data) {\n    return data[GLOBALNAMESINDEX_TYPE];\n}\n\n\nfunction getKeyValuesFromIndexedData(data) {\n    return data[GLOBALNAMESINDEX_KEYVALUES];\n}\n\n\nfunction getRawNameFromIndexedData(data) {\n    return data[GLOBALNAMESINDEX_RAWNAME];\n}\n\n\nfunction getParentTypeFromIndexedData(data) {\n    return data[GLOBALNAMESINDEX_PARENTTYPE];\n}\n\n\nfunction clearTempContext() {\n    TEMP_CONTEXT = {\n        availableSwatchIDs: [],\n        missingSwatches: {}\n    };\n}\n\n\nfunction initDocumentContext() {\n    clearTempContext();\n\n    let documentContext = {\n        fontFiles: [],\n        sharedLayerStylesIndex: {},\n        sharedTextStylesIndex: {},\n        globalNamesIndex: {},\n        textsWithOutOfSyncStyle: {}\n    };\n\n    let sketch = require('sketch/dom');\n    let document = sketch.getSelectedDocument();\n\n    document.sharedLayerStyles.forEach(style => {\n        documentContext.sharedLayerStylesIndex[style.id] = style;\n    });\n\n    document.sharedTextStyles.forEach(style => {\n        documentContext.sharedTextStylesIndex[style.id] = style;\n    });\n\n    treePopulateGlobalNamesIndex(documentContext);\n    let nb = Object.keys(documentContext.globalNamesIndex).length;\n    log(\"Indexed elements : \" + nb);\n\n    let usedNativeSwatches = document.sketchObject.documentData().allSwatches();\n    if (usedNativeSwatches.length > 0) {\n        usedNativeSwatches.forEach(nativeSwatch => {\n            TEMP_CONTEXT.availableSwatchIDs.push(String(nativeSwatch.objectID()));\n        });\n    }\n\n    return documentContext;\n}\n\n\nfunction addFontFileToContext(context, fontFilePath) {\n    if (context && context.fontFiles && fontFilePath && !context.fontFiles.includes(fontFilePath))\n        context.fontFiles.push(fontFilePath);\n}\n\n\nfunction getFontFilesUsedByLayer(layer, result) {\n    if (layer) {\n        let fontFilePath = layerFontFilePath(layer);\n        if (fontFilePath && !result.includes(fontFilePath)) {\n            result.push(fontFilePath);\n        }\n\n        if (layer.layers && (layer.layers.length > 0)) {\n            layer.layers.forEach(subLayer => {\n                getFontFilesUsedByLayer(subLayer, result);\n            });\n        }\n    }\n}\n\n\nfunction addSymbolMasterOverridesToXml(symbolMaster, xmlRoot, documentContext){\n    if (symbolMaster.overrides){\n        let Xml = require(\"./xml.js\");\n        symbolMaster.overrides.forEach(overR => {\n            // NB: Since october 2022, Sketch allows to override font properties (weight, alignment, etc.) and colors\n            //     within Symbol instances without creating a text style or layer style for each variation\n            //     This plugin only supports the old overridable properties\n            if (overR.editable\n                && ((overR.property == \"image\") || (overR.property == \"textStyle\") || (overR.property == \"stringValue\") \n                    || (overR.property == \"layerStyle\") || (overR.property == \"symbolID\"))\n                ) {\n                let overrideTargetPath = treeBuildOverrideTargetPath(overR, documentContext.globalNamesIndex)\n                Xml.xmlAddElement(xmlRoot, \"overridable\", [\"property\", overR.property, \"on\", overrideTargetPath], null);\n            }\n        });\n    }\n}\n\n\nfunction treeIterateLayers(layers, parent, shallIgnoreSymbolMasters, rootDirPath, imagesSubDir, xmlRoot,\n                            documentContext, mask){\n    let Xml = require(\"./xml.js\");\n    let sketch = require('sketch/dom');\n    let document = sketch.getSelectedDocument();\n    let actualParent = parent; //parent may change during iteration (when finding masks)\n    let currentMask = null;\n    \n    for (let i = 0; layers && (i < layers.length); i++){\n        let l = layers[i]\n        let type = l.sketchObject.class()\n        let name = l.name;\n\n        // We skip special elements\n        if (name.startsWith(\"#\"))\n            continue\n\n        if ((type == \"MSSymbolMaster\") && shallIgnoreSymbolMasters){\n            continue;\n        } else if ((type == \"MSArtboardGroup\") || (type == \"MSSliceLayer\") || (type == \"MSHotspotLayer\")) {\n            continue;\n        } \n        \n        let indexedData = documentContext.globalNamesIndex[l.id];\n        if (!indexedData){\n            log(\"ERROR: could not find indexed data for \" + l.name + \" (\" + l.id + \") : ignore this element.\");\n            continue;\n        }\n        let actualName = getUniqueNameFromIndexedData(indexedData);\n        let actualType = getTypeFromIndexedData(indexedData);\n        let keyValues = getKeyValuesFromIndexedData(indexedData);\n\n        let isCustomClass = false;\n        \n        //handle special types that will add specific beacons in XML or require specific logics\n        if (actualType == \"includeLibrary\"){\n            let rawName = getRawNameFromIndexedData(indexedData);\n            let xmlCurrent = Xml.xmlAddElement(actualParent, \"include\", [\"name\", rawName], null);\n            if (keyValues.length > 0)\n                addCustomPropertiesToXml(xmlCurrent, keyValues);\n\n        } else if (actualType == \"includeExternal\") {\n            let xmlCurrent = Xml.xmlAddElement(actualParent, \"external\", [\"name\", actualName], null);\n            if (keyValues.length > 0)\n                addCustomPropertiesToXml(xmlCurrent, keyValues);\n            \n        } else if ((type == \"MSTextLayer\") && (actualType == \"includeData\")) {\n            let xmlCurrent = Xml.xmlAddElement(actualParent, \"data\", [\"name\", actualName], l.text);\n            if (keyValues.length > 0)\n                addCustomPropertiesToXml(xmlCurrent, keyValues);\n                \n        } else {\n            //FIXME: using internal Sketch API that might change in future versions\n            if (l._object.shouldBreakMaskChain()){\n                actualParent = parent; //restore original parent because we break mask chain with this element\n                currentMask = null;\n            }\n            \n            let xmlCurrent = Xml.xmlAddElement(actualParent, \"item\", [\"name\", actualName], null);\n\n            addFontFileToContext(documentContext, layerFontFilePath(l));\n            \n            if (type == \"MSSymbolInstance\") {\n                if (!l.master) {\n                    log(\"could not find the symbol master used by \" + l.name);\n                    log(\"\\t->Please check that it does not use an external symbol master that has not been made local.\")\n                    continue;\n                }\n\n                //Instance is from a specific class and will be handled as a future software component instance\n                let indexedDataSymbolMaster = documentContext.globalNamesIndex[l.master.id];\n                if (!indexedDataSymbolMaster) {\n                    log(\"could not find indexed data for \" + l.master.name);\n                    log(\"\\t->Please check that it is not an external symbol master that has not been made local.\")\n                    continue;\n                }\n                \n                actualType = getTypeFromIndexedData(indexedDataSymbolMaster); //get resolved type from master symbol\n                isCustomClass = true;\n                type = actualType; //this will relevantly block iteration on subelements at the end of this function\n                \n                //Symbol instances require specific management around overrides\n                //Overrides are stored \"as-is\" to be applied as property values during code generation.\n                if (l.overrides) {\n                    const sketchVersion = require('sketch/dom').version.sketch;\n                    let nb = l.overrides.length;\n                    let symbolOverridesHash = {};\n\n                    for (let j = 0; j < nb; j++) {\n                        let overR = l.overrides[j];\n                        let isEditable = overR.editable;\n                        let isDefault = overR.isDefault;\n\n                        // NB: Since october 2022, Sketch allows to override font properties (weight, alignment, etc.) and colors\n                        //     within Symbol instances without creating a text style or layer style for each variation\n                        //     This plugin only supports the old overridable properties\n                        if ((overR.property == \"image\") || (overR.property == \"textStyle\") || (overR.property == \"stringValue\") \n                            || (overR.property == \"layerStyle\") || (overR.property == \"symbolID\")) {\n                            let indexedDataOverride = documentContext.globalNamesIndex[overR.affectedLayer.id];\n                            let originalOverrideTargetPath = treeBuildOverrideTargetPath(overR, documentContext.globalNamesIndex);\n                            let overrideTargetPath = originalOverrideTargetPath;\n                            if (!indexedDataOverride){\n                                log(\"ERROR: could not find indexed data for \" + overR.affectedLayer.name + \" (\" + overR.affectedLayer.id + \"). Please check that this element is not rendered as an image.\");\n                                continue;\n                            }\n                            //log(\"handling override for \" + overR.affectedLayer.id + \" - \" + overR.affectedLayer.name + \" - \" +  + \" (\" + indexedDataOverride + \")\");\n\n                            // NB: Sketch 96 uses a new API: MSOverridePoint instead of MSAvailableOverride\n                            if (sketchVersion < 96) {\n                                // isDefault flag: handle false positive i.e. overrides that use the default value even if isDefault returns false\n                                // => it happens when:\n                                //  - a symbol overrides a text and this symbol is instantiated in other symbols\n                                //  - a graphic designer changes the style of an instance and then reselect the default style\n                                if (overR.sketchObject && (!overR.sketchObject.overrideValue() || (overR.sketchObject.defaultValue() == overR.sketchObject.currentValue()))) {\n                                    isDefault = true;\n                                }\n                            }\n\n                            //handle possible nesting of overrides\n                            let overrideParent = xmlCurrent; //set default parent for override data (may change with symbol overrides)\n\n                            let prefix = overrideTargetPath;\n                            let dotIndex = overrideTargetPath.lastIndexOf(\".\");\n                            while (dotIndex >= 0) {\n                                prefix = prefix.substring(0, dotIndex);\n                                //log(\"check prefix \" + prefix + \" for \" + overrideTargetPath);\n                                if ((prefix.length > 0) & symbolOverridesHash.hasOwnProperty(prefix)) {\n                                    //log(\"found prefix \" + prefix + \" for \" + overrideTargetPath);\n                                    overrideParent = symbolOverridesHash[prefix];\n                                    overrideTargetPath = overrideTargetPath.substring(dotIndex + 1, overrideTargetPath.length);\n                                    break;\n                                } else {\n                                    dotIndex = prefix.lastIndexOf(\".\");\n                                }\n                            }\n                            \n                            if (overR.property == \"image\") {\n                                //we generate image file from data\n                                let imgData = overR.value.nsdata;\n                                let imgName = NSString.stringWithFormat(\"%@.png\", overR.id.replace(/\\//g, \"_\"));\n                                let imgRelativePath = NSString.stringWithFormat(\"%@%@\", imagesSubDir, imgName);\n                                imgData.writeToFile_atomically(NSString.stringWithFormat(\"%@/%@\", rootDirPath, imgRelativePath), false);\n                                Xml.xmlAddElement(overrideParent, \"override\", [\"property\", overR.property, \"value\", imgRelativePath, \"on\", overrideTargetPath, \"editable\", isEditable, \"isDefault\", isDefault], null);\n                            } else if (overR.property == \"textStyle\") {\n                                let currentOver =Xml.xmlAddElement(overrideParent, \"override\", [\"property\", overR.property, \"value\", overR.value, \"on\", overrideTargetPath, \"editable\", isEditable, \"isDefault\", isDefault], null);\n                                if (documentContext.sharedTextStylesIndex[overR.value]) {\n                                    let affectedLayerUsesAnOutOfSyncStyle = documentContext.textsWithOutOfSyncStyle.hasOwnProperty(overR.affectedLayer.id);\n                                    let overrideStyle = documentContext.sharedTextStylesIndex[overR.value].style;\n\n                                    if (affectedLayerUsesAnOutOfSyncStyle) {\n                                       Xml.xmlAddElement(currentOver, \"textStyle\", [\"sharedStyleId\", overR.value, \"affectedLayerStyleIsOutOfSync\", true], null);\n                                    } else {\n                                       Xml.xmlAddElement(currentOver, \"textStyle\", [\"sharedStyleId\", overR.value], null);\n                                    }\n\n                                    addFontFileToContext(documentContext, styleFontFilePath(overrideStyle));\n                                } else {\n                                    log(\"could not find textStyle\" + overR.value + \" to override a symbol instance of \"\n                                        + l.name + \". This override will be ignored\");\n                                    log(\"\\t->Please check that it is not an external text style that has not been made local.\")\n                                    continue;\n                                }\n                            } else if (overR.property == \"layerStyle\") {\n                                let currentOver =Xml.xmlAddElement(overrideParent, \"override\", [\"property\", overR.property, \"value\", overR.value, \"on\", overrideTargetPath, \"editable\", isEditable, \"isDefault\", isDefault], null);\n                                if (documentContext.sharedLayerStylesIndex[overR.value]) {\n                                    let styleXML =Xml.xmlAddElement(currentOver, \"layerStyle\", null, null);\n                                    treeAddAttributesFromLayerStyle(styleXML, type, documentContext.sharedLayerStylesIndex[overR.value].style);\n                                } else {\n                                    log(\"could not find layerStyle\" + overR.value + \" to override a symbol instance of \"\n                                        + l.name + \". This override will be ignored\");\n                                    log(\"\\t->Please check that it is not an external layer style that has not been made local.\")\n                                    continue;\n                                }\n                            } else if (overR.property == \"stringValue\") {\n                               Xml.xmlAddElement(overrideParent, \"override\", [\"property\", overR.property, \"value\", overR.value, \"on\", overrideTargetPath, \"editable\", isEditable, \"isDefault\", isDefault], null);\n                            } else if (overR.property == \"symbolID\") {\n                                let indexexDataOldSymbol = documentContext.globalNamesIndex[overR.affectedLayer.master.id];\n                                if (!indexexDataOldSymbol){\n                                    log(\"could not find indexed data for SymbolMaster \" + overR.affectedLayer.master.name + \" to override a symbol instance of \"\n                                        + l.name + \". This override will be ignored\");\n                                    log(\"\\t->Please check that it is not an external master that has not been made local.\")\n                                    continue;\n                                }\n                                \n                                let oldType = getTypeFromIndexedData(indexexDataOldSymbol);\n                                let newType = \"\"; //may be empty id \"no symbol\" override\n                                if (overR.value.length > 0) {\n                                    let newSymbol = document.getSymbolMasterWithID(overR.value);\n                                    if (newSymbol) {\n                                        let indexedDataNewSymbol = documentContext.globalNamesIndex[newSymbol.id];\n                                        if (!indexedDataNewSymbol){\n                                            log(\"could not find indexed data for SymbolMaster \" + newSymbol.name + \" to override a symbol instance of \"\n                                                + l.name + \". This override will be ignored\");\n                                            log(\"\\t->Please check that it is not an external master that has not been made local.\")\n                                            break;\n                                        }\n                                        newType = getTypeFromIndexedData(indexedDataNewSymbol); //symbol extracted class\n                                    } else {\n                                        log(\"could not find SymbolMaster with ID \" + overR.value + \" to override a symbol instance of \"\n                                        + l.name + \". This override will be ignored\");\n                                        log(\"\\t->Please check that it is not an external master that has not been made local.\")\n                                        break;\n                                    }\n                                }\n\n                                let xmlSymbolOverride = Xml.xmlAddElement(overrideParent, \"override\", [\"property\", overR.property, \"newType\", newType, \"oldType\", oldType, \"on\", overrideTargetPath, \"editable\", isEditable, \"isDefault\", isDefault], null);\n                                if (!isDefault)\n                                    symbolOverridesHash[originalOverrideTargetPath] = xmlSymbolOverride;\n                            }\n                        }\n                    }\n                }\n                Xml.xmlAddAttributesToElement(xmlCurrent, [\"symbolMaster\", getUniqueNameFromIndexedData(indexedDataSymbolMaster), \"type\", actualType]);\n                \n                let parentType = getParentTypeFromIndexedData(indexedDataSymbolMaster);\n                if (parentType)\n                    Xml.xmlAddAttributesToElement(xmlCurrent, [\"symbolMasterParentType\", parentType]);\n                \n            } else {\n                //other types are handled without anything specific\n                Xml.xmlAddAttributesToElement(xmlCurrent, [\"type\", actualType]);\n                //NB: overrides are applied if necessary when calling treeAddAttributesFromLayerData & co. below.\n                //We do not apply overrides on the model directly as it would modify\n                //the original Sketch file...\n            }\n            \n            //Masks\n            //FIXME: using internal Sketch API that might change in future versions\n            if (l._object.hasClippingMask()) {\n                //log(\"\" + actualName + \" is a mask\");\n                Xml.xmlAddAttributesToElement(xmlCurrent, [\"isMask\", 1]);\n                actualParent = xmlCurrent;\n                currentMask = l;\n            }\n            \n            //Add custom keys and values extracted from layer name\n            if (keyValues.length > 0)\n                addCustomPropertiesToXml(xmlCurrent, keyValues);\n            \n            //add layer data\n            //FIXME: compute x/y/width/height changes due to masks and mask chains breaks reparenting\n            //FIXME: also handle proper size for clipped images\n            let shallBlockBecauseExportExists = treeAddAttributesFromLayerData(actualName, xmlCurrent, type, l, rootDirPath, imagesSubDir, isCustomClass, currentMask, actualType);\n\n            if (!shallBlockBecauseExportExists && l && (type == \"MSArtboardGroup\" || type == \"MSLayerGroup\" || type == \"MSShapeGroup\"\n                      || type == \"MSSymbolMaster\" || type == \"MSSymbolInstance\")){\n                treeIterateLayers(l.layers, xmlCurrent, shallIgnoreSymbolMasters, rootDirPath, imagesSubDir, xmlRoot, documentContext, currentMask);\n            }\n        }\n    }\n}\n\n\nfunction treeAddAttributesFromPointData(currentXMLElement, point){\n    if (point && point.sketchObject) {\n        let Xml = require(\"./xml.js\");\n        let Utils = require(\"./utils.js\");\n        \n        let pointType = point.pointType;\n\n        let pointAttributes = [];\n        pointAttributes.push(\"pointType\");\n        pointAttributes.push(point.pointType);\n        pointAttributes.push(\"x\");\n        pointAttributes.push(Utils.roundWithDecimalPrecision(point.point.x, POINT_DECIMAL_PRECISION));\n        pointAttributes.push(\"y\");\n        pointAttributes.push(Utils.roundWithDecimalPrecision(point.point.y, POINT_DECIMAL_PRECISION));\n\n        if (pointType == 'Straight') {\n            pointAttributes.push(\"cornerRadius\");\n            pointAttributes.push(point.cornerRadius);\n\n        } else if (pointType == 'Undefined') {\n            //TODO: check if we can really obtain a point with an undefined type\n            let nativePoint = point.sketchObject;\n\n            if (nativePoint.hasCurveFrom()) {\n                pointAttributes.push(\"curveFromX\");\n                pointAttributes.push(Utils.roundWithDecimalPrecision(point.curveFrom.x, POINT_DECIMAL_PRECISION));\n                pointAttributes.push(\"curveFromY\");\n                pointAttributes.push(Utils.roundWithDecimalPrecision(point.curveFrom.y, POINT_DECIMAL_PRECISION));\n            }\n\n            if (nativePoint.hasCurveTo()) {\n                pointAttributes.push(\"curveToX\");\n                pointAttributes.push(Utils.roundWithDecimalPrecision(point.curveTo.x, POINT_DECIMAL_PRECISION));\n                pointAttributes.push(\"curveToY\");\n                pointAttributes.push(Utils.roundWithDecimalPrecision(point.curveTo.y, POINT_DECIMAL_PRECISION));\n            }\n            \n            pointAttributes.push(\"cornerRadius\");\n            pointAttributes.push(point.cornerRadius);\n\n        } else if (pointType != 'Undefined') {\n            pointAttributes.push(\"curveFromX\");\n            pointAttributes.push(Utils.roundWithDecimalPrecision(point.curveFrom.x, POINT_DECIMAL_PRECISION));\n            pointAttributes.push(\"curveFromY\");\n            pointAttributes.push(Utils.roundWithDecimalPrecision(point.curveFrom.y, POINT_DECIMAL_PRECISION));\n            pointAttributes.push(\"curveToX\");\n            pointAttributes.push(Utils.roundWithDecimalPrecision(point.curveTo.x, POINT_DECIMAL_PRECISION));\n            pointAttributes.push(\"curveToY\");\n            pointAttributes.push(Utils.roundWithDecimalPrecision(point.curveTo.y, POINT_DECIMAL_PRECISION));\n        }\n\n       Xml.xmlAddElement(currentXMLElement, \"point\", pointAttributes, null);\n\n    }  else console.warn(\"treeAddAttributesFromPointData: invalid argument 'point'\");\n}\n\n\nfunction treeAddTextBehaviour(currentXMLElement, layer) {\n    if (!isTextLayer(layer))\n        return;\n\n    let Xml = require(\"./xml.js\");\n    Xml.xmlAddAttributesToElement(currentXMLElement, [\"textBehaviour\", layerTextBehaviour(layer)]);\n}\n\n\nfunction treeAddAttributesFromTextStyle(currentXMLElement, layerOrSharedTextStyle, sharedTextStyle) {\n    let Xml = require(\"./xml.js\");\n\n    if (!layerOrSharedTextStyle)\n        return;\n\n    let isText = isTextLayer(layerOrSharedTextStyle);\n    let style = layerOrSharedTextStyle.style;\n    let sharedStyle = (sharedTextStyle ? sharedTextStyle.style : null); \n    if (!style)\n        return;\n\n    let attributes = [];\n\n    if (!sharedStyle || (style.opacity !== sharedStyle.opacity)) {\n        attributes.push(\"opacity\");\n        attributes.push(style.opacity);\n    }\n\n    if (!sharedStyle || (style.blendingMode !== sharedStyle.blendingMode)) {\n        attributes.push(\"blendingMode\");\n        attributes.push(style.blendingMode);\n    }\n\n    let textBehaviour = \"autoWidth\";\n    if (isText) {\n        textBehaviour = layerTextBehaviour(layerOrSharedTextStyle);\n\n        attributes.push(\"textBehaviour\");\n        attributes.push(textBehaviour);\n    }\n\n    if (!sharedStyle || (style.alignment != sharedStyle.alignment)) {\n        attributes.push(\"alignment\");\n        attributes.push(style.alignment);\n    }\n    \n    // Special case: Sketch does not reset the value of verticalAlignment when we switch from \"fixedSize\" to \"autoWidth\" or \"autoHeight\"\n    let verticalAlignment = (!isText || (textBehaviour === \"fixedSize\")) ? style.verticalAlignment : \"top\";\n    if (!sharedStyle || (verticalAlignment != sharedStyle.verticalAlignment)) {\n        attributes.push(\"verticalAlignment\");\n        attributes.push(verticalAlignment);\n    }\n\n    if (!sharedStyle || (style.textColor != sharedStyle.textColor)) {\n        attributes.push(\"textColor\");\n        attributes.push(getTextColorAsHexValueOrSwatchReference(style));\n    }\n\n    if (!sharedStyle || (style.lineHeight != sharedStyle.lineHeight)) {\n        if (style.lineHeight) {\n            attributes.push(\"lineHeight\");\n            attributes.push(style.lineHeight);\n        }\n    }\n\n    if (!sharedStyle || (style.paragraphSpacing != sharedStyle.paragraphSpacing)) {\n        attributes.push(\"paragraphSpacing\");\n        attributes.push(style.paragraphSpacing);\n    }\n\n    // The following properties define our font\n    let needFontFamily = (!sharedStyle || (style.fontFamily != sharedStyle.fontFamily));\n    let needFontSize = (!sharedStyle || (style.fontSize != sharedStyle.fontSize));\n    let needFontWeight = (!sharedStyle || (style.fontWeight != sharedStyle.fontWeight));\n    let needFontStyle = (!sharedStyle || (style.fontStyle != sharedStyle.fontStyle));\n    let needFontVariant = (!sharedStyle || (style.fontVariant != sharedStyle.fontVariant));\n    let needFontStretch = (!sharedStyle || (style.fontStretch != sharedStyle.fontStretch));\n    let needKerning = (!sharedStyle || (style.kerning != sharedStyle.kerning));\n    let needTextTransform = (!sharedStyle || (style.textTransform != sharedStyle.textTransform));\n    let needTextUnderline = (!sharedStyle || (style.textUnderline != sharedStyle.textUnderline));\n    let needTextStrikethrough = (!sharedStyle || (style.textStrikethrough != sharedStyle.textStrikethrough));\n\n    if (needFontFamily || needFontSize || needFontWeight || needFontStyle || needFontVariant\n        || needFontStretch || needKerning || needTextTransform || needTextUnderline || needTextStrikethrough) {\n        attributes.push(\"fontFamily\");\n        attributes.push(style.fontFamily);\n\n        attributes.push(\"fontSize\");\n        attributes.push(style.fontSize);\n\n        attributes.push(\"fontWeight\");\n        attributes.push(style.fontWeight);\n\n        if (style.fontStyle) {\n            attributes.push(\"fontStyle\");\n            attributes.push(style.fontStyle);\n        }\n\n        if (style.fontVariant) {\n            attributes.push(\"fontVariant\");\n            attributes.push(style.fontVariant);\n        }\n\n        if (style.fontStretch) {\n            attributes.push(\"fontStretch\");\n            attributes.push(style.fontStretch);\n        }\n\n         // NB: we also need to export raw properties to help translation from Sketch to UI toolkits\n        attributes.push(\"fontPostscriptName\");\n        attributes.push(fontPostscriptNameFromStyle(style));\n        attributes.push(\"fontStyleName\");\n        attributes.push(fontStyleNameFromStyle(style));\n\n        if (style.kerning) {\n            attributes.push(\"kerning\");\n            attributes.push(style.kerning);\n        }\n\n        attributes.push(\"textTransform\");\n        attributes.push(style.textTransform);\n\n        if (style.textUnderline) {\n            attributes.push(\"textUnderline\");\n            attributes.push(style.textUnderline);\n        }\n\n        if (style.textStrikethrough) {\n            attributes.push(\"textStrikethrough\");\n            attributes.push(style.textStrikethrough);\n        }\n    }\n\n    Xml.xmlAddAttributesToElement(currentXMLElement, attributes);\n}\n\n\nfunction treeAddAttributesFromLayerStyle(currentXMLElement, type, style) {\n    if (!style)\n        return;\n\n    let Xml = require(\"./xml.js\");\n    let attributes = [];\n\n    attributes.push(\"opacity\");\n    attributes.push(style.opacity);\n    \n    attributes.push(\"blendingMode\");\n    attributes.push(style.blendingMode);\n\n    //TODO: blur, shadows, innershadows\n    \n    if (style.borderOptions) {\n        if (style.borderOptions.startArrowhead != 'None') {\n            attributes.push(\"startArrowhead\");\n            attributes.push(style.borderOptions.startArrowhead);\n        }\n        if (style.borderOptions.endArrowhead != 'None') {\n            attributes.push(\"endArrowhead\");\n            attributes.push(style.borderOptions.endArrowhead);\n        }\n        let dashPatternLength = style.borderOptions.dashPattern.length;\n        if (dashPatternLength != 0) {\n            attributes.push(\"dashPattern\");\n            let dashPatternString = style.borderOptions.dashPattern.join(',');\n            if (dashPatternLength % 2 == 0) {\n                attributes.push(dashPatternString);\n            } else {\n                //NB: In most UI toolkits, the dash pattern must be specified as an even \n                // number of values that specify the lengths of alternating dashes and gaps\n                attributes.push(dashPatternString + \",\" + dashPatternString);\n            }\n        }\n        if (style.borderOptions.lineEnd != 'Butt') {\n            attributes.push(\"lineEnd\");\n            attributes.push(style.borderOptions.lineEnd);\n        }\n        if (style.borderOptions.lineJoin != 'Miter') {\n            attributes.push(\"lineJoin\");\n            attributes.push(style.borderOptions.lineJoin);\n        }\n    }\n\n    if (style.fills.length > 0) {\n        style.fills.forEach(fill => {\n            let xmlFill =Xml.xmlAddElement(currentXMLElement, \"fill\", null, null);\n            let fillAttributes = [];\n            let fillType = fill.fillType;\n            fillAttributes.push(\"fillType\");\n            fillAttributes.push(fillType);\n            fillAttributes.push(\"enabled\");\n            fillAttributes.push(fill.enabled);\n\n            if (fillType == \"Color\") {\n                fillAttributes.push(\"color\");\n                fillAttributes.push(getFillColorAsHexValueOrSwatchReference(fill));\n\n            } else if (fillType == \"Gradient\") {\n                let gradient = fill.gradient;\n                let gradientType = gradient.gradientType;\n                fillAttributes.push(\"gradientType\");\n                fillAttributes.push(gradientType);\n                fillAttributes.push(\"fromX\");\n                fillAttributes.push(gradient.from.x);\n                fillAttributes.push(\"fromY\");\n                fillAttributes.push(gradient.from.y);\n                fillAttributes.push(\"toX\");\n                fillAttributes.push(gradient.to.x);\n                fillAttributes.push(\"toY\");\n                fillAttributes.push(gradient.to.y);\n\n                if (gradientType == \"Radial\") {\n                    fillAttributes.push(\"aspectRatio\");\n                    fillAttributes.push(gradientType.aspectRatio);\n                }\n\n                gradient.stops.forEach(stop => {\n                    let stopAttributes = [];\n                    stopAttributes.push(\"position\");\n                    stopAttributes.push(stop.position);\n                    stopAttributes.push(\"color\");\n                    stopAttributes.push(rgbaToArgbOrRgb(stop.color));\n                    \n                   Xml.xmlAddElement(xmlFill, \"stop\", stopAttributes, null);\n                });\n\n            } else if (fillType == \"Pattern\") {\n                fillAttributes.push(\"patternType\");\n                fillAttributes.push(fill.pattern.patternType);\n                fillAttributes.push(\"tileScale\");\n                fillAttributes.push(fill.pattern.tileScale);\n                //TODO: image\n            }\n\n            Xml.xmlAddAttributesToElement(xmlFill, fillAttributes);     \n        });\n    }\n   \n    if (style.borders.length > 0) {\n        style.borders.forEach(border => {\n            let xmlBorder =Xml.xmlAddElement(currentXMLElement, \"border\", null, null);\n            let borderAttributes = [];\n            let fillType = border.fillType;\n            borderAttributes.push(\"fillType\");\n            borderAttributes.push(fillType);\n            borderAttributes.push(\"thickness\");\n            borderAttributes.push(border.thickness);\n            borderAttributes.push(\"position\");\n            borderAttributes.push(border.position);\n            borderAttributes.push(\"enabled\");\n            borderAttributes.push(border.enabled);\n\n            if (fillType == \"Color\") {\n                borderAttributes.push(\"color\");\n                borderAttributes.push(getFillColorAsHexValueOrSwatchReference(border));\n\n            } else if (fillType == \"Gradient\") {\n                let gradient = border.gradient;\n                let gradientType = gradient.gradientType;\n                borderAttributes.push(\"gradientType\");\n                borderAttributes.push(gradientType);\n                borderAttributes.push(\"fromX\");\n                borderAttributes.push(gradient.from.x);\n                borderAttributes.push(\"fromY\");\n                borderAttributes.push(gradient.from.y);\n                borderAttributes.push(\"toX\");\n                borderAttributes.push(gradient.to.x);\n                borderAttributes.push(\"toY\");\n                borderAttributes.push(gradient.to.y);\n\n                if (gradientType == \"Radial\") {\n                    borderAttributes.push(\"aspectRatio\");\n                    borderAttributes.push(gradientType.aspectRatio);\n                }\n\n                gradient.stops.forEach(stop => {\n                    let stopAttributes = [];\n                    stopAttributes.push(\"position\");\n                    stopAttributes.push(stop.position);\n                    stopAttributes.push(\"color\");\n                    stopAttributes.push(rgbaToArgbOrRgb(stop.color));\n                    \n                   Xml.xmlAddElement(xmlBorder, \"stop\", stopAttributes, null);\n                });\n            }\n\n            Xml.xmlAddAttributesToElement(xmlBorder, borderAttributes);\n        });\n    }\n\n    Xml.xmlAddAttributesToElement(currentXMLElement, attributes);\n}\n\n\nfunction treeAddAttributesFromLayerData(name, currentXMLElement, type, layer, rootDirPath, imagesSubDir,\n                                        isCustomClass, currentMask, actualType){\n    /*\n    return true if item shall stop iteration, generally because it is renderer as an image or has exports\n    return false if item allows iterations\n    */\n    let Xml = require(\"./xml.js\");\n    let Utils = require(\"./utils.js\");\n    let attributes = [];\n    \n    attributes.push(\"id\");\n    attributes.push(layer.id);\n    \n    //generic attributes\n    if (layer.locked){\n        attributes.push(\"locked\");\n        attributes.push(\"1\");\n    }\n    if (layer.hidden){\n        attributes.push(\"hidden\");\n        attributes.push(\"1\");\n    }\n    if (layer.transform){\n        //NB: layer.transform.rotation wraps layer.sketchObject.userVisibleRotation() \n        //     that matches what users see in the inspector which may be different \n        //     from the raw `rotation` value\n        //     Here, we need the raw rotation because the generated code will apply a rotation\n        //\n        //NB: layer.sketchObject.userVisibleRotation and layer.sketchObject.rotation don't use the same rotation direction\n        //    layer.sketchObject.userVisibleRotation  is clockwise, layer.sketchObject.rotation is counterclockwise\n        let rotation = Utils.roundWithDecimalPrecision(-layer.sketchObject.rotation(), ANGLE_DECIMAL_PRECISION);\n\n        if (rotation !== 0) {\n            attributes.push(\"rotation\");\n            attributes.push(rotation);\n        }\n        if (layer.transform.flippedHorizontally){\n            attributes.push(\"flippedHorizontally\");\n            attributes.push(\"1\");\n        }\n        if (layer.transform.flippedVertically){\n            attributes.push(\"flippedVertically\");\n            attributes.push(\"1\");\n        }\n    }\n    if (layer.sketchObject.hasFixedWidth()){\n        attributes.push(\"hasFixedWidth\");\n        attributes.push(\"1\");\n    }\n    if (layer.sketchObject.hasFixedHeight()){\n        attributes.push(\"hasFixedHeight\");\n        attributes.push(\"1\");\n    }\n    if (layer.sketchObject.hasFixedLeft()){\n        attributes.push(\"hasFixedLeft\");\n        attributes.push(\"1\");\n        // NB: fixedLeft is x\n    }\n    if (layer.sketchObject.hasFixedTop()){\n        attributes.push(\"hasFixedTop\");\n        attributes.push(\"1\");\n        // NB: fixedTop is y\n    }\n    if (layer.sketchObject.hasFixedRight()){\n        attributes.push(\"hasFixedRight\");\n        attributes.push(\"1\");\n        attributes.push(\"fixedRight\");\n        attributes.push(layer.parent ? Utils.roundBy(layer.parent.frame.width - (layer.frame.x + layer.frame.width), 0.5) : 0);\n    }\n    if (layer.sketchObject.hasFixedBottom()){\n        attributes.push(\"hasFixedBottom\");\n        attributes.push(\"1\");\n        attributes.push(\"fixedBottom\");\n        attributes.push(layer.parent ? Utils.roundBy(layer.parent.frame.height - (layer.frame.y + layer.frame.height), 0.5) : 0);\n    }\n\n\n    if (layer.frame){\n        // NB: one decimal precision to allow sharp rendering if we use a centered border (BorderPosition = Centered) with an odd thickness value\n        //     If the thickness value is even (2, 4, etc.), x and y must be integer values; whereas if the thickness value is off (1, 3, etc.), \n        //     x and y must be decimal values ending with '.5' (half pixel offset)\n        attributes.push(\"x\");\n        attributes.push(Utils.roundBy(layer.frame.x, 0.5));\n        attributes.push(\"y\");\n        attributes.push(Utils.roundBy(layer.frame.y, 0.5));\n        attributes.push(\"width\");\n        attributes.push(Math.ceil(layer.frame.width));\n        attributes.push(\"height\");\n        attributes.push(Math.ceil(layer.frame.height));\n    }\n\n    //flows\n    if (layer.flow && layer.flow.target){\n       Xml.xmlAddElement(currentXMLElement, \"flow\",\n                      [\"targetName\", layer.flow.target.name,\n                       \"targetId\", layer.flow.targetId,\n                       \"type\", layer.flow.animationType], null);\n    }\n    \n    let renderingAsImage = false;\n    //handle unsupported types by rendering them as an image\n    //NB: supported types are at the moment : text, rectangle, image, group, window\n    //NB: groups come from MSLayerGroup and MSSymbolInstance\n    //See type conversions at the beginning of treeParseName\n    if (!isCustomClass && !isSupportedLayer(layer)){\n        //we have an unsupported type => render it as an image\n        treeForceImageExport(layer, currentXMLElement, rootDirPath, imagesSubDir, name, type);\n        renderingAsImage = true;\n    }\n    \n    //handle images with no export by manually generating image\n    if ((type == \"MSBitmapLayer\") && layer.exportFormats && (layer.exportFormats.length == 0)){\n        //we have an unsupported type => render it as an image\n        treeForceImageExport(layer, currentXMLElement, rootDirPath, imagesSubDir, name, type);\n        //log(\"force export on image \" + layer.name);\n        renderingAsImage = true;\n    }\n\n    if (renderingAsImage){\n        Xml.xmlAddAttributesToElement(currentXMLElement, attributes);\n        return true;\n    }\n    \n    //exports\n    let hasExports = false;\n    // NB: we don't want to export artboards or symbol masters as images\n    if (layer.exportFormats && (layer.exportFormats.length > 0) && canExportTypeAsImage(type)) {\n        hasExports = treeAddImageExport(name, layer, currentXMLElement, rootDirPath, imagesSubDir);\n    }\n\n    if (hasExports){\n        //this part of the tree will be rendered as an image\n        //=> add already collected elements and return now\n        Xml.xmlAddAttributesToElement(currentXMLElement, attributes);\n        //log(\"abort style inspection because layer has exports (\" + layer.name + \")\");\n        return true;\n    }\n    \n    //style\n    if (type == \"MSArtboardGroup\" || type == \"MSLayerGroup\" || type == \"MSShapeGroup\"\n        || type == \"MSOvalShape\" || type == \"MSRectangleShape\" || type == \"MSPolygonShape\" || type == \"MSStarShape\" || type == \"MSTriangleShape\"\n        || type == \"MSShapePathLayer\" || type == \"MSBitmapLayer\" || type == \"MSTextLayer\" || type == \"MSSliceLayer\"\n        || isCustomClass){\n\n        let style = layer.style;\n        if (style) {\n            if (type == \"MSTextLayer\") {\n                if (layer.sharedStyle) {\n                    attributes.push(\"useSharedStyle\");\n                    attributes.push(1);\n                    attributes.push(\"sharedStyleId\");\n                    attributes.push(layer.sharedStyleId);\n    \n                    if (layer.sketchObject.isSharedStyleOutOfSync()) {\n                        attributes.push(\"isSharedStyleOutOfSync\");\n                        attributes.push(1);\n                        treeAddAttributesFromTextStyle(currentXMLElement, layer, layer.sharedStyle);\n                    } else {\n                        // textBehaviour is not defined by shared styles\n                        treeAddTextBehaviour(currentXMLElement, layer);\n                    }\n                } \n                else {\n                    treeAddAttributesFromTextStyle(currentXMLElement, layer, null);\n                }\n            }\n            else {\n                if (layer.sharedStyle) {\n                    attributes.push(\"useSharedStyle\");\n                    attributes.push(1);\n                } \n                treeAddAttributesFromLayerStyle(currentXMLElement, type, style);\n            }\n        }\n    }\n    \n    //points\n    if (type == \"MSShapePathLayer\" || type == \"MSOvalShape\" || type == \"MSRectangleShape\" || type == \"MSPolygonShape\" || type == \"MSStarShape\" || type == \"MSTriangleShape\" || type == \"MSShapeGroup\"){\n        attributes.push(\"shapeType\");\n        attributes.push(layer.shapeType);\n        attributes.push(\"closed\");\n        if (layer.closed){\n            attributes.push(\"1\");\n        }else{\n            attributes.push(\"0\");\n        }\n        let points = layer.points;\n        if (points){\n            points.forEach(point => {\n                treeAddAttributesFromPointData(currentXMLElement, point);\n            });\n        }\n    }\n    \n    //specific attributes per type\n    if (type == \"MSTextLayer\"){\n        let text = layer.text;\n        if (text){\n           Xml.xmlAddElement(currentXMLElement, \"content\", null, escapeCharactersInUnicodePrivateUseArea(text));\n        }\n    } else if (type == \"MSArtboardGroup\"){\n        if (layer.background && layer.background.enabled && layer.background.includedInExport){\n            attributes.push(\"hasBackground\");\n            attributes.push(\"1\");\n            attributes.push(\"backgroundColor\");\n            attributes.push(getBackgroundColorAsHexValueOrSwatchReference(layer));        \n        }        \n    }\n    \n    Xml.xmlAddAttributesToElement(currentXMLElement, attributes);\n    return false;\n}\n\n\nfunction treeForceImageExport(layer, currentXMLElement, rootDirPath, imagesSubDir, name, type){\n    let Xml = require(\"./xml.js\");\n    let Utils = require(\"./utils.js\");\n\n    if (!rootDirPath.endsWith(\"/\")) {\n        rootDirPath += \"/\";\n    }\n\n    if ((imagesSubDir.length > 0) && !imagesSubDir.endsWith(\"/\")) {\n        imagesSubDir += \"/\";\n    }\n\n    let exportPath = rootDirPath + imagesSubDir;\n\n    //NB: strange behavior - layer.id is undefined is we try to build a string BUT exists if we use console.log\n    //let toto  = layer.id;console.log(\"Exists \" + layer.id + \" -- \" + toto);\n    // We add our objectID to avoid conflict between different symbols and/or artboards\n    name = name + \"__\" + layer.sketchObject.objectID();\n\n\n    // NB: Sketch fails to generate big images. Thus, we must ensure that we don't try to export big images\n    let numberOfImages = 1;\n    let layerWidth = layer.frame.width;\n    let layerHeight = layer.frame.height;\n    for (let currentAtN = 2; currentAtN <= numberOfImagesPerLayerExport; currentAtN++) {\n        if (\n            ((layerWidth * currentAtN) > maximumImageWidthOrHeight)\n            ||\n            ((layerHeight * currentAtN) > maximumImageWidthOrHeight)\n            )\n            {\n                break;\n            }\n        numberOfImages = currentAtN;\n    }\n\n\n    let insets = Utils.exportLayerAsPNG(layer, numberOfImages, exportPath, name, false, false);\n\n    Xml.xmlAddAttributesToElement(currentXMLElement, [\"hasExport\", numberOfImages, \n                                                  \"type\", \"image\", \n                                                  \"opacity\", layer.style.opacity,\n                                                  \"topInset\", Utils.roundBy(insets[0], 0.5), \n                                                  \"bottomInset\", Utils.roundBy(insets[1], 0.5), \n                                                  \"leftInset\", Utils.roundBy(insets[2], 0.5),  \n                                                  \"rightInset\", Utils.roundBy(insets[3], 0.5)\n                                                 ]);\n\n    for (let currentAtN = 1; currentAtN <= numberOfImages; currentAtN++) {\n        let exportAttr = [];\n        let fileName = name + ((currentAtN !== 1) ? \"@\" + currentAtN + \"x\" : \"\") + \".png\";\n\n        exportAttr.push(\"format\");\n        exportAttr.push(\"png\");\n        exportAttr.push(\"size\");\n        exportAttr.push(currentAtN + \"x\");\n        exportAttr.push(\"prefix\");\n        exportAttr.push(\"\");\n        exportAttr.push(\"suffix\");\n        exportAttr.push((currentAtN !== 1) ? \"@\" + currentAtN + \"x\" : \"\");\n        exportAttr.push(\"file\");\n        exportAttr.push(imagesSubDir + fileName);\n\n       Xml.xmlAddElement(currentXMLElement, \"export\", exportAttr, null);\n    }\n}\n\n\nfunction treeAddImageExport(name, layer, currentXMLElement, rootDirPath, imagesSubDir){\n    let succeeded = false;\n\n    if (layer.exportFormats.length > 0) \n    {\n        let Xml = require(\"./xml.js\");\n        let Utils = require(\"./utils.js\");\n\n        if (!rootDirPath.endsWith(\"/\")) {\n            rootDirPath += \"/\";\n        }\n    \n        if ((imagesSubDir.length > 0) && !imagesSubDir.endsWith(\"/\")) {\n            imagesSubDir += \"/\";\n        }\n\n        let exportPath = rootDirPath + imagesSubDir;\n        // We add our objectID to avoid conflict between different symbols and/or artboards\n        name = name + \"__\" + layer.sketchObject.objectID(); \n\n        let insets = Utils.exportLayerWithUserDefinedExportOptions(layer, exportPath, name, false, false);\n\n        Xml.xmlAddAttributesToElement(currentXMLElement, [\"hasExport\", layer.exportFormats.length, \n                                                      \"type\", \"image\",  //force type as image\n                                                      \"opacity\", layer.style.opacity,\n                                                      \"topInset\", insets[0], \"bottomInset\", insets[1], \n                                                      \"leftInset\", insets[2], \"rightInset\", insets[3]\n                                                     ]);\n\n        layer.exportFormats.forEach(format => {\n            let exportFormat = format.sketchObject;\n            \n            let fileName = MSExportFormat.exportableFilenameForLayerName_exportFormat(name, exportFormat);\n\n            let sizeText = format.size;\n            let fileFormat = format.fileFormat;\n            let prefix = (format.prefix) ? format.prefix : \"\";\n            let suffix = (format.suffix) ? format.suffix : \"\";\n        \n            let exportAttr = [];\n            exportAttr.push(\"format\");\n            exportAttr.push(fileFormat);\n            exportAttr.push(\"size\");\n            exportAttr.push(sizeText);\n            exportAttr.push(\"prefix\");\n            exportAttr.push(prefix);\n            exportAttr.push(\"suffix\");\n            exportAttr.push(suffix);\n            exportAttr.push(\"file\");\n            exportAttr.push(imagesSubDir + fileName);\n            \n           Xml.xmlAddElement(currentXMLElement, \"export\", exportAttr, null);\n        });\n\n\n        succeeded = true;\n    }\n\n    return succeeded;\n}\n\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////\n// TREE INDEXING\n\n\n/*\nWe use names to add metadata inside Sketch objects.\nHere is the syntax:\nactualName -> actualType |key1|value1|key2|value2|...\nThis function returns an array with:\n- XML beacon name serving as type\n- element name\n- set of keys and values (possibly empty and possibly including legacy class information)\n*/\nfunction treeAddLayerInGlobalNamesIndex(layer, documentContext, layerNamesUnicityByContext, layersStack, contextStack){\n    let type = layer.sketchObject.class();\n\n    //extracting keys and values\n    let elements = layer.name.split(\"|\");\n    let nameAndType = elements.shift().split(\"->\");\n\n    let actualType = \"\" + type;\n    let useActualNameAsType = false;\n    let extractedTypeIsParentType = false;\n    if (type == \"MSLayerGroup\" || type == \"MSShapeGroup\"){\n        actualType = \"group\";\n    }else if (type == \"MSBitmapLayer\"){\n        actualType = \"image\";\n    }else if (type == \"MSRectangleShape\"){\n        actualType = \"rectangle\";\n    }else if (type == \"MSOvalShape\"){\n        actualType = \"oval\";\n    }else if (type == \"MSShapePathLayer\"){\n        if (isLine(layer)) {\n            actualType = \"line\";\n        }\n        //TODO: path\n    }else if (type == \"MSTextLayer\"){\n        actualType = \"text\";\n    }else if (type == \"MSArtboardGroup\"){\n        actualType = \"window\";\n        extractedTypeIsParentType = true;\n    }else if (type == \"MSSymbolMaster\"){\n        useActualNameAsType = true;\n        extractedTypeIsParentType = true;\n    }\n\n    let rawName;\n    let parentType = null;\n    if (nameAndType.length == 1){ //no type specified in name\n        rawName = nameAndType[0].trim();\n    } else if (nameAndType.length == 2){ //type is specified in name\n        rawName = nameAndType[0].trim();\n        let extractedType = nameAndType[1].trim();\n        if (extractedTypeIsParentType){\n            parentType = extractedType;\n        } else {\n            actualType = extractedType;\n        }\n    } else { //name is empty\n        log(\"treeAddLayerInGlobalNamesIndex: format error in layer's name - \" + layer.name);\n        return;\n    }\n    \n    //TODO: not only clean rawName but all captured elements\n\n    //clean possible forbidden characters\n    rawName = rawName.replace(/[^a-zA-Z0-9\\s]/g, ' ').replace(/\\s{2,}/g, ' ').trim();\n\n    if (rawName.match(/^\\d/)) {\n        rawName = \"n \" + rawName;\n    }\n\n    if (rawName.length == 0) {\n        rawName = \"invalidName\";\n    } else if (forbiddenNames.includes(rawName.toLowerCase())) {\n        rawName = \"n \" + rawName;\n    }\n\n\n    let contextKey = contextStack[0];\n    let localLayerNamesUnicityHash = layerNamesUnicityByContext[contextKey];\n\n    /*\n     Ensure name unicity\n     We manage a stack of context (contextStack) because, in the end,\n     we define QML files and we want id unicity in each QML file. \n     This optimization avoids useless suffix addition to layer names and thus makes generated code clearer.\n     */\n    //log(\"checking \" + rawName + \"(\" + contextKey + \")\");\n    let actualName = rawName;\n    let counter = 0;\n    let hashKey = camelize(actualName).toLowerCase();\n\n    if (localLayerNamesUnicityHash.hasOwnProperty(hashKey)){\n        counter = localLayerNamesUnicityHash[hashKey] + 1;\n        while (localLayerNamesUnicityHash.hasOwnProperty(hashKey + \" i\" + counter)) {\n            counter++;\n        }\n\n        actualName = actualName + \" i\" + counter;\n        localLayerNamesUnicityHash[camelize(actualName).toLowerCase()] = 1;\n    } else {\n        counter = 1;\n    }\n    localLayerNamesUnicityHash[hashKey] = counter;\n\n    if (useActualNameAsType) {\n        actualType = actualName;\n    }\n    \n    actualType = actualType.trim();\n    actualName = lowerCaseFirstCharater(actualName);\n\n    if (elements.length %2 !== 0) {\n        //NB: we arbitrarily remove the last element to get an even number\n        elements.pop();\n        log(\"treeAddLayerInGlobalNamesIndex: odd number of key-values in layer's name - \" + layer.name);\n    }\n\n    documentContext.globalNamesIndex[layer.id] = [actualName, \n                                                  actualType,\n                                                  elements, \n                                                  rawName,\n                                                  parentType];\n\n    if ((type == \"MSTextLayer\") && layer.sharedStyle && layer.sketchObject.isSharedStyleOutOfSync()) {\n        documentContext.textsWithOutOfSyncStyle[layer.id] = true;\n    }\n\n    if ((type == \"MSSymbolMaster\") || (type == \"MSArtboardGroup\")) {\n        let layerId = layer.id;\n        layerNamesUnicityByContext[layerId] = {};\n        contextStack.unshift(layerId);\n        layersStack.unshift(\"endOfContextScope\");\n    } \n\n    //exclude hidden layers and layers rendered as images\n    if (\n        !(layer.exportFormats && (layer.exportFormats.length > 0) && canExportTypeAsImage(type))\n        && !layer.hidden \n        &&  (type == \"MSArtboardGroup\" || type == \"MSLayerGroup\" || type == \"MSShapeGroup\" || type == \"MSSymbolMaster\")\n        ) {\n        for (let i = 0; layer.layers && i < layer.layers.length; i++) {\n            layersStack.unshift(layer.layers[i].id);\n        }\n    }\n}\n\n\nfunction treePopulateGlobalNamesIndex(documentContext){\n    let sketch = require('sketch/dom');\n    let document = sketch.getSelectedDocument();\n    let layerNamesUnicityByContext = {};\n    let layersStack = [];\n    \n    document.pages.forEach(page => {\n        if (page.name.startsWith(\"#\")) {\n            // Special case: we don't want to export this page\n            // BUT it may contain relevant information (symbol masters)\n            // that are required to export the content of other pages\n            page.layers.forEach(layer => {\n                let type = layer.sketchObject.class();\n                if (type ==  \"MSSymbolMaster\")\n                    layersStack.unshift(layer.id);\n            });\n        }\n        else {\n            page.layers.forEach(layer => {\n                let type = layer.sketchObject.class();\n                if (\n                     // We don't want to export slices and hotspots\n                     ((type != \"MSSliceLayer\") && (type != \"MSHotspotLayer\")) \n                     &&\n                     // We don't want to export \"private\" layers, BUT we need to list\n                     // all symbol masters to define overrides\n                     (!layer.name.startsWith(\"#\") || (type ==  \"MSSymbolMaster\"))\n                    )\n                {\n                    layersStack.unshift(layer.id);\n                }\n            });\n        }\n    });\n\n    let rootKey = \"DocumentRoot\";\n    let contextStack = [rootKey];\n    layerNamesUnicityByContext[rootKey] = {};\n    while (layersStack.length > 0) {\n        let myId = layersStack.shift();\n        if (myId == \"endOfContextScope\"){\n            let layerId = contextStack.shift();\n            delete layerNamesUnicityByContext[layerId];\n            continue;\n        }\n\n        let layer = document.getLayerWithID(myId);\n        if (layer)\n            treeAddLayerInGlobalNamesIndex(layer, documentContext, layerNamesUnicityByContext, layersStack, contextStack);\n    }\n}\n\n\nfunction treeBuildOverrideTargetPath(overR, globalNamesIndex){\n    let elmts = overR.path.split(\"/\");\n    let result = \"\";\n    for (let i = 0; i < elmts.length; i++){\n        let index = elmts[i];\n        if (globalNamesIndex[index]){\n            let str = camelize(getUniqueNameFromIndexedData(globalNamesIndex[index]));\n            result = result + str + ((i + 1 < elmts.length) ? \".\" : \"\");\n        }else{\n            log(\"undefined index on overriden layer \" + overR.affectedLayer.name + \" that may also be exportable\")\n        }\n    }\n    return result;\n}\n\n\nfunction addFontFilesToXml(xmlParent, rootDirPath, fontsSubDir, fontFiles, excludeSystemFonts) {\n    if (xmlParent && fontFiles && (fontFiles.length > 0)) {\n        let Xml = require(\"./xml.js\");\n        let Utils = require(\"./utils.js\");\n\n        if (!rootDirPath.endsWith(\"/\")) {\n            rootDirPath += \"/\";\n        }\n\n        if ((fontsSubDir.length > 0) && !fontsSubDir.endsWith(\"/\")) {\n            fontsSubDir += \"/\";\n        }\n\n        let exportPath = rootDirPath + fontsSubDir;\n        Utils.createDirectoryIfNeeded(exportPath);\n\n        let fontFileNames = [];\n        fontFiles.sort().forEach(fontFilePath => {\n            if (!excludeSystemFonts || !fontFilePath.startsWith(\"/System/Library/Fonts\")) {\n                let fileName = fontFilePath.substring(fontFilePath.lastIndexOf('/') + 1);\n                if (!fontFileNames.includes(fileName)) {\n                    fontFileNames.push(fileName);\n                   Xml.xmlAddElement(xmlParent, \"font\", [\"name\", fileName.replace(/\\.[^/.]+$/, \"\"), \"file\",  fontsSubDir + fileName], null);\n                    Utils.copyFile(fontFilePath, exportPath + fileName);\n                }\n            } \n        });\n    }\n}\n\n\nfunction validSwatchName(rawName, colorNames) {\n    let name = rawName.replace(/[^a-zA-Z0-9_]/g, ' ').replace(/\\s{2,}/g, ' ').trim();\n    if (name.match(/^\\d/))\n        name = \"swatch \" + name;\n            \n    if (name.length == 0) {\n        name = \"swatch \" + color.replace(/#/g, '');\n    } else if (forbiddenNames.includes(name.toLowerCase())) {\n        name = \"swatch \" + name;\n    }\n\n    let validName = name;\n    if (colorNames.has(validName.toLowerCase())) {\n        let index = colorNames.get(validName.toLowerCase());\n        validName = name + \" i\" + (++index);\n\n        while (colorNames.has(validName.toLowerCase())) {\n            validName = name + \" i\" + (++index);\n        }\n\n        colorNames.set(name.toLowerCase(), index);\n    }\n\n    validName = lowerCaseFirstCharater(validName);\n    colorNames.set(validName.toLowerCase(), 0);\n\n    return validName;\n}\n\n\nfunction addColorVariablesToXml(xmlParent) {\n    let sketch = require('sketch/dom');\n    if (sketch.version.sketch >= 69) {\n        let Xml = require(\"./xml.js\");\n\n        let colorNames = new Map();\n        let document = sketch.getSelectedDocument();\n\n        let swatchesData = [];\n\n        // V1: swatches defined by our document\n        /*\n        document.swatches.forEach(swatch => {\n            let color = rgbaToArgbOrRgb(swatch.color);\n            let validName = validSwatchName(swatch.name, colorNames);\n  \n            swatchesData.push({id: swatch.sketchObject.objectID(), name: validName, color: color});\n        });\n        */\n\n        // V2: document swatches and imported swatches\n        let usedNativeSwatches = document.sketchObject.documentData().allSwatches();\n        if (usedNativeSwatches.length > 0) {\n            usedNativeSwatches.forEach(nativeSwatch => {\n                let swatch = sketch.fromNative(nativeSwatch);\n\n                let color = rgbaToArgbOrRgb(swatch.color);\n                let validName = validSwatchName(swatch.name, colorNames);\n\n                swatchesData.push({id: swatch.sketchObject.objectID(), name: validName, color: color});\n            });\n        }\n\n\n        // Add missing swatches\n        for (const key in TEMP_CONTEXT.missingSwatches) {\n            let color = TEMP_CONTEXT.missingSwatches[key];\n            let validName = validSwatchName(\"missingSwatch \" + color, colorNames);\n            log(\"Adding missing swatch \" + key + \" with name '\" + validName + \"' (color: \" + color + \")\");\n            swatchesData.push({id: key, name: validName, color: color});\n        }\n\n        // Sort swatches by name before exporting them\n        swatchesData.sort((a, b) => {\n            return ((a.name !== b.name) ? ((a.name < b.name) ? -1 : 1) : 0); // NB: faster than a.name.localCompare(b.name)\n        }).forEach(swatchData => {\n           Xml.xmlAddElement(xmlParent, \"swatch\", [\"id\", swatchData.id, \"name\", swatchData.name, \"color\", swatchData.color], null);\n        });\n\n    } else {\n        console.warn(\"addColorVariablesToXml: can not export color variables - Sketch \" + sketch.version.sketch + \" is too old (required version is 69 or newer)\")\n    }\n}\n\n\nfunction addSharedTextStylesToXml(xmlParent) {\n    let Xml = require(\"./xml.js\");\n    let sketch = require('sketch/dom');\n    let document = sketch.getSelectedDocument();\n\n    let styleNames = new Map();\n    let stylesData = [];\n\n    // Step 1: get data of all text styles\n    document.sharedTextStyles.forEach(sharedTextStyle => {\n        let name = sharedTextStyle.name.replace(/[^a-zA-Z0-9_]/g, ' ').replace(/\\s{2,}/g, ' ').trim();\n        if (name.match(/^\\d/))\n            name = \"textStyle \" + name;\n        \n        if (name.length == 0) {\n            name = \"textStyle\";\n        } else if (forbiddenNames.includes(name.toLowerCase())) {\n            name = \"textStyle \" + name;\n        }\n\n        let validName = name;\n        if (styleNames.has(validName.toLowerCase())) {\n            let index = styleNames.get(validName.toLowerCase());\n            validName = name + \" i\" + (++index);\n\n            while (styleNames.has(validName.toLowerCase())) {\n                validName = name + \" i\" + (++index);\n            }\n\n            styleNames.set(name.toLowerCase(), index);\n        }\n        \n        validName = lowerCaseFirstCharater(validName);\n        styleNames.set(validName.toLowerCase(), 0);\n\n        stylesData.push({id: sharedTextStyle.id, name: validName, sharedTextStyle: sharedTextStyle});\n    });\n\n    // Step 2: export text styles\n    stylesData.sort((a, b) => {\n        return ((a.name !== b.name) ? ((a.name < b.name) ? -1 : 1) : 0); // NB: faster than a.name.localCompare(b.name)\n    }).forEach(textStyleData => {\n        let sharedTextStyleXml =Xml.xmlAddElement(xmlParent, \"sharedtextstyle\", [\"id\", textStyleData.id, \"name\", textStyleData.name], null);\n        treeAddAttributesFromTextStyle(sharedTextStyleXml, textStyleData.sharedTextStyle, null);\n    });\n}\n\n\nfunction camelize(str) {\n    str = removeDiacritics(str);\n    str = str.replace(/[^a-zA-Z0-9\\-_\\s]/g, \"\")\n    str = str.trim();\n\n    if (firstCharIsInvalid(str))\n      str = \"n\" + str;\n\n    return str.replace(/^([A-Z])|[\\-_\\s]+(\\w)/g, function(match, p1, p2, offset) {\n        if (p2) return p2.toUpperCase();\n        return p1.toLowerCase();\n    });\n}\n\nfunction pascalize(str) {\n    return capitalize(camelize(str));\n}\n\n\nfunction firstCharIsInvalid(str) {\n    return ((str.length > 0) && /[^a-z_]/i.test(str.charAt(0)));\n}\n\n\nfunction removeDiacritics (str) {\n    return Object.keys(diacriticsMap).reduce(function (str, key) {\n        let replaceRegexp = diacriticsMap[key];\n        return str.replace(replaceRegexp, key)\n      }, str);\n}\n\n\nfunction capitalize(str) {\n  if (typeof str !== 'string') return '';\n  std = str.trim();\n  if (str.length === 0) return '';\n  return str.charAt(0).toUpperCase() + str.slice(1)\n}\n\n\nfunction lowerCaseFirstCharater(str) {\n    return (str ? str[0].toLowerCase() + str.slice(1) : \"\");\n}\n\n\nfunction escapeCharactersInUnicodePrivateUseArea(str) {\n    // NB: escape special characters used by custom icon fonts generated by Fontello\n    //     see https://www.compart.com/fr/unicode/block/U+E000\n    return str.replace(/[\\uE000-\\uF8FF]/gu, function (c) {\n      return \"\\\\u\" + (\"000\" + c.charCodeAt().toString(16)).slice(-4)\n    });\n}\n\n\nfunction fontPostscriptNameFromStyle(style) {\n    if (!style || !style.sketchObject)\n        return null;\n\n    return style.sketchObject.textStyle().fontPostscriptName();\n}\n\n\nfunction fontStyleNameFromStyle(style) {\n    if (!style || !style.sketchObject)\n        return null;\n\n    let fontDisplayName = style.sketchObject.textStyle().attributes().NSFont.displayName();\n    let fontStyleName = fontDisplayName.replace(style.fontFamily, \"\").trim();\n    if (fontStyleName === \"\")\n        fontStyleName = \"Regular\";\n\n    return fontStyleName;\n}\n\n\nfunction getFillColorAsHexValueOrSwatchReference(fill) {\n    if (fill.sketchObject) {\n        return mscolorToHexValueOrSwatchReference(fill.sketchObject.color());\n    }\n    else {\n        return rgbaToArgbOrRgb(fill.color);\n    }\n}\n\n\nfunction getTextColorAsHexValueOrSwatchReference(style) {\n    if (style.sketchObject && style.sketchObject.textStyle() && style.sketchObject.textStyle().attributes() \n        && style.sketchObject.textStyle().attributes().MSAttributedStringColorAttribute) {\n        return mscolorToHexValueOrSwatchReference(style.sketchObject.textStyle().attributes().MSAttributedStringColorAttribute);\n    } else {\n       return rgbaToArgb(style.textColor);\n    }\n}\n\n\nfunction getBackgroundColorAsHexValueOrSwatchReference(layer) {\n    if (layer.sketchObject) {\n        return mscolorToHexValueOrSwatchReference(layer.sketchObject.backgroundColor());\n    } else {\n        return rgbaToArgbOrRgb(layer.background.color);\n    }\n}\n\n\nfunction mscolorToHexValueOrSwatchReference(mscolor) {\n    let swatchID = mscolor.swatchID();\n    if (swatchID) {\n        let key = String(swatchID);\n        if (!TEMP_CONTEXT.availableSwatchIDs.includes(key)) {\n            if (!TEMP_CONTEXT.missingSwatches.hasOwnProperty(key)) {\n                let color = mscolorToArgbOrRgb(mscolor);\n                log(\"Swatch with ID \" + key + \" not found (color: \" + color + \"). Please check that all named colors are imported\");\n                TEMP_CONTEXT.missingSwatches[key] = color;\n            }\n        }\n\n        return \"swatch(\" + swatchID + \")\";\n    } else {\n        return mscolorToArgbOrRgb(mscolor);\n    }\n}\n\n\nfunction mscolorToArgbOrRgb(mscolor) {\n    return rgbaToArgbOrRgb(\n        \"#\" +mscolor.immutableModelObject().hexValue() \n        + (\"0\" + Math.round(mscolor.alpha() * 255).toString(16).toUpperCase()).slice(-2)\n    );\n}\n\n\nfunction rgbaToArgb(color){\n    return color.replace(/#(......)(..)/, '#$2$1');\n}\n\n\nfunction rgbaToArgbOrRgb(color){\n    if (color.slice(-2).toUpperCase() === \"FF\") {\n        return color.slice(0, -2);\n    } else {\n        return rgbaToArgb(color);\n    }\n}\n\n\nfunction layerTextBehaviour(layer) {\n    if (!isTextLayer(layer))\n        return \"\";\n\n    let textBehaviourValue = layer.sketchObject.textBehaviour();\n    if (textBehaviourValue == 0) {\n        return \"autoWidth\";\n    } else if (textBehaviourValue == 1) {\n        return \"autoHeight\";\n    } else {\n        return \"fixedSize\";\n    }\n}\n\n\nfunction layerFontFilePath(layer) {\n    return ((layer && isTextLayer(layer)) ? styleFontFilePath(layer.style) : null);\n}\n\n\nfunction styleFontFilePath(style) {\n    let fontFilePath = null;\n\n    if (style && style.sketchObject) {\n        let nsFont = style.sketchObject.textStyle().attributes().NSFont;\n        if (nsFont) {\n            let urlAttribute = nsFont.fontDescriptor().objectForKey(\"NSCTFontFileURLAttribute\");\n            if (urlAttribute) {\n                fontFilePath = String(urlAttribute.path());\n            }\n        }\n    } \n\n    return fontFilePath;\n}\n\n\nfunction canExportTypeAsImage(type) {\n    return ((type != \"MSArtboardGroup\") && (type != \"MSSymbolMaster\"));\n}\n\n\nfunction isLayerGroup(layer) {\n    return (layer && layer.sketchObject && layer.sketchObject.isKindOfClass(MSLayerGroup.class()) \n            && !layer.sketchObject.isKindOfClass(MSShapeGroup.class()));\n}\n\n\nfunction isBitmapLayer(layer) {\n    return (layer && layer.sketchObject && layer.sketchObject.isKindOfClass(MSBitmapLayer.class()));\n}\n\n\nfunction isTextLayer(layer) {\n    return (layer && layer.sketchObject && layer.sketchObject.isKindOfClass(MSTextLayer.class()));\n}\n\n\nfunction isShapeLayer(layer) {\n    return (layer && layer.sketchObject \n            && (\n                layer.sketchObject.isKindOfClass(MSRectangleShape.class())  \n                || \n                layer.sketchObject.isKindOfClass(MSOvalShape.class())  \n                ||\n                layer.sketchObject.isKindOfClass(MSPolygonShape.class())  \n                ||\n                layer.sketchObject.isKindOfClass(MSStarShape.class())  \n                ||\n                layer.sketchObject.isKindOfClass(MSTriangleShape.class())  \n                ||\n                layer.sketchObject.isKindOfClass(MSShapePathLayer.class())\n               ) \n            );\n}\n\n\nfunction isRectangleShape(layer) {\n    return (layer && layer.sketchObject.isKindOfClass(MSRectangleShape.class()) && layer.sketchObject.isRectangle());\n    /*\n            && layer.points && (layer.points.length == 4)\n            && (layer.points[0].pointType == \"Straight\") && (layer.points[0].point.x == 0) && (layer.points[0].point.y == 0)\n            && (layer.points[1].pointType == \"Straight\") && (layer.points[1].point.x == 1) && (layer.points[1].point.y == 0)\n            && (layer.points[2].pointType == \"Straight\") && (layer.points[2].point.x == 1) && (layer.points[2].point.y == 1)\n            && (layer.points[3].pointType == \"Straight\") && (layer.points[3].point.x == 0) && (layer.points[3].point.y == 1)\n            );\n    */        \n}\n\n\nfunction isOvalShape(layer) {\n    return (layer && layer.sketchObject.isKindOfClass(MSOvalShape.class()));\n}\n\n\nfunction isLine(layer) {\n    return (layer && layer.sketchObject && layer.sketchObject.isLine());\n};\n\n\nfunction isSliceLayer(layer) {\n    return (layer && layer.sketchObject && layer.sketchObject.isKindOfClass(MSSliceLayer.class()));\n}\n\n\nfunction isArtboard(layer) {\n    return (layer && layer.sketchObject && layer.sketchObject.isKindOfClass(MSArtboardGroup.class()));\n}\n\n\nfunction isSymbolMaster(layer) {\n    return (layer && layer.sketchObject && layer.sketchObject.isKindOfClass(MSSymbolMaster.class()));\n}\n\n\nfunction isSymbolInstance(layer) {\n    return (layer && layer.sketchObject && layer.sketchObject.isKindOfClass(MSSymbolInstance.class()));\n}\n\n\nfunction isSupportedLayer(layer) {\n    return (\n            isTextLayer(layer) || isBitmapLayer(layer) \n            || (\n                 (isRectangleShape(layer) || isOvalShape(layer) || isSupportedLine(layer))\n                 && \n                 isSupportedShapeStyle(layer.style)\n                )\n            || isLayerGroup(layer) \n            || isArtboard(layer) || isSymbolInstance(layer)\n            );\n}\n\n\nfunction isSupportedLine(layer) {\n    return (isLine(layer) && layer.style && layer.style.borderOptions \n            && (layer.style.borderOptions.startArrowhead == 'None') \n            && (layer.style.borderOptions.endArrowhead == 'None'));\n}\n\n\nfunction isSupportedShapeStyle(style) {\n    let isSupported = true;\n\n    if (style) {\n        isSupported = (\n                       !(style.blur.enabled)\n                       &&\n                       (style.shadows.filter(item => { return item.enabled; }).length == 0)\n                       &&\n                       (style.innerShadows.filter(item => { return item.enabled; }).length == 0)\n                      );\n\n        if (isSupported) {\n            let activeItems = style.fills.filter(item => { return item.enabled; });\n            let numberOfActiveItems = activeItems.length;\n            if (numberOfActiveItems > 0) {\n                let lastItem = activeItems[numberOfActiveItems - 1];\n                isSupported = (\n                               (lastItem.fillType == \"Color\")\n                               &&\n                               ((numberOfActiveItems == 1) || (lastItem.color.slice(-2) === \"ff\")) // \"ff\" => fill is opaque\n                               );\n            }\n        }\n\n        if (isSupported) {\n            let activeItems = style.borders.filter(item => { return item.enabled; });\n            let numberOfActiveItems = activeItems.length;\n            if (numberOfActiveItems > 0) {\n                let lastItem = activeItems[numberOfActiveItems - 1];\n                isSupported = (\n                               (lastItem.fillType == \"Color\")\n                               && \n                               (numberOfActiveItems == 1)\n                              );            \n            }\n        }\n    }\n\n    return isSupported;\n}\n\n\nmodule.exports = {\n    addColorVariablesToXml,\n    addFontFilesToXml,\n    addSharedTextStylesToXml,\n    clearTempContext,\n    getBackgroundColorAsHexValueOrSwatchReference,\n    getFontFilesUsedByLayer,\n    getKeyValuesFromIndexedData,\n    getParentTypeFromIndexedData,\n    getTypeFromIndexedData,\n    getUniqueNameFromIndexedData,\n    initDocumentContext,\n    pascalize,\n    treeIterateLayers,\n    addSymbolMasterOverridesToXml\n};","let Utils = {};\n\n\n//NB: Sound files in /System/Library/Sounds\nUtils.Sounds = {\n    Basso: \"Basso\",\n    Blow: \"Blow\",\n    Bottle: \"Bottle\",\n    Frog: \"Frog\",\n    Funk: \"Funk\",\n    Glass: \"Glass\",\n    Hero: \"Hero\",\n    Morse: \"Morse\",\n    Ping: \"Ping\",\n    Pop: \"Pop\",\n    Purr: \"Purr\",\n    Sosumi: \"Sosumi\",\n    Submarine: \"Submarine\",\n    Tink: \"Tink\"\n};\n\n\nUtils.playSoundNamed = function(name) {\n    let sound = NSSound.soundNamed(name);\n    if (sound) \n        sound.play();\n};\n\n\nUtils.chooseFolder = function() {\n    let panel = NSOpenPanel.openPanel();\n    panel.setCanChooseDirectories(true);\n    panel.setCanChooseFiles(false);\n    panel.setCanCreateDirectories(true);\n    \n    if (panel.runModal() == NSModalResponseOK) \n    {\n        let path = panel.URL().path();\n        if (0 == path.indexOf(\"file://\")) \n        {\n            //remove the file:// path from string\n            path = path.substring(7);\n        }\n\n        if (!path.endsWith(\"/\"))\n            path += \"/\";\n\n        return path;\n    }\n    else\n    {\n        return null;\n    }\n};\n\n\nUtils.showDialog = function(message) {\n    let app = NSApplication.sharedApplication();\n    if (app)\n        app.displayDialog_withTitle(message, \"Sketch2QML\");\n};\n\n\nUtils.showInFinder = function(directoryPathOrFilePath) {\n    let errorPointer = MOPointer.alloc().init();\n    let fileManager = NSFileManager.defaultManager();\n    let result = fileManager.attributesOfItemAtPath_error(directoryPathOrFilePath, errorPointer);\n    if (result)\n    {\n        if (result.isDirectory()) \n            NSWorkspace.sharedWorkspace().openFile_withApplication(directoryPathOrFilePath, \"Finder\");\n        else \n            NSWorkspace.sharedWorkspace().selectFile_inFileViewerRootedAtPath(directoryPathOrFilePath, nil);\n    }\n    else\n        console.warn(\"Utils.showInFinder: \" + directoryPathOrFilePath + \" does not exist or can't be read\");\n};\n\n\nUtils.runCommand = function (command, args, currentDirectoryPath) {\n    var task = NSTask.alloc().init();\n    task.setLaunchPath_(command);\n    if (currentDirectoryPath)\n        task.setCurrentDirectoryPath(currentDirectoryPath);\n    \n    task.arguments = args;\n    task.launch();\n    task.waitUntilExit();\n    return (task.terminationStatus() == 0)\n};\n\n\nUtils.copyFile = function (source, destination) {\n    const manager = NSFileManager.defaultManager();\n    if (manager.fileExistsAtPath(source))\n        manager.copyItemAtPath_toPath_error(source, destination, null);\n    else\n        console.warn(\"Utils.copyFile: file '\" + source + \"` does not exist\");\n};\n\n\nUtils.fileExists = function (filePath) {\n    return NSFileManager.defaultManager().fileExistsAtPath(filePath);\n};\n\n\nUtils.expandTildeInPath = function (filePath) {\n    return String(NSString.stringWithString(filePath).stringByExpandingTildeInPath());\n};\n\n\nUtils.createDirectoryIfNeeded = function(path) {\n    const manager = NSFileManager.defaultManager();\n    if (manager.fileExistsAtPath(path)) {\n        return true;\n    } else {\n        if (manager.createDirectoryAtPath_withIntermediateDirectories_attributes_error(path, true, nil, nil)) {\n            return true;\n        } else {\n            console.warn(\"Utils.createDirectoryIfNeeded: failed to create directory \" + path);\n            return false;\n        }\n    }\n};\n\n\nUtils.forceNewDirectory = function(path) {\n    const manager = NSFileManager.defaultManager();\n    if (manager.fileExistsAtPath(path))\n        manager.removeItemAtPath_error(path, nil);\n        \n    if (manager.createDirectoryAtPath_withIntermediateDirectories_attributes_error(path, true, nil, nil)) {\n        return true;\n    } else {\n        console.warn(\"Utils.forceNewDirectory: failed to create directory \" + path);\n        return false;\n    }\n};\n\n\nUtils.roundWithDecimalPrecision = function (value, precision){\n    let multiplier = Math.pow(10, precision || 0);\n    return Math.round((value + Number.EPSILON) * multiplier)/multiplier;\n};\n\n\nUtils.roundBy = function(value, rounder) {\n    let multiplier = 1/(rounder || 0.5);\n    return Math.round(value * multiplier)/multiplier;\n}\n\n\nUtils.isLine = function(layer) {\n    return (layer && layer.sketchObject && layer.sketchObject.isLine());\n};\n\n\nUtils.MSLayerAbsoluteInfluenceRect = function(nativeLayer) {\n    const sketchVersion = require('sketch/dom').version.sketch;\n    \n    if (sketchVersion >= 96) {\n        //NB: method absoluteInfluenceRect() of MSLayer removed in Sketch 96\n        const document = nativeLayer.documentData();\n        const immutable = nativeLayer.immutableModelObject();\n        const relativeInfluenceRect = immutable.influenceRectForBoundsInDocument(document);\n        return nativeLayer.convertRect_toLayer_(relativeInfluenceRect, null);\n    } else {\n        return nativeLayer.absoluteInfluenceRect();\n    }\n};\n\n\nUtils.exportLayerWithFormats = function(layer, exportPath, exportName, formats, preserveFrameSize, applyTransformAndOpacity) {\n    let topInset = 0;\n    let bottomInset = 0;\n    let leftInset = 0;\n    let rightInset = 0;\n\n    if (!layer || !exportPath)\n    {\n        console.warn(\"Utils.exportLayerWithFormats: layer or exportPath is not defined\");\n        return [topInset, bottomInset, leftInset, rightInset];\n    }\n\n    if (formats.length > 0) \n    {\n        let sketchDom = require('sketch/dom');\n        let document = sketchDom.getSelectedDocument();\n        let layerToExport = layer;\n\n        if (!exportName)\n            exportName = layer.name;\n\n        if (!exportPath.endsWith(\"/\"))\n            exportPath += \"/\";\n\n        //NB: layer.transform.rotation wraps layer.sketchObject.userVisibleRotation() \n        //     that matches what users see in the inspector which may be different \n        //     from the raw `rotation` value\n        //     Here, we need the raw rotation because the generated code will apply a rotation\n        //\n        //NB: layer.sketchObject.userVisibleRotation and layer.sketchObject.rotation don't use the same rotation direction\n        //    layer.sketchObject.userVisibleRotation  is clockwise, layer.sketchObject.rotation is counterclockwise\n        let rotation = Utils.roundWithDecimalPrecision(-layer.sketchObject.rotation(), 3);\n\n        let isRotated = (rotation != 0);\n        let isFlippedHorizontally = layer.transform.flippedHorizontally;\n        let isFlippedVertically = layer.transform.flippedVertically;\n        let parentIsGroup = (layer.parent && layer.parent.sketchObject && layer.parent.sketchObject.isKindOfClass(MSLayerGroup.class()));\n\n        // Duplicate our layer if needed\n        let useDuplicate = false;\n        if (\n            !applyTransformAndOpacity \n            && \n            ((layer.style.opacity != 1) || isRotated || isFlippedHorizontally || isFlippedVertically || parentIsGroup)\n            )\n        {\n            useDuplicate = true;\n            layerToExport = layer.duplicate();\n            layerToExport.parent = document.selectedPage;\n\n            layerToExport.style.opacity = 1;\n            \n             if (isFlippedHorizontally)\n                layerToExport.transform.flippedHorizontally = false;\n \n             if (isFlippedVertically)\n                 layerToExport.transform.flippedVertically = false;\n \n            if (isRotated) {\n                if (Utils.isLine(layer)) {\n                    // Special case: Sketch updates the points of a line when we set its rotation\n                    // Rotation = 0 => horizontal line\n                   let frame = layerToExport.frame;\n                   let point0 = layerToExport.points[0];\n                   let pt0X = point0.point.x * frame.width;\n                   let pt0Y = point0.point.y * frame.height;\n                   let point1 = layerToExport.points[1];\n                   let pt1X = point1.point.x * frame.width;\n                   let pt1Y = point1.point.y * frame.height;\n                   let angleInDegrees = Math.atan2(pt1Y - pt0Y, pt1X - pt0X) * 180 / Math.PI;\n\n                   layerToExport.transform.rotation = angleInDegrees;\n                } else {\n                    layerToExport.transform.rotation = 0;\n                }\n            }\n        }\n\n        let nativeLayer = layerToExport.sketchObject;\n        let absoluteRect = nativeLayer.absoluteRect().rect();\n        let absoluteInfluenceRect = Utils.MSLayerAbsoluteInfluenceRect(nativeLayer);\n\n        let exportRect = absoluteRect;\n        if (!preserveFrameSize && !CGRectContainsRect(absoluteRect, absoluteInfluenceRect))\n        {\n            //TODO: decide if it's better to use the influence rectangle OR to use the union of both rectangles\n            //     - influence rectangle: we export the smallest possible image BUT we can have rather high inset values\n            //     - union: we can have small inset values BUT we export a larger image\n            //exportRect = CGRectUnion(absoluteRect, absoluteInfluenceRect); \n            exportRect = absoluteInfluenceRect;\n\n            let absoluteRectX = Utils.roundBy(absoluteRect.origin.x, 0.5);\n            let absoluteRectY = Utils.roundBy(absoluteRect.origin.y, 0.5);\n            let absoluteRectWidth = Math.ceil(absoluteRect.size.width);\n            let absoluteRectHeight = Math.ceil(absoluteRect.size.height);\n\n            topInset = exportRect.origin.y - absoluteRectY;\n            bottomInset = (absoluteRectY + absoluteRectHeight) - (exportRect.origin.y + exportRect.size.height);\n            leftInset = exportRect.origin.x - absoluteRectX;\n            rightInset = (absoluteRectX + absoluteRectWidth) - (exportRect.origin.x + exportRect.size.width);\n\n//         log(\"Utils.exportLayerWithFormats: we don't use the frame size of our layer, we will use insets to extend the visual size of our layer. Layer=\" + layer.name + \", top=\" + topInset + \", bottom=\" + bottomInset + \", left=\" + leftInset + \", right=\" + rightInset);\n        }\n//      else log(\"Utils.exportLayerWithFormats: we use the frame size of our layer to avoid trimming of transparent pixels. Layer=\" + layer.name);\n\n        //log(\"Export \" + exportName + \" rect \" + exportRect.origin.x + \", \" + exportRect.origin.y + \", \" + exportRect.size.width + \", \" + exportRect.size.height)\n        //log(\" => insets top=\" + topInset + \", bottom=\" + bottomInset + \" -- left=\" + leftInset + \", right=\" + rightInset)\n     \n        const sketchVersion = require('sketch/dom').version.sketch;\n        if (sketchVersion >= 79) {\n            // Version 79 of Sketch-Headers does not contain\n            // -(id)exportRequestFromExportFormat:(id)arg1 layer:(id)arg2 inRect:(struct CGRect)arg3 useIDForName:(BOOL)arg4;\n            formats.forEach(format => {\n                let exportFormat = (format.sketchObject ? format.sketchObject : format);\n                let exportRequest = MSExportRequest.exportRequestsFromExportableLayer_exportFormats_inRect_useIDForName(nativeLayer, [exportFormat], exportRect, false).firstObject();\n                exportRequest.setShouldTrim(false);\n                document.sketchObject.saveArtboardOrSlice_toFile(exportRequest, exportPath + MSExportFormat.exportableFilenameForLayerName_exportFormat(exportName, exportFormat));\n            });\n        } else {\n            formats.forEach(format => {\n                let exportFormat = (format.sketchObject ? format.sketchObject : format);\n                let exportRequest = MSExportRequest.exportRequestFromExportFormat_layer_inRect_useIDForName(exportFormat, nativeLayer, exportRect, false);\n                exportRequest.setShouldTrim(false);\n                document.sketchObject.saveArtboardOrSlice_toFile(exportRequest, exportPath + MSExportFormat.exportableFilenameForLayerName_exportFormat(exportName, exportFormat));\n            });\n        }\n\n        if (useDuplicate)\n            layerToExport.remove();\n    }\n    else\n        console.warn(\"Utils.exportLayerWithFormats: no export format to export layer \" + layer.name);\n\n    return [topInset, bottomInset, leftInset, rightInset];\n}\n\n\n\nUtils.exportLayerAsPNG = function(layer, maxAtN, exportPath, exportName, preserveFrameSize, applyTransformAndOpacity) {\n    if (!layer || !exportPath)\n    {\n        console.warn(\"Utils.exportLayerAsPNG: layer or exportPath is not defined\");\n        return [0, 0, 0, 0];\n    }\n\n    maxAtN = Math.max(1, maxAtN);\n\n    let exportFormats = [];\n    for (let index = 1; index <= maxAtN; index++) \n    {\n        let pngFormat = MSExportFormat.alloc().init();\n        pngFormat.setFileFormat(\"png\");\n        pngFormat.setScale(index);\n        pngFormat.setName((index === 1) ? \"\" : \"@\" + index + \"x\");\n        \n        exportFormats.push(pngFormat);\n    }\n\n    return Utils.exportLayerWithFormats(layer, exportPath, exportName, exportFormats, preserveFrameSize, applyTransformAndOpacity);\n};\n\n\nUtils.exportLayerAsSVG = function(layer, exportPath, exportName, preserveFrameSize, applyTransformAndOpacity) {\n    if (!layer || !exportPath)\n    {\n        console.warn(\"Utils.exportLayerAsSVG: layer or exportPath is not defined\");\n        return [0, 0, 0, 0];\n    }\n\n    let svgFormat = MSExportFormat.alloc().init();\n    svgFormat.setFileFormat(\"svg\");\n    svgFormat.setScale(1);\n\n    return Utils.exportLayerWithFormats(layer, exportPath, exportName, [svgFormat], preserveFrameSize, applyTransformAndOpacity);\n};\n\n\nUtils.exportLayerWithUserDefinedExportOptions = function(layer, exportPath, exportName, preserveFrameSize, applyTransformAndOpacity) {\n    if (!layer || !exportPath)\n    {\n        console.warn(\"Utils.exportLayerWithUserDefinedExportOptions: layer or exportPath is not defined\");\n        return [0, 0, 0, 0];\n    }\n\n    return Utils.exportLayerWithFormats(layer, exportPath, exportName, layer.exportFormats, preserveFrameSize, applyTransformAndOpacity);\n};\n\n\n\nmodule.exports = Utils;\n","\nfunction xmlAddElement(parent, name, attributes, value){\n    if (parent == null){\n        log (\"parent is null for \" + name);\n        return null;\n    }\n    var el;\n    if (value != null){\n        el = NSXMLElement.elementWithName_stringValue(NSString.stringWithFormat(\"%@\", name),\n                                                      NSString.stringWithFormat(\"%@\", value));\n    }else{\n        el = NSXMLElement.elementWithName(NSString.stringWithFormat(\"%@\", name));\n    }\n    \n    for (var i = 0; attributes && (i < attributes.length); i+=2){\n        el.addAttribute(NSXMLNode.attributeWithName_stringValue(NSString.stringWithFormat(\"%@\", attributes[i]),NSString.stringWithFormat(\"%@\", attributes[i+1])));\n    }\n    parent.addChild(el);\n    return el;\n}\n\nfunction xmlAddAttributesToElement(element, keyValues){\n    if (element == null){\n        log (\"xmlAddAttributesToElement: element is null\");\n        return null;\n    }\n    for (var i = 0; keyValues && (i < keyValues.length); i+=2){\n        element.addAttribute(NSXMLNode.attributeWithName_stringValue(NSString.stringWithFormat(\"%@\", keyValues[i]), NSString.stringWithFormat(\"%@\", keyValues[i+1])));\n    }\n}\n\nfunction xmlAddCustomPropertiesToElement(xmlElement, keyValues) {\n    while (keyValues.length > 0) {\n       xmlAddElement(xmlElement, \"property\", [\"key\", keyValues.shift().trim(), \"value\", keyValues.shift().trim()], null);\n    }\n}\n\nfunction exportXMLToPath(path, root){\n    var doc = NSXMLDocument.documentWithRootElement(root);\n    var xmlData = doc.XMLDataWithOptions(NSXMLNodePrettyPrint);\n    const p = NSString.stringWithFormat(\"%@\", path).stringByExpandingTildeInPath();\n    xmlData.writeToFile(p);\n}\n\nmodule.exports = {xmlAddElement, xmlAddAttributesToElement, xmlAddCustomPropertiesToElement, exportXMLToPath};","module.exports = require(\"sketch/dom\");","module.exports = require(\"sketch/settings\");","module.exports = require(\"sketch/ui\");"],"sourceRoot":""}